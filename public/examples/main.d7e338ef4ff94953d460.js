/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ({

/***/ "./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n\n\n//# sourceURL=webpack:///(webpack)/buildin/global.js?");

/***/ }),

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* WEBPACK VAR INJECTION */(function(global) {/* harmony import */ var _js_editor__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./js/editor */ \"./src/js/editor.js\");\n__webpack_require__(/*! ./scss/app.scss */ \"./src/scss/app.scss\");\n\n\nglobal.KatanaEditor = _js_editor__WEBPACK_IMPORTED_MODULE_0__[\"default\"];\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../node_modules/webpack/buildin/global.js */ \"./node_modules/webpack/buildin/global.js\")))\n\n//# sourceURL=webpack:///./src/index.js?");

/***/ }),

/***/ "./src/js/boot.js":
/*!************************!*\
  !*** ./src/js/boot.js ***!
  \************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _polyfills__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./polyfills */ \"./src/js/polyfills.js\");\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n\n\nfunction Boot() {\n  var addEventForChild = function addEventForChild(parent, eventName, childSelector, cb) {\n    parent.addEventListener(eventName, function (event) {\n      var clickedElement = event.target,\n          matchingChild = clickedElement.closest(childSelector);\n      if (matchingChild) cb(event, matchingChild);\n    });\n  };\n\n  var attachEvents = function attachEvents(obj, node, events) {\n    for (var _i = 0, _Object$entries = Object.entries(events); _i < _Object$entries.length; _i++) {\n      var _Object$entries$_i = _slicedToArray(_Object$entries[_i], 2),\n          key = _Object$entries$_i[0],\n          f = _Object$entries$_i[1];\n\n      var element = void 0,\n          func = void 0,\n          key_arr = void 0;\n      key_arr = key.split(\" \");\n\n      if (f && {}.toString.call(f) === '[object Function]') {\n        func = f;\n      } else if (Object.prototype.toString.call(f) === \"[object String]\") {\n        func = obj[f];\n      } else {\n        throw \"error event needs a function or string\";\n      }\n\n      element = key_arr.length > 1 ? key_arr.splice(1, 3).join(\" \") : null;\n\n      if (element != null) {\n        addEventForChild(node, key_arr[0], element, func);\n      } else {\n        node.addEventListener(key_arr[0], func);\n      }\n    }\n  };\n\n  this.it = function (comp, opts) {\n    if (typeof opts['node'] !== 'undefined') {\n      comp['elNode'] = opts['node'];\n    }\n\n    if (typeof comp['initialize'] !== 'undefined') {\n      comp.initialize.apply(comp, opts);\n    } else {\n      console.warn(\"Initialize method not found on \".concat(opts.name));\n    }\n\n    if (typeof comp['elNode'] !== 'undefined' && typeof comp['events'] !== 'undefined') {\n      attachEvents(comp, comp['elNode'], comp['events']);\n    }\n  };\n}\n\nvar boot = new Boot();\n/* harmony default export */ __webpack_exports__[\"default\"] = (boot);\n\n//# sourceURL=webpack:///./src/js/boot.js?");

/***/ }),

/***/ "./src/js/cleaner.js":
/*!***************************!*\
  !*** ./src/js/cleaner.js ***!
  \***************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/js/utils.js\");\n/* harmony import */ var _lib_sanitize_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/sanitize.js */ \"./src/js/lib/sanitize.js\");\n\n\n\nfunction clean() {\n  this.it = function (element) {\n    var s = new _lib_sanitize_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]({\n      elements: ['strong', 'img', 'em', 'br', 'a', 'blockquote', 'b', 'u', 'i', 'pre', 'p', 'h1', 'h2', 'h3', 'h4', 'ul', 'ol', 'li', 'iframe', 'figcaption', 'cite'],\n      attributes: {\n        '__ALL__': ['class', 'name', 'data-action', 'title'],\n        a: ['href', 'title', 'target'],\n        img: ['src', 'data-height', 'data-width', 'data-image-id', 'data-delayed-src', 'data-frame-url', 'data-frame-aspect'],\n        iframe: ['src', 'width', 'height'],\n        ol: ['type']\n      },\n      protocols: {\n        a: {\n          href: ['http', 'https', 'mailto']\n        }\n      },\n      transformers: [function (input) {\n        if (input.node_name === \"iframe\") {\n          var src = input.node.attr('src');\n\n          if (_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].urlIsFromDomain(src, 'youtube.com') || _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].urlIsFromDomain(src, 'vimeo.com')) {\n            return {\n              whitelist_nodes: [input.node]\n            };\n          } else {\n            return null;\n          }\n        }\n      }, function (input) {\n        if (input.node_name === \"span\" && input.node.hasClass(\"placeholder-text\")) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else {\n          return null;\n        }\n      }, function (input) {\n        var kls = input.node.classList ? input.node.classList : [];\n\n        if (input.node_name === 'div' && (kls.contains(\"item-mixtapeEmbed\") || kls.contains(\"padding-cont\") || kls.contains(\"block-grid-row\") || kls.contains(\"ignore-block\"))) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else if (input.node_name == 'div' && (kls.contains(\"item-controls-cont\") || kls.contains(\"item-controls-inner\")) && input.node.closest('.item-figure') != null) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else if (input.node_name === 'a' && kls.contains(\"item-mixtapeEmbed\")) {\n          return {\n            attr_whitelist: [\"style\"]\n          };\n        } else {\n          return null;\n        }\n      }, function (input) {\n        var kls = input.node.classList ? input.node.classList : [];\n        var prntNode = input.node.parentNode ? input.node.parentNode : false;\n        var prntKls = prntNode ? prntNode.classList : []; // const prntKls = [];\n\n        if (input.node_name === 'figure' && kls.contains(\"item-iframe\")) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else if (input.node_name === 'div' && kls.contains(\"iframeContainer\") && prntKls.contains(\"item-iframe\")) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else if (input.node_name === 'iframe' && prntKls.contains(\"iframeContainer\")) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else if (input.node_name === 'figcaption' && prntKls.contains(\"item-iframe\")) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else if (input.node_name === 'div' && kls.contains('item-controls') && input.node.closest('.item-figure') != null) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else {\n          return null;\n        }\n      }, function (input) {\n        var kls = input.node.classList ? input.node.classList : [];\n        var prntNode = input.node.parentNode ? input.node.parentNode : false;\n        var prntKls = prntNode ? prntNode.classList : [];\n\n        if (input.node_name === 'figure' && kls.contains(\"item-figure\")) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else if (input.node_name === 'div' && kls.contains(\"padding-cont\") && prntKls.contains(\"item-figure\")) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else if (input.node_name === 'div' && kls.contains(\"padding-box\") && prntKls.contains(\"padding-cont\")) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else if (input.node_name === 'img' && input.node.closest(\".item-figure\") != null) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else if (input.node_name === 'a' && prntKls.contains(\"item-mixtapeEmbed\")) {\n          return {\n            attr_whitelist: [\"style\"]\n          };\n        } else if (input.node_name === 'figcaption' && prntKls.contains(\"item-figure\")) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else if (input.node_name === 'figcaption' && prntKls.contains(\"block-grid\")) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else if (input.node_name === 'span' && prntKls.contains(\"figure-caption\")) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else if (input.node_name === 'span' && prntKls.contains(\"block-grid-caption\")) {\n          return {\n            whitelist_nodes: [input.node]\n          };\n        } else {\n          return null;\n        }\n      }]\n    });\n\n    if (element.length) {\n      for (var i = 0; i < element.length; i = i + 1) {\n        var el = element[i];\n        var cleanNode = s.clean_node(el);\n        el.innerHTML = '';\n        el.appendChild(cleanNode);\n      }\n    }\n  };\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (new clean());\n\n//# sourceURL=webpack:///./src/js/cleaner.js?");

/***/ }),

/***/ "./src/js/content/core.js":
/*!********************************!*\
  !*** ./src/js/content/core.js ***!
  \********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _boot__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../boot */ \"./src/js/boot.js\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils */ \"./src/js/utils.js\");\n\n\n\nfunction Manager(opts) {\n  this.opts = opts;\n  this.initialize = this.initialize.bind(this);\n  this.move = this.move.bind(this);\n  this.toggleOptions = this.toggleOptions.bind(this);\n  this.handleClick = this.handleClick.bind(this);\n  _boot__WEBPACK_IMPORTED_MODULE_0__[\"default\"].it(this, opts);\n}\n\nManager.prototype.el = '#mfContentBase';\nManager.prototype.showedAgainst = null;\nManager.prototype.events = {\n  'click .inlineTooltip-button.control': 'toggleOptions',\n  'click .inlineTooltip-menu button': 'handleClick'\n};\n\nManager.prototype.initialize = function () {\n  var opts = this.opts;\n  this.widgets = opts.widgets || [];\n  this.current_editor = opts.editor;\n};\n\nManager.prototype.template = function () {\n  var menu;\n  menu = \"\";\n  this.widgets.forEach(function (b) {\n    var data_action_value;\n    data_action_value = b.action ? \"data-action-value='\" + b.action + \"'\" : \"\";\n\n    if (b.template) {\n      menu += b.template();\n    } else {\n      menu += \"<button class=\\\"inlineTooltip-button scale\\\" title=\\\"\".concat(b.title, \"\\\" data-action=\\\"inline-menu-\").concat(b.action, \"\\\" \").concat(data_action_value, \"\\\"> <span class=\\\"tooltip-icon \").concat(b.icon, \"\\\"></span> </button>\");\n    }\n\n    return menu;\n  });\n  return \"<button class='inlineTooltip-button control' data-action='inline-menu' title='Content Options'> <span class='tooltip-icon mfi-plus'></span> </button> <div class='inlineTooltip-menu'>\".concat(menu, \"</div>\");\n};\n\nManager.prototype.render = function () {\n  var template = this.template();\n  this.elNode.innerHTML = template;\n  return this;\n};\n\nManager.prototype.getView = function () {\n  return 'html'; // \n};\n\nManager.prototype.hide = function () {\n  this.elNode.removeClass('is-active');\n  this.elNode.removeClass('is-scaled');\n  this.elNode.addClass('hide');\n};\n\nManager.prototype.show = function (showedAgainst) {\n  var hidden = document.querySelector('.hide-placeholder');\n\n  if (hidden != null) {\n    hidden.removeClass('hide-placeholder');\n  }\n\n  this.showedAgainst = showedAgainst;\n  this.elNode.addClass('is-active');\n  this.elNode.removeClass('hide');\n};\n\nManager.prototype.move = function (coords) {\n  var control_spacing, control_width, coord_left, coord_top, pull_size, tooltip;\n  tooltip = this.elNode;\n  control_width = tooltip.querySelector(\".control\").getBoundingClientRect().width;\n  control_spacing = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getStyle(tooltip.querySelector(\".inlineTooltip-menu\"), 'paddingLeft');\n  pull_size = parseInt(control_width) + parseInt(control_spacing.replace(/px/, \"\"));\n\n  if (isNaN(pull_size)) {\n    pull_size = 0;\n  }\n\n  coord_left = coords.left - pull_size;\n  coord_top = coords.top;\n\n  if (_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getWindowWidth() <= 768) {\n    coord_left = 5;\n  }\n\n  this.elNode.style.top = coord_top + 'px';\n  this.elNode.style.left = coord_left + 'px';\n  return;\n};\n\nManager.prototype.toggleOptions = function (ev) {\n  this.elNode.removeClass('choose-section');\n\n  if (this.elNode.hasClass('is-scaled')) {\n    this.elNode.removeClass('is-scaled');\n\n    if (this.showedAgainst && this.showedAgainst.querySelector('.placeholder-text') != null) {\n      this.showedAgainst.removeClass('hide-placeholder');\n    }\n  } else {\n    this.elNode.addClass('is-scaled');\n\n    if (this.showedAgainst && this.showedAgainst.querySelector('.placeholder-text') != null) {\n      this.showedAgainst.addClass('hide-placeholder');\n    }\n  }\n\n  return false;\n};\n\nManager.prototype.findWidgetByAction = function (name) {\n  return this.widgets.filter(function (e) {\n    return e.action === name || name.indexOf(e.action) != -1;\n  });\n};\n\nManager.prototype.handleClick = function (ev, matched) {\n  var detected_widget, name, sub_name;\n\n  if (matched) {\n    name = matched.attr('data-action');\n  } else {\n    name = ev.currentTarget.attr('data-action');\n  }\n\n  sub_name = name.replace(\"inline-menu-\", \"\");\n  detected_widget = this.findWidgetByAction(sub_name);\n\n  if (detected_widget != null && detected_widget.length > 0) {\n    detected_widget[0].handleClick(ev, matched);\n  }\n\n  return false;\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Manager);\n\n//# sourceURL=webpack:///./src/js/content/core.js?");

/***/ }),

/***/ "./src/js/content/embed.js":
/*!*********************************!*\
  !*** ./src/js/content/embed.js ***!
  \*********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _boot__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../boot */ \"./src/js/boot.js\");\n\n\nfunction Embed(opts) {\n  this.opts = opts;\n  this.handleClick = this.handleClick.bind(this);\n  this.initialize = this.initialize.bind(this);\n  _boot__WEBPACK_IMPORTED_MODULE_0__[\"default\"].it(this, opts);\n}\n\nEmbed.prototype.initialize = function () {\n  var opts = this.opts;\n  this.icon = 'mfi-embed';\n  this.title = 'embed';\n  this.action = 'embed';\n};\n\nEmbed.prototype.handleClick = function (ev, matched) {\n  console.log('embed click');\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Embed);\n\n//# sourceURL=webpack:///./src/js/content/embed.js?");

/***/ }),

/***/ "./src/js/content/image.js":
/*!*********************************!*\
  !*** ./src/js/content/image.js ***!
  \*********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _boot__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../boot */ \"./src/js/boot.js\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils */ \"./src/js/utils.js\");\n/* harmony import */ var _stream__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../stream */ \"./src/js/stream.js\");\n\n\n\n\nfunction Images(opts) {\n  this.opts = opts;\n  this.stream = _stream__WEBPACK_IMPORTED_MODULE_2__[\"default\"];\n  this.initialize = this.initialize.bind(this);\n  this.uploadCompleted = this.uploadCompleted.bind(this);\n  this.uploadExistentImage = this.uploadExistentImage.bind(this);\n  this.updateProgressBar = this.updateProgressBar.bind(this);\n  this.uploadFile = this.uploadFile.bind(this);\n  this.uploadFiles = this.uploadFiles.bind(this);\n  this.handleEnterKey = this.handleEnterKey.bind(this);\n  this.handleClick = this.handleClick.bind(this);\n  this.handleBackspaceKey = this.handleBackspaceKey.bind(this);\n  this.handleDeleteKey = this.handleDeleteKey.bind(this);\n  this.imageSelect = this.imageSelect.bind(this);\n  this.imageUploadCallback = this.imageUploadCallback.bind(this);\n  this.fixPositioningForMultipleImages = this.fixPositioningForMultipleImages.bind(this);\n  this.addImagesOnScene = this.addImagesOnScene.bind(this);\n  this.embedParagraphAboveImage = this.embedParagraphAboveImage.bind(this);\n  this.pushMultipleImageContainer = this.pushMultipleImageContainer.bind(this);\n  _boot__WEBPACK_IMPORTED_MODULE_0__[\"default\"].it(this, opts);\n}\n\nImages.prototype.contentId = 'IMAGES';\n\nImages.prototype.initialize = function () {\n  var opts = this.opts;\n  this.icon = 'mfi-photo';\n  this.title = 'image';\n  this.action = 'image';\n  this.current_editor = opts.editor;\n  this.editorEl = this.current_editor.elNode;\n  this.addImagesInContainer = false;\n  this.personal_toolbar = opts.toolbar;\n  this.image_cdn_path = '/';\n\n  var _this = this;\n\n  this.stream.subscribe('Katana.Images.Restructure', function (event) {\n    _this.fixPositioningForMultipleImages(event.container, event.figures, event.count);\n  });\n  this.stream.subscribe('Katana.Images.Add', function (event) {\n    if (typeof event.row != 'undefined') {\n      _this.addImagesInRow = event.row;\n\n      _this.imageSelect(event);\n    } else if (typeof event.figure != 'undefined') {\n      _this.imageSelect(event);\n    }\n  });\n  return this;\n};\n\nImages.prototype.handleClick = function (ev) {\n  this.imageSelect(ev);\n};\n\nImages.prototype.createRowAroundFigure = function (figure) {\n  var row = this.pushMultipleImageContainer(2, figure);\n  figure.addClass('figure-in-row');\n  var img = figure.querySelector('.item-image');\n  row.appendChild(figure);\n\n  if (img != null) {\n    img = img;\n    this.setAspectRatio(figure, img.naturalWidth, img.naturalHeight);\n  }\n\n  return row;\n};\n\nImages.prototype.thirdPartyQueue = {};\nImages.prototype.queueProcessTimer = null;\n\nImages.prototype.thirdPartyImageProcessed = function (image_element, key) {\n  delete this.thirdPartyQueue[key];\n\n  if (Object.keys(this.thirdPartyQueue).length == 0) {\n    clearInterval(this.queueProcessTimer);\n  }\n};\n\nImages.prototype.processSingleImageElement = function (image_element, opts, key) {\n  var url = image_element.attr('src');\n  var formData = new FormData();\n\n  var _this = this;\n\n  if (url.indexOf('data:image') == 0) {\n    formData.append('image', url);\n  } else {\n    formData.append('url', url);\n  }\n\n  this.current_editor.currentRequestCount++;\n  var oReq = new XMLHttpRequest();\n  oReq.open(\"POST\", '/upload-url', true);\n\n  oReq.onload = function (event) {\n    if (oReq.status == 200) {\n      try {\n        var data = JSON.parse(oReq.responseText);\n\n        if (data.success) {\n          var imgSrc = data.file,\n              imageId = data.id;\n\n          _this.thirdPartyImageLoaded({\n            url: url,\n            file: imgSrc,\n            imageId: imageId,\n            key: key\n          });\n\n          _this.current_editor.currentRequestCount--;\n        }\n      } catch (e) {\n        console.log('While uploading image');\n        console.error(e);\n        _this.current_editor.currentRequestCount--;\n      }\n    } else {\n      _this.current_editor.currentRequestCount--;\n    }\n  };\n\n  oReq.send(formData);\n};\n\nImages.prototype.processThirdPartyQueue = function () {\n  var currentlyProcessing = 0,\n      toProcess = [],\n      process;\n\n  for (var prop in this.thirdPartyQueue) {\n    if (this.thirdPartyQueue.hasOwnProperty(prop)) {\n      var item = this.thirdPartyQueue[prop];\n\n      if (item && item.processing) {\n        currentlyProcessing++;\n      } else if (item && !item.processing) {\n        toProcess.push(item);\n      }\n    }\n  }\n\n  if (currentlyProcessing == 2) {\n    return;\n  }\n\n  for (var i = 0; i < toProcess.length; i = i + 1) {\n    toProcess[i].processing = true;\n    this.processSingleImageElement(toProcess[i].element, toProcess[i].opts, toProcess[i].key);\n\n    if (i == 1) {\n      break;\n    }\n  }\n};\n\nImages.prototype.handleThirdPartyImage = function (image_element, opts) {\n  var url = image_element.attr('src');\n  var key = url + Math.random(0, Math.random()).toString(32).substring(0, 8);\n  image_element.attr('data-key', key);\n  this.thirdPartyQueue[url] = {\n    element: image_element,\n    opts: opts,\n    key: key\n  };\n\n  var _this = this;\n\n  if (this.queueProcessTimer == null) {\n    this.queueProcessTimer = setInterval(function () {\n      _this.processThirdPartyQueue();\n    }, 3000);\n  }\n};\n\nImages.prototype.thirdPartyImageLoaded = function (ob) {\n  var oldImg = document.querySelector('[src=\"' + ob.url + '\"]'),\n      newUrl = this.image_cdn_path + '/fullsize/' + ob.file,\n      tmpl = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.getFigureTemplate()),\n      _this = this,\n      img = tmpl.querySelector('img');\n\n  img.attr('src', newUrl);\n  img.attr('data-delayed-src', newUrl);\n  img.attr('data-image-id', ob.imageId);\n  var figure = img.closest('.item-figure');\n\n  if (figure != null) {\n    figure.removeClass('item-uploading');\n  }\n\n  this.replaceImg(oldImg, tmpl, newUrl, function (figure, image_element) {\n    _this.thirdPartyImageProcessed(image_element, ob.key);\n\n    var insideGraf = figure.closest('.item:not(\".item-figure\")');\n\n    if (insideGraf != null) {\n      do {\n        figure.unwrap();\n        insideGraf = figure.closest('.item:not(\".item-figure\")');\n      } while (insideGraf != null);\n    }\n\n    if (figure.closest('.ignore-block.item-uploading') != null) {\n      figure.unwrap();\n    }\n\n    image_element.parentNode.removeChild(image_element);\n  });\n};\n\nImages.prototype.pastedImagesCache = {};\n\nImages.prototype.uploadExistentImage = function (image_element, opts) {\n  var src = image_element.attr('src');\n  var name;\n\n  if (image_element.hasAttribute('name')) {\n    name = image_element.attr('name');\n  }\n\n  if (name) {\n    if (typeof this.pastedImagesCache[name] != 'undefined') {\n      return;\n    }\n  } else if (image_element.hasClass('marked')) {\n    return;\n  }\n\n  image_element.addClass('marked');\n\n  if (name) {\n    this.pastedImagesCache[name] = true;\n  }\n\n  if (!_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].urlIsFromDomain(src, 'mefacto.com')) {\n    var div = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(\"<div class=\\\"ignore-block item-uploading\\\" contenteditable=\\\"false\\\"></div>\");\n    image_element.parentNode.insertBefore(div, image_element);\n    div.appendChild(image_element);\n    return this.handleThirdPartyImage(image_element, opts);\n  }\n\n  var i,\n      img,\n      n,\n      node,\n      tmpl,\n      _i,\n      _ref,\n      pasting = false;\n\n  if (opts == null) {\n    opts = {};\n  }\n\n  tmpl = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.getFigureTemplate());\n\n  if (this.addImagesInContainer) {\n    tmpl.addClass('figure-in-row');\n  }\n\n  if (image_element.closest(\".item\") != null) {\n    if (image_element.closest(\".item\").hasClass(\"item-figure\")) {\n      return;\n    }\n\n    var itm = image_element.closest('.item');\n    itm.parentNode.insertBefore(tmpl, itm);\n    node = this.current_editor.getNode();\n\n    if (node) {\n      this.current_editor.addClassesToElement(node);\n    }\n  } else if (image_element.closest(this.current_editor.paste_element_id) != null) {\n    pasting = true;\n    image_element.parentNode.insertBefore(tmpl, image_element);\n  } else {\n    img = image_element.parentsUntil(\".block-content-inner\");\n\n    if (img != null) {\n      img = img.firstChild;\n      img.parentNode.insertBefore(tmpl, img);\n      img.parentNode.removeChild(img);\n    }\n  }\n\n  if (!pasting) {\n    this.replaceImg(image_element, document.querySelector(\"[name='\" + tmpl.attr('name') + \"']\"));\n    n = document.querySelector(\"[name='\" + tmpl.attr('name') + \"']\");\n\n    if (n != null) {\n      n = n.parentsUntil(\".block-content-inner\");\n\n      if (n != null) {\n        for (i = _i = 0, _ref = n - 1; _i <= _ref; i = _i += 1) {\n          document.querySelector(\"[name='\" + tmpl.attr('name') + \"']\").unwrap();\n        }\n      }\n    }\n  } else {\n    this.replaceImg(image_element, document.querySelector(\"[name='\" + tmpl.attr('name') + \"']\"));\n  }\n\n  return;\n};\n\nImages.prototype.replaceImg = function (image_element, figure, srcToUse, callback) {\n  var img, self, sr;\n  img = new Image();\n\n  if (typeof srcToUse == 'undefined' && typeof callback == 'undefined') {\n    img.attr('src', image_element.attr('src'));\n    sr = image_element.attr('src');\n    var imgE = image_element;\n    var fig = imgE.closest('figure');\n\n    if (fig != null) {\n      fig.parentNode.removeChild(fig);\n    }\n\n    imgE.parentNode.removeChild(imgE);\n    var ig = figure.querySelector('img');\n\n    if (ig != null) {\n      ig.attr('src', sr);\n      ig.attr('data-delayed-src', sr);\n    }\n  } else {\n    img.attr('src', srcToUse);\n    sr = srcToUse;\n  }\n\n  img.attr('data-delayed-src', sr);\n  self = this;\n  return img.onload = function () {\n    self.setAspectRatio(figure, this.width, this.height);\n    var fig = figure.querySelector(\".item-image\");\n\n    if (fig != null) {\n      fig.attr(\"data-height\", this.height);\n      fig.attr(\"data-width\", this.width);\n    }\n\n    console.log(\"replaceImg = this.naturalWidth \".concat(this.naturalWidth, \", width \").concat(this.width));\n\n    if (this.naturalWidth < 760) {\n      figure.addClass('n-fullSize');\n    } else {\n      figure.removeChild('n-fullSize');\n    }\n\n    if (typeof srcToUse == 'undefined') {\n      var _ig = figure.querySelector('img');\n\n      if (_ig != null) {\n        return _ig.attr('src', sr);\n      }\n\n      return null;\n    } else {\n      var _ig2 = figure.querySelector('img');\n\n      if (_ig2 != null) {\n        _ig2.attr('src', srcToUse);\n      }\n\n      image_element.parentNode.insertBefore(figure, image_element);\n      image_element.parentNode.removeChild(image_element);\n    }\n\n    if (typeof callback != 'undefined') {\n      callback(figure, image_element);\n    }\n  };\n};\n\nImages.prototype.displayAndUploadImages = function (file, cont, callback) {\n  this.displayCachedImage(file, cont, callback);\n};\n\nImages.prototype.viaDrop = false;\n\nImages.prototype.imageSelect = function (ev) {\n  var selectFile, self;\n  selectFile = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement('<input type=\"file\" multiple=\"multiple\">');\n  selectFile.click();\n  self = this;\n  return selectFile.addEventListener('change', function () {\n    var t;\n    t = this;\n    self.viaDrop = false;\n\n    if (ev.row) {\n      self.addImagesInRow = ev.row;\n    } else {\n      self.addImagesInRow = false;\n    }\n\n    if (typeof ev.figure != 'undefined') {\n      self.wrapFigureWithAdditions = ev.figure;\n    } else {\n      self.wrapFigureWithAdditions = false;\n    }\n\n    self.addImagesInContainer = false;\n    return self.uploadFiles(t.files);\n  });\n};\n\nImages.prototype.displayCachedImage = function (file, cont, callback) {\n  this.current_editor.content_bar.hide();\n  window.URL = window.webkitURL || window.URL; // Vendor prefixed in Chrome.\n\n  var img = document.createElement('img');\n\n  var _this = this;\n\n  img.onload = function (e) {\n    if (_this.droppedCount) {\n      _this.droppedCount--;\n    }\n\n    var node, self;\n    node = _this.viaDrop ? document.querySelector('.drop-placeholder') : _this.current_editor.getNode();\n    self = _this;\n    var img_tag, new_tmpl, replaced_node;\n    new_tmpl = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(self.current_editor.getFigureTemplate());\n\n    if (typeof cont != 'undefined' && cont != null) {\n      new_tmpl.addClass('figure-in-row');\n\n      if (cont.contains(node)) {\n        node.insertAdjacentElement('afterend', new_tmpl);\n        replaced_node = new_tmpl; //node.parentNode.insertBefore(new_tmpl, node);\n      } else {\n        replaced_node = new_tmpl;\n        cont.appendChild(replaced_node);\n      }\n    } else {\n      replaced_node = node.parentNode.insertBefore(new_tmpl, node);\n    }\n\n    img_tag = new_tmpl.querySelector('img.item-image');\n\n    if (img_tag != null) {\n      img_tag.attr('src', e.target.currentSrc ? e.target.currentSrc : e.target.result);\n    }\n\n    img_tag.height = this.height;\n    img_tag.width = this.width;\n    self.setAspectRatio(replaced_node, this.width, this.height);\n    var rig = replaced_node.querySelector(\".item-image\");\n\n    if (rig != null) {\n      rig.attr(\"data-height\", this.height);\n      rig.attr(\"data-width\", this.width);\n    }\n\n    if (this.naturalWidth < 700) {\n      replaced_node.addClass('n-fullSize');\n    } else {\n      replaced_node.removeClass('n-fullSize');\n    }\n\n    if (self.current_editor.image_options && self.current_editor.image_options.upload) {\n      new_tmpl.addClass('item-uploading'); // release blob when actual image uploads starts\n\n      window.URL.revokeObjectURL(this.src); // Clean up after yourself\n    }\n\n    if (typeof callback != 'undefined') {\n      callback(replaced_node); // let the callback know the image has been places, we need to adjust width incase of multiple images select  \n    }\n\n    if (_this.droppedCount == 0) {\n      var dp = document.querySelector('.drop-placeholder');\n\n      if (dp != null) {\n        dp.parentNode.removeChild(dp);\n      }\n    }\n\n    self.uploadFile(file, replaced_node);\n  };\n\n  img.src = window.URL.createObjectURL(file);\n};\n\nImages.prototype.setAspectRatio = function (figure, w, h) {\n  var fill_ratio, height, maxHeight, maxWidth, ratio, result, width;\n  maxWidth = 760;\n  maxHeight = 700;\n  ratio = 0;\n  width = w;\n  height = h;\n\n  if (figure.hasClass('figure-in-row')) {\n    maxWidth = figure.closest('.block-grid-row').getBoundingClientRect().width;\n    maxHeight = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getWindowWidth();\n  }\n\n  if (width > maxWidth) {\n    ratio = maxWidth / width;\n    height = height * ratio;\n    width = width * ratio;\n  } else if (height > maxHeight) {\n    ratio = maxHeight / height;\n    width = width * ratio;\n    height = height * ratio;\n  }\n\n  fill_ratio = height / width * 100;\n  var pc = figure.querySelector(\".padding-cont\");\n\n  if (pc != null) {\n    pc.style.maxWidth = width + 'px';\n    pc.style.maxHeight = height + 'px';\n  }\n\n  var pb = figure.querySelector(\".padding-box\");\n\n  if (pb != null) {\n    pb.style.paddingBottom = fill_ratio + \"%\";\n  }\n};\n\nImages.prototype.formatData = function (file) {\n  var formData;\n  formData = new FormData();\n  formData.append('file', file, file.name);\n  return formData;\n};\n\nImages.prototype.droppedCount = -1;\n\nImages.prototype.uploadFiles = function (files, viaDrop) {\n  this.batchesFiles = [];\n\n  if (typeof viaDrop != 'undefined' && viaDrop) {\n    this.viaDrop = true;\n  }\n\n  var sizeLimit = 17900000,\n      // 8 MB\n  acceptedTypes,\n      file,\n      i,\n      _results,\n      sizeError;\n\n  acceptedTypes = {\n    \"image/png\": true,\n    \"image/jpeg\": true,\n    \"image/gif\": true\n  };\n  i = 0;\n  _results = [], sizeError = false;\n\n  while (i < files.length) {\n    file = files[i];\n\n    if (acceptedTypes[file.type] === true) {\n      if (file.size <= sizeLimit) {\n        this.batchesFiles.push(file);\n      } else {\n        sizeError = true;\n      }\n    }\n\n    _results.push(i++);\n  }\n\n  if (sizeError) {\n    this.current_editor.notifySubscribers('Katana.Error', {\n      target: 'image',\n      message: 'Max file size exceeded'\n    });\n    return;\n  }\n\n  if (this.batchesFiles.length == 0) {\n    var dp = document.querySelector('.drop-placeholder');\n\n    if (dp != null) {\n      dp.parentNode.removeChild(dp);\n    }\n\n    this.viaDrop = false;\n    this.droppedCount = this.batchesFiles.length;\n  }\n\n  this.addImagesOnScene();\n  return _results;\n};\n\nImages.prototype.addImagesOnScene = function () {\n  var batch = this.batchesFiles,\n      size = batch.length,\n      cont = false,\n      i = 0;\n\n  if (!size) {\n    return;\n  }\n\n  if (this.wrapFigureWithAdditions) {\n    var figure = this.wrapFigureWithAdditions;\n    var row = this.pushMultipleImageContainer(2, figure);\n    figure.addClass('figure-in-row');\n    var img = figure.querySelector('.item-image');\n    row.appendChild(figure);\n\n    if (img != null) {\n      this.setAspectRatio(figure, img.naturalWidth, img.naturalHeight);\n    }\n\n    cont = row;\n    this.wrapFigureWithAdditions = false;\n  }\n\n  if (this.addImagesInRow) {\n    var len = size > 3 ? 3 : size;\n\n    for (var i = 0; i < len; i = i + 1) {\n      this.displayAndUploadImages(batch[i], this.addImagesInRow, this.imageUploadCallback);\n    }\n\n    return;\n  }\n\n  if (size == 1 && !cont) {\n    this.displayAndUploadImages(this.batchesFiles[0], null, this.imageUploadCallback);\n  } else if (size > 1 && size < 9 || cont) {\n    if (!cont) {\n      cont = this.pushMultipleImageContainer(size);\n    }\n\n    k = 0;\n\n    while (k < size) {\n      var l = k + 3 > size ? size : k + 3;\n\n      for (i = k; i < l; i = i + 1) {\n        this.displayAndUploadImages(batch[i], cont, this.imageUploadCallback);\n        k++;\n      }\n\n      if (k >= size) {\n        break;\n      }\n\n      var newCount = size - l > 3 ? 3 : size - l;\n      var newRow = this.blockGridRowTemplate(newCount);\n      newRow.insertAfter(cont);\n      cont = newRow;\n    }\n  }\n};\n\nImages.prototype.imageUploadCallback = function (figure) {\n  var node, parentNode;\n  node = figure;\n  parentNode = node.parentNode;\n\n  if (parentNode != null && parentNode.hasClass('block-grid-row')) {\n    var count = parentNode.attr('data-paragraph-count'),\n        figures = parentNode.querySelectorAll('.figure-in-row');\n    this.fixPositioningForMultipleImages(parentNode, figures, count);\n\n    if (figures.length == count) {\n      if (parentNode.querySelector('.item-selected') != null) {\n        // move to next section , so that its width doesn't change\n        var selected = parentNode.querySelector('.item-selected'),\n            next_cont = parentNode.next('.block-content-inner'),\n            first_child = null;\n\n        if (next_cont != null) {\n          for (var i = 0; i < next_cont.children.length; i++) {\n            var ncc = next_cont.children[i];\n\n            if (ncc.hasClass('item')) {\n              first_child = ncc;\n              break;\n            }\n          }\n        }\n\n        if (first_child != null) {\n          first_child.parentNode.insertBefore(selected, first_child);\n        } else {\n          next_cont.appendChild(selected);\n        }\n      } //this.current_editor.cleanUpInnerSections();\n\n\n      this.current_editor.selectFigure(node);\n    }\n  } else {\n    this.current_editor.setupFirstAndLast();\n    this.current_editor.selectFigure(figure);\n  }\n};\n\nImages.prototype.fixPositioningForMultipleImages = function (cont, figures, count) {\n  if (cont == null) {\n    return;\n  }\n\n  var ratios = [],\n      rsum = 0,\n      height,\n      len = figures.length,\n      widths = [],\n      totalWidth = cont.getBoundingClientRect().width,\n      i = 0;\n\n  for (i; i < len; i = i + 1) {\n    var fig = figures[i];\n    var ig = fig.querySelector('img');\n    var nw = nh = 0;\n\n    if (ig != null) {\n      if (ig.hasAttribute('data-width')) {\n        nw = parseInt(ig.attr('data-width'));\n      } else {\n        nw = ig.naturalWidth;\n      }\n\n      if (ig.hasAttribute('data-height')) {\n        nh = parseInt(ig.attr('data-height'));\n      } else {\n        nh = ig.naturalHeight;\n      }\n    }\n\n    this.setAspectRatio(fig, nw, nh);\n  }\n\n  for (i = 0; i < len; i = i + 1) {\n    var ig = figures[i].querySelector('img');\n\n    if (ig != null) {\n      r = parseFloat(ig.attr('data-width')) / parseFloat(ig.attr('data-height'));\n      rsum += r;\n      ratios[i] = r;\n    }\n  }\n\n  height = totalWidth / rsum;\n\n  for (i = 0; i < len; i = i + 1) {\n    var fig = figures[i],\n        wid = ratios[i] * height / totalWidth * 100;\n    fig.style.width = wid + '%';\n  }\n\n  if (count == 1) {\n    var pcA = figures[0].querySelectorAll('.padding-cont');\n    pcA.forEach(function (pc) {\n      pc.removeAttribute('style');\n    });\n  }\n\n  cont.attr('data-paragraph-count', figures.length);\n  var grid = cont.closest('.block-grid');\n  var figs = grid != null ? grid.querySelectorAll('.item-figure') : null;\n\n  if (grid != null) {\n    grid.attr('data-paragraph-count', figs.length);\n  }\n};\n\nImages.prototype.blockGridRowTemplate = function (count) {\n  return _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(\"<div class=\\\"block-grid-row\\\" data-name=\\\"\".concat(_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateId(), \"\\\" data-paragraph-count=\\\"\").concat(count, \"\\\"></div>\"));\n};\n\nImages.prototype.blockGridTemplate = function (count) {\n  var ht = \"<figure class=\\\"block-content-inner block-grid item-text-default\\\" data-name=\\\"\".concat(_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateId(), \"\\\" >\\n  <div class=\\\"block-grid-row\\\" data-name=\\\"\").concat(_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateId(), \"\\\" data-paragraph-count=\\\"\").concat(count, \"\\\"></div>\\n  <figcaption class=\\\"block-grid-caption\\\" data-name=\\\"\").concat(_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateId(), \"\\\" data-placeholder-value=\\\"Type caption for image (optional)\\\"><span class=\\\"placeholder-text\\\">Type caption for image (optional)</span></figcaption>\\n  </figure>\");\n  return _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(ht);\n};\n\nImages.prototype.pushMultipleImageContainer = function (count, figure) {\n  var node;\n\n  if (typeof figure != 'undefined') {\n    node = figure;\n  } else if (document.querySelectorAll('.drop-placeholder').length) {\n    node = document.querySelector('.drop-placeholder');\n  } else {\n    node = this.current_editor.getNode();\n  }\n\n  if (node == null) {\n    return;\n  }\n\n  var parentContainer = node.closest('.block-content-inner');\n  var item = node.closest('.item');\n  var bottomContainer = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(\"<div class=\\\"\".concat(parentContainer.attr('class'), \"\\\"></div>\"));\n\n  while (item.nextElementSibling != null) {\n    bottomContainer.append(item.nextElementSibling);\n  }\n\n  var new_tmpl = this.blockGridTemplate(count);\n  parentContainer.insertAdjacentElement('afterend', new_tmpl); //new_tmpl.insertAfter(parentContainer);\n\n  new_tmpl.insertAdjacentElement('afterend', bottomContainer); //bottomContainer.insertAfter(new_tmpl);\n\n  this.addImagesInContainer = true;\n  bottomContainer.prepend(item);\n  this.current_editor.setRangeAt(document.querySelector('.item-selected'));\n  return new_tmpl.querySelector('.block-grid-row');\n};\n\nImages.prototype.uploadFile = function (file, node) {\n  if (!this.current_editor.image_options || !this.current_editor.image_options.upload) {\n    return;\n  }\n\n  var _this = this;\n\n  var formData = this.formatData(file);\n  this.current_editor.currentRequestCount++;\n  var oReq = new XMLHttpRequest();\n  oReq.open(\"POST\", this.current_editor.image_options.url, true);\n  oReq.onprogress = this.updateProgressBar;\n\n  oReq.onload = function (event) {\n    if (oReq.status == 200) {\n      _this.current_editor.currentRequestCount--;\n\n      try {\n        var resp = JSON.parse(oReq.responseText);\n\n        if (_this.current_editor.upload_callback) {\n          resp = _this.current_editor.upload_callback(resp);\n        }\n\n        _this.uploadCompleted(resp, node);\n      } catch (e) {\n        console.log('--- image upload issue ---');\n        console.error(e);\n\n        _this.current_editor.notifySubscribers('Katana.Error', e);\n      }\n    } else {\n      _this.current_editor.currentRequestCount--;\n    }\n  };\n\n  oReq.send(formData);\n};\n\nImages.prototype.updateProgressBar = function (e) {\n  var complete;\n  complete = \"\";\n\n  if (e.lengthComputable) {\n    complete = e.loaded / e.total * 100;\n    complete = complete != null ? complete : {\n      complete: 0\n    };\n    return _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].log(complete);\n  }\n};\n\nImages.prototype.uploadCompleted = function (ob, node) {\n  var ig = node.querySelector('img');\n\n  if (ig != null) {\n    ig.attr('data-image-id', ob.id);\n    var path = \"\".concat(this.image_cdn_path, \"/fullsize/\").concat(ob.file);\n    node.removeClass('item-uploading');\n    ig.attr('data-delayed-src', path);\n    return ig.attr('src', path);\n  }\n\n  return null;\n};\n\nImages.prototype._uploadCompleted = function (ob, node) {\n  var ig = node.querySelector('img');\n\n  if (ig != null) {\n    ig.attr('data-image-id', ob.id);\n    var path = \"\".concat(this.image_cdn_path, \"/fullsize/\").concat(ob.file);\n    return ig.attr('src', path);\n  }\n\n  return null;\n};\n/*\n  * Handles the behavior of deleting images when using the backspace key\n  *\n  * @param {Event} e    - The backspace event that is being handled\n  * @param {Node}  node - The node the backspace was used in, assumed to be from te editor's getNode() function\n  *\n  * @return {Boolean} true if this function handled the backspace event, otherwise false\n  */\n\n\nImages.prototype.handleBackspaceKey = function (e, anchor_node) {\n  var figure = document.querySelector(\".item-selected\");\n\n  if (figure != null && figure.hasClass(\"item-figure\") && (typeof anchor_node === \"undefined\" || anchor_node === null)) {\n    if (e.target.hasClass('figure-caption')) {\n      return true;\n    }\n\n    this.personal_toolbar.removeFigure(figure);\n    var ret = false;\n    e.preventDefault();\n    this.current_editor.image_toolbar.hide();\n    return true;\n  } else if (figure.hasClass('item-figure') && anchor_node && anchor_node.hasClass('item-figure') && e.target.tagName == \"FIGCAPTION\") {\n    var haveTextBefore = this.current_editor.getCharacterPrecedingCaret();\n\n    if (haveTextBefore.killWhiteSpace().length == 0) {\n      e.preventDefault();\n      this.current_editor.image_toolbar.hide();\n      this.personal_toolbar.removeFigure(figure);\n      return true;\n    }\n\n    return false;\n  }\n\n  return true;\n};\n\nImages.prototype.handleDeleteKey = function (e, node) {\n  var sel = document.querySelector('.item-selected');\n\n  if (sel != null && sel.hasClass('item-figure') && (!node || node.length == 0)) {\n    this.personal_toolbar.removeFigure(sel);\n    e.preventDefault();\n    this.current_editor.image_toolbar.hide();\n    return true;\n  }\n\n  if (node && node.length && _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].editableCaretAtEnd(node)) {\n    var next = node.nextElementSibling;\n\n    if (next != null && next.hasClass('item-figure') && !next.hasClass('figure-in-row')) {\n      this.personal_toolbar.removeFigure(next);\n      e.preventDefault();\n      this.current_editor.image_toolbar.hide();\n      _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].setCaretAtPosition(node, node.textContent.length);\n      return true;\n    }\n  }\n\n  return false;\n};\n\nImages.prototype.embedParagraphAboveImage = function (figure) {\n  var cont = figure.closest('.block-content-inner'),\n      self = this,\n      p = null,\n      createAndAddContainer = function createAndAddContainer(before) {\n    var div = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(self.current_editor.getSingleLayoutTempalte());\n    p = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(self.current_editor.baseParagraphTmpl());\n    div.appendChild(p);\n    before.parentNode.insertBefore(div, before);\n  };\n\n  if (cont != null) {\n    if (cont.hasClass('center-column')) {\n      // just embed a paragraph above it\n      p = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.baseParagraphTmpl());\n      figure.parentNode.insertBefore(p, figure);\n    } else if (cont.hasClass('full-width-column')) {\n      var figures = cont.querySelectorAll('.item-figure');\n\n      if (figures.length == 1) {\n        createAndAddContainer(cont);\n      } else {\n        var bottomContainer = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(\"<div class=\\\"block-content-inner full-width-column\\\"></div>\");\n\n        while (figure.nextElementSibling != null) {\n          bottomContainer.appendChild(figure.nextElementSibling);\n        }\n\n        _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].prependNode(figure, bottomContainer);\n        bottomContainer.insertAfter(cont);\n        createAndAddContainer(bottomContainer);\n      }\n    }\n  }\n\n  this.current_editor.mergeInnerSections(figure.closest('section'));\n\n  if (p != null) {\n    self.current_editor.image_toolbar.hide();\n    self.current_editor.markAsSelected(p);\n    self.current_editor.setRangeAt(document.querySelector('.item-selected'));\n  }\n};\n\nImages.prototype.handleEnterKey = function (e, node) {\n  var figure = document.querySelector('.figure-focused');\n\n  if (figure != null && figure.hasClass('item-figure')) {\n    e.preventDefault();\n    this.embedParagraphAboveImage(figure);\n    return true;\n  }\n\n  return true;\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Images);\n\n//# sourceURL=webpack:///./src/js/content/image.js?");

/***/ }),

/***/ "./src/js/content/index.js":
/*!*********************************!*\
  !*** ./src/js/content/index.js ***!
  \*********************************/
/*! exports provided: ContentBar, ImageContentBarItem, VideoContentBarItem, SectionContentBarItem, EmbedContentBarItem */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./core */ \"./src/js/content/core.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"ContentBar\", function() { return _core__WEBPACK_IMPORTED_MODULE_0__[\"default\"]; });\n\n/* harmony import */ var _image__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./image */ \"./src/js/content/image.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"ImageContentBarItem\", function() { return _image__WEBPACK_IMPORTED_MODULE_1__[\"default\"]; });\n\n/* harmony import */ var _video__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./video */ \"./src/js/content/video.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"VideoContentBarItem\", function() { return _video__WEBPACK_IMPORTED_MODULE_2__[\"default\"]; });\n\n/* harmony import */ var _section__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./section */ \"./src/js/content/section.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"SectionContentBarItem\", function() { return _section__WEBPACK_IMPORTED_MODULE_3__[\"default\"]; });\n\n/* harmony import */ var _embed__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./embed */ \"./src/js/content/embed.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"EmbedContentBarItem\", function() { return _embed__WEBPACK_IMPORTED_MODULE_4__[\"default\"]; });\n\n\n\n\n\n\n\n//# sourceURL=webpack:///./src/js/content/index.js?");

/***/ }),

/***/ "./src/js/content/section.js":
/*!***********************************!*\
  !*** ./src/js/content/section.js ***!
  \***********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _boot__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../boot */ \"./src/js/boot.js\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils */ \"./src/js/utils.js\");\n/* harmony import */ var _stream__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../stream */ \"./src/js/stream.js\");\n\n\n\n\nfunction Section(opts) {\n  this.opts = opts;\n  this.initialize = this.initialize.bind(this);\n  this.handleEnterKey = this.handleEnterKey.bind(this);\n  this.handleBackspaceKey = this.handleBackspaceKey.bind(this);\n  this.handleDeleteKey = this.handleDeleteKey.bind(this);\n  this.template = this.template.bind(this);\n  _boot__WEBPACK_IMPORTED_MODULE_0__[\"default\"].it(this, opts);\n}\n\nSection.prototype.contentId = 'SECTION';\n\nSection.prototype.initialize = function () {\n  var opts = this.opts;\n  this.icon = 'mfi-hyphens';\n  this.title = 'section';\n  this.action = 'section';\n  this.editorType = opts.editorType || 'blog';\n  this.publicationMode = this.editorType == 'publication' ? true : false;\n  this.current_editor = opts.editor;\n};\n\nSection.prototype.template = function () {\n  var t = function t(title, action, icon) {\n    return \"<button class='inlineTooltip-button scale' title='\" + title + \"' data-action='inline-menu-\" + action + \"' data-action-value='\" + action + \"' > <span class='tooltip-icon \" + icon + \"'></span> </button>\";\n  };\n\n  if (this.editorType == 'publication') {\n    var ht = '';\n    ht = t(this.title, this.action, this.icon);\n    ht = ht + t('Stories', 'section-stories', 'mfi-grid-icon');\n    return ht;\n  }\n\n  return t(this.title, this.action, this.icon);\n};\n\nSection.prototype.handleClick = function (ev, matched) {\n  var target = matched ? matched : ev.currentTarget;\n  var toolTipContainer = target.closest('.inlineContentOptions');\n  var actionValue = target.attr('data-action-value');\n  var storiesSection = false;\n\n  if (this.publicationMode) {\n    if (actionValue == 'section' && !toolTipContainer.hasClass('choose-section')) {\n      // show other options\n      toolTipContainer.addClass('choose-section');\n      return false;\n    } else if (actionValue == 'section-stories' && toolTipContainer.hasClass('choose-section')) {\n      // make a section\n      storiesSection = true;\n    }\n  }\n\n  var anchor_node = this.current_editor.getNode();\n\n  if (anchor_node == null) {\n    anchor_node = document.querySelectorAll('.item-selected');\n  }\n\n  if (anchor_node != null) {\n    this.splitContainer(anchor_node, storiesSection);\n    this.current_editor.content_bar.hide();\n    return true;\n  }\n\n  return false;\n};\n\nSection.prototype.handleDeleteKey = function (e, node) {\n  var sect, cont, last;\n\n  if (this.current_editor.isLastChar()) {\n    sect = node.closest('.block-content');\n\n    if (sect != null && !sect.hasClass('block-last')) {\n      cont = node.closest('.block-content-inner');\n\n      if (cont != null) {\n        last = cont.querySelector('.item:last-child');\n\n        if (last != null && last.attr('name') == node.attr('name')) {\n          e.preventDefault();\n          this.current_editor.mergeWithUpperSection(sect.next('.block-content'));\n          return true;\n        }\n      }\n    }\n  }\n\n  return true;\n};\n\nSection.prototype.handleBackspaceKey = function (e, node) {\n  var sect, cont, first;\n\n  if (this.current_editor.isFirstChar() && node) {\n    sect = node.closest('.block-content');\n\n    if (sect != null && !sect.hasClass('block-first')) {\n      var cont = node.closest('.block-content-inner');\n\n      if (cont != null) {\n        first = cont.querySelector('.item:first-child');\n\n        if (first != null && first.attr('name') == node.attr('name')) {\n          this.current_editor.mergeWithUpperSection(sect);\n\n          if (node != null) {\n            this.current_editor.setRangeAt(node);\n            e.preventDefault();\n\n            if (!node.hasClass('.item-figure')) {\n              _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].setCaretAtPosition(node);\n              this.current_editor.markAsSelected(node);\n            }\n          } else {\n            console.log('node empty');\n          }\n\n          return true;\n        }\n      }\n    }\n  } else {\n    var sect = document.querySelector('.figure-focused.with-background');\n\n    if (sect != null) {\n      var sel = this.current_editor.selection();\n\n      if (sel && sel.type == 'Caret') {\n        var anchorNode = sel.anchorNode;\n\n        if (anchorNode.hasClass('block-background')) {\n          e.preventDefault();\n          this.convertBackgroundSectionToPlain(anchorNode);\n          return true;\n        }\n      } else if (sel && sel.type == 'None') {\n        var anchorNode = sel.anchorNode;\n\n        if (anchorNode.hasClass('block-background')) {\n          e.preventDefault();\n          this.convertBackgroundSectionToPlain(anchorNode);\n          return true;\n        }\n      }\n    }\n  }\n\n  return false;\n};\n\nSection.prototype.convertBackgroundSectionToPlain = function (node) {\n  var sect = node.closest('.block-content');\n\n  if (sect != null) {\n    var newContainer = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.getSingleSectionTemplate());\n    var currentBody = sect.querySelector('.main-body');\n\n    if (newContainer != null) {\n      var newContainerBody = newContainer.querySelector('.main-body');\n      currentBody.parentNode.replaceChild(newContainerBody, currentBody);\n      sect.parentNode.replaceChild(newContainer, sect);\n      this.current_editor.removeUnnecessarySections();\n      this.current_editor.cleanUpInnerSections();\n      this.current_editor.fixSectionClasses();\n    }\n  }\n};\n\nSection.prototype.handleEnterKey = function (e, node) {\n  var prev = node.previousElementSibling,\n      onePrev = prev != null ? prev.previousElementSibling : null;\n\n  if (e.ctrlKey) {\n    // \n    if (node.querySelector('.placeholder-text') == null) {\n      this.splitContainer(node);\n      this.current_editor.content_bar.hide();\n      e.handled = true;\n      _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].setCaretAtPosition(node[0]);\n      this.current_editor.markAsSelected(node);\n      this.current_editor.scrollTo(node);\n    }\n  }\n\n  return false;\n};\n\nSection.prototype.fillPreview = function (container, count) {\n  if (typeof count == 'undefined') {\n    count = 6;\n  }\n\n  this.current_editor.fillStoryPreview(container, count);\n};\n\nSection.prototype.handlePreviousStoryTypeOptionsAfterAddition = function (newContainer) {\n  var stype = newContainer.querySelector('[data-for=\"storytype\"]');\n\n  if (stype != null) {\n    var stval = stype.value;\n\n    if (stval == 'tagged') {\n      // no issue just return from here\n      return;\n    }\n\n    var others = this.current_editor.elNode.querySelectorAll('.block-stories [data-for=\"storytype\"]');\n\n    for (var i = 0; i < others.length; i = i + 1) {\n      var ot = others[i];\n\n      if (ot == stype) {\n        continue;\n      }\n\n      var curral = ot.value;\n      var opts = ot.querySelectorAll('option');\n\n      if (opts.length) {\n        for (var m = 0; m < opts.length; m = m + 1) {\n          var kopts = opts[m];\n\n          if (kopts.attr('value') == stval && stval != curral) {\n            kopts.parentNode.removeChild(kopts);\n          }\n        }\n      }\n    }\n  }\n};\n\nSection.prototype.splitContainer = function (atNode, storiesSection) {\n  var newContainer;\n\n  if (typeof storiesSection != 'undefined' && storiesSection) {\n    newContainer = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.getSingleStorySectionTemplate());\n  } else {\n    newContainer = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.getSingleSectionTemplate());\n  }\n\n  this.current_editor.splitContainer(atNode);\n\n  if (this.publicationMode && storiesSection) {\n    if (atNode != null) {\n      var sec = atNode.closest('.block-content');\n\n      if (sec != null) {\n        newContainer.insertBefore(sec);\n      }\n\n      var ac = newContainer.querySelector('.autocomplete');\n\n      if (ac != null) {\n        //FIXME autocomplete\n        //(ac).autocomplete();\n        if (ac.closest('.autocomplete-buttons') != null) {\n          ac.closest('.autocomplete-buttons').addClass('hide');\n        }\n      }\n    }\n\n    this.fillPreview(newContainer.querySelector('.main-body'), 6);\n    this.handlePreviousStoryTypeOptionsAfterAddition(newContainer);\n  }\n\n  if (atNode.nextElementSibling != null && atNode.textContent.isEmpty()) {\n    var next = atNode.nextElementSibling;\n    this.current_editor.setRangeAt(next);\n\n    if (!next.hasClass('item-figure')) {\n      _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].setCaretAtPosition(next);\n      this.current_editor.markAsSelected(atNode);\n    }\n\n    atNode.parentNode.removeChild(atNode);\n  } else if (atNode.nextElementSibling == null) {\n    this.current_editor.setRangeAt(atNode);\n    _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].setCaretAtPosition(atNode);\n    this.current_editor.markAsSelected(atNode);\n  }\n}; // commands when in publication mode\n\n\nSection.prototype.command = function (action, button) {\n  var section = button.closest('.block-stories');\n\n  if (section == null) {\n    section = button.closest('.block-content');\n  }\n\n  if (section == null) {\n    return;\n  }\n\n  switch (action) {\n    case 'center-width':\n      this.commandCenterWidth(section);\n      break;\n\n    case 'add-width':\n      this.commandAddWidth(section);\n      break;\n\n    case 'full-width':\n      this.commandFullWidth(section);\n      break;\n\n    case 'remove-block':\n      this.commandRemoveBlock(section);\n      break;\n\n    case 'image-side':\n      this.commandStructureImageList(section);\n      break;\n\n    case 'image-grid':\n      this.commandStructureGrid(section);\n      break;\n\n    case 'list-view':\n      this.commandStructureListView(section);\n      break;\n  }\n};\n\nSection.prototype.removeStructureClasses = function (section) {\n  section.removeClass('as-list');\n  section.removeClass('as-image-grid');\n  section.removeClass('as-image-list');\n};\n\nSection.prototype.commandStructureGrid = function (section) {\n  this.removeStructureClasses(section);\n  section.addClass('as-image-grid');\n};\n\nSection.prototype.commandStructureImageList = function (section) {\n  this.removeStructureClasses(section);\n  section.addClass('as-image-list');\n};\n\nSection.prototype.commandStructureListView = function (section) {\n  this.removeStructureClasses(section);\n  section.addClass('as-list');\n};\n\nSection.prototype.removeLayoutClasses = function (section) {\n  section.removeClass('block-full-width');\n  section.removeClass('block-center-width');\n  section.removeClass('block-add-width');\n};\n\nSection.prototype.mightAdjustFigures = function (section) {\n  var _this = this;\n\n  var figs = section.querySelectorAll('.item-figure:not(.figure-in-row)');\n  figs.forEach(function (item) {\n    setTimeout(function () {\n      var cm = new CustomEvent('Mizuchi.Images.Refit', {\n        type: 'Mizuchi.Images.Refit',\n        figure: item\n      });\n\n      _this.current_editor.elNode.dispatchEvent(cm);\n    }, 250);\n  });\n};\n\nSection.prototype.commandCenterWidth = function (section) {\n  this.removeLayoutClasses(section);\n  section.addClass('block-center-width');\n  this.mightAdjustFigures(section);\n};\n\nSection.prototype.commandAddWidth = function (section) {\n  this.removeLayoutClasses(section);\n  section.addClass('block-add-width');\n  this.mightAdjustFigures(section);\n};\n\nSection.prototype.commandFullWidth = function (section) {\n  this.removeLayoutClasses(section);\n  section.addClass('block-full-width');\n  this.mightAdjustFigures(section);\n};\n\nSection.prototype.commandRemoveBlock = function (section) {\n  var needRefresh = section.hasClass('block-stories');\n  var val = '';\n\n  if (needRefresh) {\n    val = section.querySelector('[data-for=\"storytype\"]').value;\n\n    if (val == 'tagged') {\n      val = '';\n    }\n  }\n\n  if (section.next('section') == null && section.prev('section') == null) {\n    section.parentNode.removeChild(section);\n    this.current_editor.handleCompleteDeletion();\n  } else {\n    section.parentNode.removeChild(section);\n  }\n\n  if (this.current_editor.elNode.querySelector('.block-content') == null) {\n    this.current_editor.appendTextSection();\n  }\n\n  this.current_editor.fixSectionClasses();\n\n  if (needRefresh) {\n    this.current_editor.refreshStoriesMenus(val);\n  }\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Section);\n\n//# sourceURL=webpack:///./src/js/content/section.js?");

/***/ }),

/***/ "./src/js/content/video.js":
/*!*********************************!*\
  !*** ./src/js/content/video.js ***!
  \*********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _boot__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../boot */ \"./src/js/boot.js\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils */ \"./src/js/utils.js\");\n/* harmony import */ var _stream__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../stream */ \"./src/js/stream.js\");\n\n\n\n\nfunction Video(opts) {\n  this.opts = opts;\n  this.handleClick = this.handleClick.bind(this);\n  this.initialize = this.initialize.bind(this);\n  this.getEmbedFromNode = this.getEmbedFromNode.bind(this);\n  _boot__WEBPACK_IMPORTED_MODULE_0__[\"default\"].it(this, opts);\n}\n\nVideo.prototype.initialize = function () {\n  var opts = this.opts;\n  this.icon = opts.icon || \"mfi-video\";\n  this.title = opts.title || \"Add a video\";\n  this.action = opts.action || \"video\";\n  this.current_editor = opts.editor;\n};\n\nVideo.prototype.contentId = 'VIDEO';\n\nVideo.prototype.handleClick = function (ev) {\n  return this.displayEmbedPlaceHolder(ev);\n};\n\nVideo.prototype.isYoutubeLink = function (url) {\n  var p = /^(?:https?:\\/\\/)?(?:www\\.)?(?:youtu\\.be\\/|youtube\\.com\\/(?:embed\\/|v\\/|watch\\?v=|watch\\?.+&v=))((\\w|-){11})(?:\\S+)?$/;\n  var m = url.match(p);\n\n  if (url.match(p)) {\n    return m[0];\n  }\n\n  return false;\n};\n\nVideo.prototype.handleEnterKey = function (ev, node) {\n  if (node.hasClass(\"is-embedable\")) {\n    return this.getEmbedFromNode(node);\n  } else {\n    var text = node.textContent,\n        texts = text.split(' ');\n\n    if (texts.length == 1) {\n      var validLink = this.isYoutubeLink(texts[0]);\n\n      if (validLink) {\n        return this.getEmbedFromNode(node, validLink);\n      }\n    }\n  }\n};\n\nVideo.prototype.hide = function () {\n  this.current_editor.content_bar.hide();\n};\n\nVideo.prototype.uploadExistentIframe = function (iframe) {\n  var src = iframe.attr('src');\n\n  if (src) {\n    if (_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].urlIsFromDomain(src, 'youtube.com') || _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].urlIsFromDomain(src, 'vimeo.com')) {\n      this.loadEmbedDetailsFromServer(src, iframe, function (node) {\n        while (!(node.parentNode != null && node.parentNode.hasClass('block-content-inner'))) {\n          node.unwrap();\n        } // while(!node.parent().hasClass('block-content-inner')) {\n        //   node.unwrap();\n        // }      \n\n      });\n    }\n  }\n};\n\nVideo.prototype.displayEmbedPlaceHolder = function () {\n  var ph = this.current_editor.embed_placeholder;\n  this.node = this.current_editor.getNode();\n  this.node.innerHTML = ph;\n  this.node.addClass(\"is-embedable\");\n  this.current_editor.setRangeAt(this.node);\n  this.hide();\n  return false;\n};\n\nVideo.prototype.loadEmbedDetailsFromServer = function (url, current_node, callback) {\n  url = encodeURIComponent(url);\n  url = url + '&luxe=1';\n  this.current_editor.currentRequestCount++;\n  var xhr = new XMLHttpRequest();\n  xhr.open(\"POST\", '/embed-url', true);\n\n  xhr.onload = function () {\n    if (xhr.status == \"200\" && xhr.readyState == 4) {\n      try {\n        var resp = JSON.parse(xhr.responseText);\n        _this.current_editor.currentRequestCount--;\n\n        if (resp.success) {\n          var dt = resp.data;\n\n          if (dt.video) {\n            _this.embedFramePlaceholder(dt, current_node, callback);\n          }\n        }\n      } catch (e) {}\n    }\n  };\n\n  xhr.onerror = function () {\n    _this.current_editor.currentRequestCount--;\n  };\n\n  xhr.send({\n    url: url\n  });\n};\n\nVideo.prototype.embedFramePlaceholder = function (ob, current_node, callback) {\n  var thumb = ob.thumbUrl,\n      frameUrl = ob.frameUrl,\n      captionTitle = ob.captionTitle,\n      captionHref = ob.captionHref,\n      aspectRatio = ob.aspect,\n      canGoBackground = ob.fs;\n\n  if (thumb != '') {\n    var figure = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.getFrameTemplate()),\n        _this = this,\n        src = thumb,\n        img = new Image();\n\n    img.src = src;\n\n    img.onload = function () {\n      var ar;\n      ar = _this.getAspectRatio(this.width, this.height);\n      var pdc = figure.querySelector('.padding-cont'),\n          fim = figure.querySelector('.item-image'),\n          fpb = figure.querySelector('.padding-box');\n\n      if (pdc != null) {\n        pdc.css({\n          'max-width': ar.width,\n          'max-height': ar.height\n        });\n      }\n\n      if (fim != null) {\n        fim.attr(\"data-height\", this.height);\n        fim.attr(\"data-width\", this.width);\n      }\n\n      var fpdb = figure.querySelector('.padding-box');\n\n      if (fpdb != null) {\n        fpdb.style.paddingBotom = ar.ratio + \"%\";\n      }\n\n      if (this.width < 700) {\n        figure.addClass('n-fullSize');\n      }\n\n      var ig = figure.querySelector('img');\n\n      if (ig != null) {\n        ig.attr(\"src\", src);\n        ig.attr('data-frame-url', frameUrl);\n        ig.attr('data-frame-aspect', aspectRatio);\n        ig.attr('data-image-id', ob.embedId);\n      }\n\n      if (canGoBackground) {\n        figure.addClass('can-go-background');\n      }\n\n      figure.insertBefore(current_node);\n      current_node.parentNode.removeChild(current_node); // current_node.replaceWith(figure);\n\n      var caption = figure.querySelector('figcaption');\n\n      if (caption != null) {\n        var capth = ' <a rel=\"nofollow\" class=\"markup--anchor markup--figure-anchor\" data-href=\"' + captionHref + '\" href=\"' + captionHref + '\" target=\"_blank\">Watch Video here.</a>',\n            lastChar;\n\n        if (captionTitle != '') {\n          captionTitle = captionTitle.trim();\n          lastChar = captionTitle.charAt(captionTitle.length - 1);\n\n          if (lastChar != '.') {\n            captionTitle = captionTitle + '.';\n          }\n\n          capth = captionTitle + capth;\n        }\n\n        caption.innerHTML = capth;\n        figure.removeClass('item-text-default');\n      }\n\n      if (typeof callback != 'undefined') {\n        callback(figure);\n      }\n\n      _this.current_editor.selectFigure(figure);\n    };\n  }\n};\n\nVideo.prototype.getEmbedFromNode = function (node, extractedUrl) {\n  this.node = node;\n  this.node_name = this.node.attr(\"name\");\n  this.node.addClass(\"loading-embed\");\n  this.node.attr('contenteditable', 'false');\n  this.node.appendChild(_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement('<i class=\"loader small dark\"></i>'));\n  var url = typeof extractedUrl != 'undefined' ? extractedUrl : this.node.textContent,\n      canGoBackground = false;\n\n  if (url.indexOf('vimeo') != -1) {\n    url = url + '?badge=0&byline=0&portrait=0&title=0';\n    canGoBackground = true;\n  } else if (url.indexOf('youtube') != -1) {\n    url = url;\n    canGoBackground = true;\n  }\n\n  url = url + '&luxe=1';\n  this.loadEmbedDetailsFromServer(url, node);\n};\n\nVideo.prototype.getAspectRatio = function (w, h) {\n  var fill_ratio, height, maxHeight, maxWidth, ratio, result, width;\n  maxWidth = 760;\n  maxHeight = 700;\n  ratio = 0;\n  width = w;\n  height = h;\n\n  if (w < maxWidth) {\n    width = maxWidth;\n    var fr = w / h;\n    height = width / fr;\n  }\n\n  if (width > maxWidth) {\n    ratio = maxWidth / width;\n    height = height * ratio;\n    width = width * ratio;\n  } else if (height > maxHeight) {\n    ratio = maxHeight / height;\n    width = width * ratio;\n    height = height * ratio;\n  }\n\n  fill_ratio = height / width * 100;\n  result = {\n    width: width,\n    height: height,\n    ratio: fill_ratio\n  };\n  return result;\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Video);\n\n//# sourceURL=webpack:///./src/js/content/video.js?");

/***/ }),

/***/ "./src/js/editor.js":
/*!**************************!*\
  !*** ./src/js/editor.js ***!
  \**************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/js/utils.js\");\n/* harmony import */ var _stream__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./stream */ \"./src/js/stream.js\");\n/* harmony import */ var _polyfills__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./polyfills */ \"./src/js/polyfills.js\");\n/* harmony import */ var _boot__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./boot */ \"./src/js/boot.js\");\n/* harmony import */ var _tooltip__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./tooltip */ \"./src/js/tooltip.js\");\n/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./player */ \"./src/js/player.js\");\n/* harmony import */ var _toolbars_index__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./toolbars/index */ \"./src/js/toolbars/index.js\");\n/* harmony import */ var _content_index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./content/index */ \"./src/js/content/index.js\");\n/* harmony import */ var _models_factory__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./models/factory */ \"./src/js/models/factory.js\");\n/* harmony import */ var _notes_core__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./notes/core */ \"./src/js/notes/core.js\");\n/* harmony import */ var _cleaner__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./cleaner */ \"./src/js/cleaner.js\");\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n\n\n\n\n\n\n\n\n\n\n\nvar BACKSPACE = 8,\n    ESCAPE = 27,\n    TAB = 9,\n    ENTER = 13,\n    SPACEBAR = 32,\n    LEFTARROW = 37,\n    UPARROW = 38,\n    RIGHTARROW = 39,\n    DOWNARROW = 40,\n    DELETE = 46,\n    END_KEY = 35,\n    SINGLE_QUOTE_WHICH = 39,\n    DOUBLE_QUOTE_WHICH = 34,\n    DASH_WHICH = 45,\n    QUOTE_LEFT_UNICODE = \"\\u2018\",\n    QUOTE_RIGHT_UNICODE = \"\\u2019\",\n    DOUBLEQUOTE_LEFT_UNICODE = \"\\u201C\",\n    DOUBLEQUOTE_RIGHT_UNICODE = \"\\u201D\",\n    DASH_UNICODE = \"\\u2014\",\n    UNICODE_SPECIAL_CHARS = [QUOTE_LEFT_UNICODE, QUOTE_RIGHT_UNICODE, DOUBLEQUOTE_LEFT_UNICODE, DOUBLEQUOTE_RIGHT_UNICODE, DASH_UNICODE],\n    // number 1, number 2, number 3, Char C(center), char q(quote),\nNUMBER_HONE = 49,\n    NUMBER_HTWO = 50,\n    NUMBER_HTHREE = 51,\n    NUMBER_QUOTE = 52,\n    NUMBER_CODE_BLOCK = 53,\n    CHAR_CENTER = 69,\n    // E with Ctrl\nCHAR_LINK = 75,\n    // k for link\nSHORT_CUT_KEYS = [NUMBER_HONE, NUMBER_HTWO, NUMBER_HTHREE, NUMBER_QUOTE, NUMBER_CODE_BLOCK, CHAR_CENTER, CHAR_LINK];\n\nfunction Editor(opts) {\n  opts.node.wrap('<div class=\"editor-wrapper\"></div>');\n  this.opts = opts; // entry points\n\n  this.init = this.init.bind(this); // activate\n\n  this.destroy = this.destroy.bind(this); // deactivate\n  //streamer\n\n  this.streamer = _stream__WEBPACK_IMPORTED_MODULE_1__[\"default\"];\n  this.subscribe = this.subscribe.bind(this); // for subscription to events\n  //this.notifySubscribers = this.notifySubscribers.bind(this); // notify subscribers of events\n  // ui related\n\n  this.render = this.render.bind(this);\n  this.template = this.template.bind(this); //base methods\n\n  this.initialize = this.initialize.bind(this);\n  this.initContentOptions = this.initContentOptions.bind(this);\n  this.initTextToolbar = this.initTextToolbar.bind(this);\n  this.insertFancyChar = this.insertFancyChar.bind(this);\n  this.markAsSelected = this.markAsSelected.bind(this);\n  this.selectFigure = this.selectFigure.bind(this); // canvas related\n\n  this.parallaxCandidateChanged = this.parallaxCandidateChanged.bind(this); //event listeners\n\n  this.handlePaste = this.handlePaste.bind(this);\n  this.handleDrag = this.handleDrag.bind(this);\n  this.handleDrop = this.handleDrop.bind(this);\n  this.handleDragEnter = this.handleDragEnter.bind(this);\n  this.handleDragExit = this.handleDragExit.bind(this);\n  this.handleSelectionChange = this.handleSelectionChange.bind(this);\n  this.handleMouseUp = this.handleMouseUp.bind(this);\n  this.handleMouseDown = this.handleMouseDown.bind(this);\n  this.handleKeyUp = this.handleKeyUp.bind(this);\n  this.handleKeyDown = this.handleKeyDown.bind(this);\n  this.handleKeyPress = this.handleKeyPress.bind(this);\n  this.handleDblclick = this.handleDblclick.bind(this);\n  this.handlePress = this.handlePress.bind(this);\n  this.handleTap = this.handleTap.bind(this); // this.handleCopyEvent = this.handleCopyEvent.bind(this);\n  //image event listeners\n\n  this.handleGrafFigureSelectImg = this.handleGrafFigureSelectImg.bind(this);\n  this.handleGrafFigureTypeCaption = this.handleGrafFigureTypeCaption.bind(this);\n  this.handleImageActionClick = this.handleImageActionClick.bind(this); // section toolbar event listeners\n\n  this.handleSectionToolbarItemClicked = this.handleSectionToolbarItemClicked.bind(this);\n  this.handleSectionToolbarItemMouseUp = this.handleSectionToolbarItemMouseUp.bind(this);\n  this.handleSectionToolbarItemMouseDown = this.handleSectionToolbarItemMouseDown.bind(this);\n  this.handleSectionToolbarItemKeyUp = this.handleSectionToolbarItemKeyUp.bind(this);\n  this.handleSectionToolbarItemKeyDown = this.handleSectionToolbarItemKeyDown.bind(this);\n  this.handleSectionToolbarItemKeyPress = this.handleSectionToolbarItemKeyPress.bind(this);\n  this.handleSectionToolbarItemDblclick = this.handleSectionToolbarItemDblclick.bind(this);\n  this.handleSelectionStoryTypeChange = this.handleSelectionStoryTypeChange.bind(this);\n  this.handleSelectionStoryCountChange = this.handleSelectionStoryCountChange.bind(this);\n  this.displayPopOver = this.displayPopOver.bind(this);\n  this.hidePopOver = this.hidePopOver.bind(this); // notes\n\n  this.showNoteIcon = this.showNoteIcon.bind(this);\n  this.smallScreen = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getWindowWidth() <= 480 ? true : false;\n  this.segregateEvents();\n  this.isTouch = 'ontouchstart' in window || 'msmaxtouchpoints' in window.navigator;\n  this.isIOS = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].onIOS();\n  _boot__WEBPACK_IMPORTED_MODULE_3__[\"default\"].it(this, opts);\n}\n\n;\n\nEditor.prototype.segregateEvents = function () {\n  var mode = this.opts.mode || 'read';\n  var publication = this.opts.editorType == 'publication' ? true : false;\n\n  if (mode == 'read' || mode == 'edit') {\n    this.events = {\n      'mouseup': 'handleMouseUp',\n      'mousedown': 'handleMouseDown',\n      'dblclick': 'handleDblclick',\n      \"mouseover .markup-anchor\": \"displayPopOver\",\n      \"mouseout  .markup-anchor\": \"hidePopOver\",\n      \"click .item-controls i\": \"embedIFrameForPlayback\",\n      \"keydown .item-controls i\": \"playButtonPressedViaKeyboard\"\n    };\n\n    if (this.smallScreen) {\n      this.events[\"click .item\"] = \"showNoteIcon\";\n    } else {\n      if (!publication) {\n        this.events[\"mouseover .item\"] = \"showNoteIcon\";\n      }\n    }\n  } else if (mode == 'write') {\n    this.events = {\n      \"paste\": \"handlePaste\",\n      'mouseup': 'handleMouseUp',\n      'mousedown': 'handleMouseDown',\n      'keydown': 'handleKeyDown',\n      'keyup': 'handleKeyUp',\n      'keypress': 'handleKeyPress',\n      'dblclick': 'handleDblclick',\n      // 'copy':'handleCopyEvent',\n      \"click .item-controls-cont .action\": \"handleImageActionClick\",\n      \"click .markup-figure-anchor\": \"handleFigureAnchorClick\",\n      \"click .item-figure .padding-cont\": \"handleGrafFigureSelectImg\",\n      \"click .with-background .table-view\": \"handleGrafFigureSelectImg\",\n      \"keyup .item-figure .caption\": \"handleGrafFigureTypeCaption\",\n      'dragover': 'handleDrag',\n      'drop': 'handleDrop',\n      'dragenter': 'handleDragEnter',\n      'dragexit': 'handleDragExit',\n      \"mouseover .markup-anchor\": \"displayPopOver\",\n      \"mouseout  .markup-anchor\": \"hidePopOver\",\n      \"press .item\": \"handlePress\",\n      \"tap .item\": \"handleTap\"\n    };\n\n    if (publication) {\n      var o = {\n        'click .main-controls [data-action]': 'handleSectionToolbarItemClicked',\n        'dblclick .main-controls': 'handleSectionToolbarItemDblclick',\n        'mouseup .main-controls': 'handleSectionToolbarItemMouseUp',\n        'mousedown .main-controls': 'handleSectionToolbarItemMouseDown',\n        'keyup .main-controls': 'handleSectionToolbarItemKeyUp',\n        'keydown .main-controls': 'handleSectionToolbarItemKeyDown',\n        'keypress .main-controls': 'handleSectionToolbarItemKeyPress',\n        'change [data-for=\"storytype\"]': 'handleSelectionStoryTypeChange',\n        'change [data-for=\"storycount\"]': 'handleSelectionStoryCountChange'\n      };\n\n      for (var _i = 0, _Object$entries = Object.entries(o); _i < _Object$entries.length; _i++) {\n        var _Object$entries$_i = _slicedToArray(_Object$entries[_i], 2),\n            key = _Object$entries$_i[0],\n            val = _Object$entries$_i[1];\n\n        this.events[key] = val;\n      }\n    }\n  } else {\n    this.events = {};\n  }\n};\n\nEditor.prototype.subscribe = function (name, cb) {\n  this.streamer.subscribe(name, cb);\n};\n\nEditor.prototype.__selectionChangeFired = false;\n\nEditor.prototype.handleSelectionChange = function (ev) {\n  var _this2 = this;\n\n  var sel = document.getSelection();\n\n  if (sel.type == 'Range') {\n    ev.preventDefault();\n\n    if (!this.__selectionChangeFired) {\n      setTimeout(function () {\n        _this2.handleMouseUp(ev);\n\n        _this2.__selectionChangeFired = false;\n      }, 200);\n      this.__selectionChangeFired = true;\n    }\n  }\n};\n\nEditor.prototype.initialize = function () {\n  var opts = this.opts; // debug mode\n\n  window.debugMode = opts.debug || false;\n\n  if (window.debugMode) {\n    this.elNode.addClass(\"debug\");\n  }\n\n  this.mode = opts.mode || 'read'; // can be write/ edit/ read\n\n  this.editorType = opts.editorType || 'blog';\n  this.publicationMode = opts.editorType == 'publication' ? true : false;\n  this.base_content_options = opts.base_content_options || ['image', 'video', 'section'];\n  this.content_options = [];\n  this.current_node = null;\n  this.prev_current_node = null;\n  this.current_range = null;\n  this.image_options = opts.image ? opts.image : {\n    upload: true\n  };\n  this.embed_options = opts.embed ? opts.embed : {\n    enabled: false\n  };\n  this.json_quack = opts.json_quack;\n  var embedPlcStr = opts.placeholders && opts.placeholders.embed ? opts.placeholders.embed : 'Paste a YouTube video link, and press Enter';\n  var titlePlcStr = opts.placeholders && opts.placeholders.title ? opts.placeholders.title : 'Title here';\n  var subTitlePlcStr = opts.placeholders && opts.placeholders.subtitle ? opts.placeholders.subtitle : 'Start with introduction ..';\n  this.embed_placeholder = \"<span class='placeholder-text placeholder-text--root'>\".concat(embedPlcStr, \"</span><br>\"); //this.oembed_url = `http://iframe.ly/api/iframely?api_key=4afb3d8a83ee3fdb9ecf73&url=`;\n\n  this.title_placeholder = \"<span class=\\\"placeholder-text placeholder-text--root\\\" data-placeholder-text=\\\"\".concat(titlePlcStr, \"\\\">\").concat(titlePlcStr, \"</span><br>\");\n  this.subtitle_placeholder = \"<span class=\\\"placeholder-text placeholder-text--root\\\" data-placeholder-text=\\\"\".concat(subTitlePlcStr, \"\\\">\").concat(subTitlePlcStr, \"</span><br>\");\n  this.sectionsForParallax = [];\n  this.parallax = null;\n  this.parallaxContext = null;\n  this.currentRequestCount = 0;\n  this.commentable = opts.commentable || false;\n  this.notes_options = opts.notes || {};\n  this.paste_element = document.createElement('div');\n  this.elNode.closest('.editor-wrapper').appendChild(this.paste_element); //this.streamHandlers = {};\n\n  return this;\n};\n\nEditor.prototype.destroy = function () {};\n\nEditor.prototype.init = function (cb) {\n  var _this3 = this;\n\n  this.render(cb);\n\n  if (this.mode == 'write') {\n    this.elNode.attr('contenteditable', true);\n    this.elNode.addClass('editable');\n  } else {\n    this.elNode.removeAttribute(\"contenteditable\");\n    var ces = this.elNode.querySelectorAll('[contenteditable]');\n    ces.forEach(function (cel) {\n      cel.removeAttribute('contenteditable');\n    });\n    var mfps = this.elNode.querySelectorAll('.mfi-play');\n    mfps.forEach(function (mf) {\n      mf.attr('tabindex', '0');\n    });\n  }\n\n  this.appendToolbars();\n  this.appendParallax();\n\n  if (this.mode == 'write') {\n    var enabled = this.opts && typeof this.opts.enableDraft !== 'undefined' ? this.opts.enableDraft : true;\n\n    if (enabled) {\n      this.committer = new _models_factory__WEBPACK_IMPORTED_MODULE_8__[\"default\"]({\n        editor: this,\n        mode: 'write'\n      });\n      this.committer.manage(true);\n    }\n  }\n\n  if (this.notes_options.commentable) {\n    var winWidth = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getWindowWidth();\n    var layout = winWidth <= 480 ? 'popup' : 'side';\n    this.notesManager = new _notes_core__WEBPACK_IMPORTED_MODULE_9__[\"default\"]({\n      editor: this,\n      notes: [],\n      info: this.notes_options,\n      layout: layout,\n      node: document.querySelector('#notes_container')\n    });\n    this.notesManager.init();\n  }\n\n  if (this.mode == 'write') {\n    this.removeUnwantedSpans();\n    setTimeout(function () {\n      _this3.addFigureControls();\n    }, 200);\n  }\n\n  if (this.mode == 'read') {\n    _player__WEBPACK_IMPORTED_MODULE_5__[\"default\"].manage(this.opts.video);\n  }\n\n  if (this.mode == 'write') {\n    setTimeout(function () {//this.mutationHandler = new MutationOb\n    }, 300);\n  }\n\n  setTimeout(function () {\n    _this3.addBlanktoTargets();\n  }, 200);\n  this.addEmptyClass();\n\n  if (this.isIOS) {\n    document.addEventListener('selectionchange', this.handleSelectionChange);\n  }\n};\n\nEditor.prototype.addBlanktoTargets = function () {\n  var anchors = this.elNode.querySelectorAll('a');\n  anchors.forEach(function (item) {\n    if (!item.hasAttribute('target')) {\n      item.attr('target', '_blank');\n    }\n  });\n};\n\nEditor.prototype.addEmptyClass = function () {};\n\nEditor.prototype.setInitialFocus = function () {\n  var items = this.elNode.querySelectorAll('.item');\n\n  if (items.length >= 2) {\n    var first = items[0],\n        sec = items[1],\n        toFocus = false,\n        toolTip = false;\n\n    if (first.querySelectorAll('.placeholder-text').length && sec.querySelectorAll('.placeholder-text').length) {\n      toFocus = items[1];\n      toolTip = true;\n    } else {\n      toFocus = items[0];\n    }\n\n    if (toFocus) {\n      var _this = this;\n\n      _this.markAsSelected(toFocus);\n\n      _this.setRangeAt(toFocus);\n\n      if (toolTip) {\n        _this.displayTooltipAt(toFocus);\n      }\n    }\n  }\n};\n\nEditor.prototype.appendParallax = function () {\n  var art = this.elNode.closest('body');\n\n  if (art != null) {\n    if (document.querySelector('.parallax') != null) {\n      return;\n    }\n\n    var cv = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(\"<canvas class=\\\"parallax\\\"></canvas>\"),\n        handled = false,\n        resizeHandler;\n    cv.attr('width', _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getWindowWidth());\n    cv.attr('height', _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getWindowHeight());\n    art.insertBefore(cv, art.firstElementChild);\n\n    var _this = this;\n\n    resizeHandler = function resizeHandler() {\n      if (!handled) {\n        setTimeout(function () {\n          _this.resized();\n\n          handled = false;\n        }, 60);\n        handled = true;\n      }\n    };\n\n    window.addEventListener('resize', resizeHandler);\n    this.parallax = cv;\n    this.parallaxContext = cv.getContext('2d');\n    this.parallaxCandidateChanged();\n  }\n};\n\nEditor.prototype.resized = function () {\n  if (this.parallax) {\n    var wnW = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getWindowWidth(),\n        wnH = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getWindowHeight();\n    this.parallax.attr('width', wnW);\n    this.parallax.attr('height', wnH);\n    this.checkViewPortForCanvas();\n  }\n};\n\nEditor.prototype.appendToolbars = function () {\n  this.initTextToolbar();\n\n  if (this.base_content_options.length > 0 && this.mode == 'write') {\n    this.initContentOptions();\n  }\n\n  ;\n  this.tooltip = new _tooltip__WEBPACK_IMPORTED_MODULE_4__[\"default\"]({\n    editor: this,\n    node: document.querySelector('body')\n  });\n  this.tooltip.render().hide();\n};\n\nEditor.prototype.initTextToolbar = function () {\n  var editorWrapper = this.elNode.closest('.editor-wrapper');\n  var toolbarNode = editorWrapper.querySelector('.mf-toolbar-base');\n\n  if (toolbarNode == null) {\n    var tbHt = \"<div class='mf-menu mf-toolbar-base mf-toolbar hide' ></div>\";\n    var tbEl = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(tbHt);\n    toolbarNode = this.elNode.insertAdjacentElement('afterend', tbEl);\n  }\n\n  if (this.text_toolbar == null) {\n    this.text_toolbar = new _toolbars_index__WEBPACK_IMPORTED_MODULE_6__[\"TextToolbar\"]({\n      node: toolbarNode,\n      editor: this,\n      mode: this.mode\n    });\n  }\n\n  this.toolbar = this.text_toolbar;\n  return this.text_toolbar;\n};\n\nEditor.prototype.initContentOptions = function () {\n  var base_options = this.base_content_options;\n  var editorWrapper = this.elNode.closest('.editor-wrapper');\n\n  if (base_options.indexOf(\"image\") >= 0) {\n    var toolbarNode = editorWrapper.querySelector('.mf-toolbar-base-image');\n\n    if (toolbarNode == null) {\n      var igTb = \"<div class='mf-menu mf-toolbar-base mf-toolbar-base-image mf-toolbar hide'></div>\";\n      var igEl = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(igTb);\n      toolbarNode = this.elNode.insertAdjacentElement('afterend', igEl);\n    }\n\n    this.image_toolbar = new _toolbars_index__WEBPACK_IMPORTED_MODULE_6__[\"ImageToolbar\"]({\n      node: toolbarNode,\n      editor: this,\n      mode: this.mode\n    });\n    this.image_toolbar.render().hide();\n    var opt = new _content_index__WEBPACK_IMPORTED_MODULE_7__[\"ImageContentBarItem\"]({\n      editor: this,\n      toolbar: this.image_toolbar\n    });\n    this.image_toolbar.setController(opt);\n    this.content_options.push(opt);\n    this.image_uploader = opt;\n  }\n\n  if (base_options.indexOf(\"video\") >= 0) {\n    var opt = new _content_index__WEBPACK_IMPORTED_MODULE_7__[\"VideoContentBarItem\"]({\n      editor: this\n    });\n    this.content_options.push(opt);\n    this.video_uploader = opt;\n  }\n\n  if (base_options.indexOf(\"section\") >= 0) {\n    var opt = new _content_index__WEBPACK_IMPORTED_MODULE_7__[\"SectionContentBarItem\"]({\n      editor: this,\n      mode: this.mode,\n      editorType: this.editorType\n    });\n    this.content_options.push(opt);\n    this.section_options = opt;\n  }\n\n  if (base_options.indexOf(\"embed\") >= 0) {\n    var opt = new _content_index__WEBPACK_IMPORTED_MODULE_7__[\"EmbedContentBarItem\"]({\n      editor: this,\n      mode: this.mode\n    });\n    this.embed_options = opt;\n    this.content_options.push(opt);\n  }\n\n  var contentBaseNode = editorWrapper.querySelector('.inlineContentOptions');\n\n  if (contentBaseNode == null) {\n    var coEl = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(\"<div class='inlineContentOptions inlineTooltip' id='mfContentBase'></div>\");\n    contentBaseNode = this.elNode.insertAdjacentElement('afterend', coEl);\n  }\n\n  this.content_bar = new _content_index__WEBPACK_IMPORTED_MODULE_7__[\"ContentBar\"]({\n    node: contentBaseNode,\n    editor: this,\n    widgets: this.content_options\n  });\n  this.content_bar.render();\n};\n\nEditor.prototype.render = function (cb) {\n  var _this4 = this;\n\n  if (this.elNode.innerHTML.trim() == '') {\n    this.elNode.appendChild(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.template()));\n\n    if (this.publicationMode) {\n      var bd = this.elNode.querySelector('.block-stories .main-body'); //TODO add autocomplete dependency\n      //$(this.elNode.querySelector('.autocomplete')).autocomplete();\n\n      this.fillStoryPreview(bd, 6);\n      var lsect = this.elNode.querySelector('section:last-child .main-body');\n\n      if (lsect != null) {\n        lsect.appendChild(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(\"<div class=\\\"block-content-inner center-column\\\"><p class=\\\"item item-p\\\" name=\\\"\".concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"\\\"><br /></p></div>\")));\n      }\n    }\n\n    return setTimeout(function () {\n      _this4.setInitialFocus();\n\n      if (cb) {\n        cb();\n      }\n    }, 100);\n  } else {\n    return this.parseInitialContent(cb);\n  }\n};\n\nEditor.prototype.parseInitialContent = function (cb) {\n  if (this.mode == 'read') {\n    cb();\n    return this;\n  }\n\n  var _this = this;\n\n  this.setupElementsClasses(this.elNode.querySelectorAll('.block-content-inner'), function () {\n    if (_this.mode == 'write') {\n      var figures = _this.elNode.querySelectorAll('.item-figure');\n\n      figures.forEach(function (item) {\n        if (item.hasClass('figure-in-row')) {\n          var cont = item.closest('.block-grid');\n          var caption = cont.querySelector('.block-grid-caption');\n\n          if (caption == null) {\n            var t = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(_this.figureCaptionTemplate(true));\n            t.removeClass('figure-caption');\n            t.addClass('block-grid-caption');\n            cont.appendChild(t);\n            caption = cont.querySelector('.block-grid-caption');\n          }\n\n          caption.attr('contenteditable', true);\n        } else {\n          var caption = item.querySelector('figcaption');\n\n          if (caption == null) {\n            item.appendChild(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(_this.figureCaptionTemplate()));\n            caption = item.querySelector('figcaption');\n            item.addClass('item-text-default');\n          }\n\n          caption.attr('contenteditable', true);\n\n          if (caption.textContent.killWhiteSpace().length == 0) {\n            var txt = 'Type caption for image(Optional)';\n            var sp = document.createElement('span');\n            sp.addClass('placeholder-text');\n            sp.attr('data-placeholder-value', txt);\n            sp.innerHTML = txt;\n            caption.appendChild(sp);\n            item.addClass('item-text-default');\n          }\n        }\n      });\n\n      var bgSections = _this.elNode.querySelectorAll('.with-background');\n\n      bgSections.forEach(function (item) {\n        var cellVs = item.querySelectorAll('.table-cell-view');\n        cellVs.forEach(function (cev) {\n          cev.attr('contenteditable', 'false');\n        });\n        var mainB = item.querySelectorAll('.main-body');\n        mainB.forEach(function (mb) {\n          mb.attr('contenteditable', 'true');\n        });\n      });\n    }\n\n    _this.addPlaceholdersForBackgrounds();\n\n    _this.setupFirstAndLast();\n\n    _this.setUpStoriesToolbar();\n\n    _this.setInitialFocus();\n\n    cb();\n  });\n};\n\nEditor.prototype.setUpStoriesToolbar = function () {\n  if (!this.publicationMode) {\n    return;\n  }\n\n  var sects = this.elNode.querySelectorAll('section');\n\n  if (sects.length) {\n    for (var i = 0; i < sects.length; i = i + 1) {\n      var section = sects[i];\n      var body = section.querySelector('.main-body');\n      var toolbar;\n\n      if (!section.hasClass('block-add-width') && !section.hasClass('block-full-width')) {\n        section.addClass('block-center-width');\n      }\n\n      if (section.hasClass('block-stories')) {\n        toolbar = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.getStoriesSectionMenu(true));\n        var name = section.attr('name');\n        var obName = window['ST_' + name];\n        var count = 6,\n            stType = 'featured',\n            tagValue = '';\n\n        if (obName) {\n          count = obName.storyCount;\n          stType = obName.storyType;\n\n          if (typeof obName.storyTag != 'undefined') {\n            tagValue = obName.storyTag;\n          }\n        }\n\n        this.fillStoryPreview(body, count);\n        var tStCount = toolbar.querySelector('[data-for=\"storycount\"]');\n\n        if (tStCount != null) {\n          tStCount.value = count;\n        }\n\n        var tStType = toolbar.querySelector('[data-for=\"storytype\"]');\n\n        if (tStType != null) {\n          tStType.value = stType;\n        }\n\n        var auto = toolbar.querySelector('.autocomplete');\n        auto.autocomplete({\n          threshold: 2,\n          behave: 'buttons',\n          type: 'tag'\n        });\n        var tagInpt = toolbar.querySelector('[data-for=\"tagname\"]');\n\n        if (stType == 'tagged') {\n          tagInpt.closest('.autocomplete-buttons').removeClass('hide');\n          auto.autocomplete({\n            action: 'set',\n            data: JSON.parse(tagValue)\n          });\n        } else {\n          tagInpt.closest('.autocomplete-buttons').addClass('hide');\n        }\n\n        toolbar.insertBefore(body);\n      } else {\n        toolbar = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.getStoriesSectionMenu(false));\n        toolbar.insertBefore(body);\n      }\n    }\n  }\n};\n\nEditor.prototype.addFigureControls = function () {\n  var _this5 = this;\n\n  var imageFigures = document.querySelectorAll('.item-figure:not(.item-iframe)');\n  imageFigures.forEach(function (item) {\n    var temp = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(_this5.getImageFigureControlTemplate());\n    var img = item.querySelector('img');\n\n    if (img != null) {\n      img.insertAfter(temp);\n    }\n  });\n};\n\nEditor.prototype.addPlaceholdersForBackgrounds = function () {\n  var backgrounds = this.elNode.querySelectorAll('.with-background');\n\n  if (backgrounds.length) {}\n};\n\nEditor.prototype.backgroundSectionPlaceholder = function () {\n  var ht = '<h';\n};\n\nEditor.prototype.getPlaceholders = function () {\n  var ht = \"<h3 class=\\\"item item-h3 item-first\\\" name=\\\"\".concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"\\\">\").concat(this.title_placeholder, \"</h3>\\n  <p class=\\\"item item-p item-last\\\" name=\\\"\").concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"\\\">\").concat(this.subtitle_placeholder, \"</p>\");\n  return ht;\n};\n\nEditor.prototype.getSingleLayoutTempalte = function () {\n  return \"<div class=\\\"block-content-inner center-column\\\"></div>\";\n};\n\nEditor.prototype.getSingleSectionTemplate = function () {\n  var ht = \"<section class=\\\"block-content\\\" name=\\\"\".concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"\\\">\\n    <div class=\\\"main-divider\\\" contenteditable=\\\"false\\\"><hr class=\\\"divider-line\\\" tabindex=\\\"-1\\\"></div>\\n    <div class=\\\"main-body\\\">\\n    </div>\\n    </section>\");\n  return ht;\n};\n\nEditor.prototype.getSingleStorySectionTemplate = function () {\n  var existingSects = this.elNode.querySelectorAll('.block-stories'),\n      excludes = [];\n\n  if (existingSects.length) {\n    for (var i = 0; i < existingSects.length; i = i + 1) {\n      var sec = existingSects[i];\n      var select = sec.querySelector('[data-for=\"storytype\"]');\n\n      if (select != null) {\n        var val = select.value;\n\n        if (val != 'tagged') {\n          excludes.push(val);\n        }\n      }\n    }\n  }\n\n  var ht = \"<section class=\\\"block-stories block-add-width as-image-list\\\" name=\\\"\".concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"\\\" data-story-count=\\\"6\\\">\\n      <div class=\\\"main-divider\\\" contenteditable=\\\"false\\\"><hr class=\\\"divider-line\\\" tabindex=\\\"-1\\\"></div>\\n      \").concat(this.getStoriesSectionMenu(true, excludes), \"\\n      <div class=\\\"main-body\\\">\\n      </div>\\n      </section>\");\n  return ht;\n};\n\nEditor.prototype.getStoryPreviewTemplate = function () {\n  var ht = \"<div class=\\\"st-pre\\\" >\\n      <div class=\\\"st-img\\\"></div>\\n      <div class=\\\"st-title\\\"></div>\\n      <div class=\\\"st-sub\\\"></div>\\n      <div class=\\\"st-sub2\\\"></div>\\n      </div>\";\n  return ht;\n};\n\nEditor.prototype.fillStoryPreview = function (container, count) {\n  count = typeof count == 'undefined' || isNaN(count) ? 6 : count;\n  var ht = \"<div class=\\\"center-column\\\" contenteditable=\\\"false\\\">\";\n\n  for (var i = 0; i < count; i = i + 1) {\n    ht += this.getStoryPreviewTemplate();\n  }\n\n  ht += \"</div>\";\n  container.innerHTML = ht;\n};\n\nEditor.prototype.menuOpts = [['featured', 'Featured'], ['latest', 'Latest'], ['tagged', 'Tagged as']];\n\nEditor.prototype.getStoriesSectionMenu = function (forStories, exclude) {\n  var fs = typeof forStories == 'undefined' ? true : forStories,\n      ht = \"<div class=\\\"main-controls '\".concat(fs ? \"story-mode\" : \"plain-mode\", \"\\\" contenteditable=\\\"false\\\">\\n        <div class=\\\"main-controls-inner center-column\\\">\\n        <select data-for=\\\"storytype\\\">\");\n  var opts = '';\n  var excludeOpts = typeof exclude != 'undefined' ? exclude : [];\n\n  for (var i = 0; i < this.menuOpts.length; i = i + 1) {\n    var menu = this.menuOpts[i];\n\n    if (excludeOpts.indexOf(menu[0]) == -1) {\n      opts += \"<option value=\\\"\".concat(menu[0], \"\\\">\").concat(menu[1], \"</option>\");\n    }\n  }\n\n  ht += opts;\n  ht += \"</select>';\\n    <input type=\\\"text\\\" class=\\\"text-small autocomplete\\\" data-behave=\\\"buttons\\\" data-type=\\\"tag\\\" data-for=\\\"tagname\\\" placeholder=\\\"Tag name here\\\"></input>\\n    <input type=\\\"number\\\" class=\\\"text-small\\\" data-for=\\\"storycount\\\" value=\\\"6\\\" min=\\\"4\\\" max=\\\"10\\\"></input>\\n    <div class=\\\"right\\\">\\n    <div class=\\\"main-controls-structure\\\">\\n    <i class=\\\"mfi-text-left\\\" data-action=\\\"list-view\\\"></i>\\n    <i class=\\\"mfi-photo\\\" data-action=\\\"image-grid\\\"></i>\\n    </div>\\n    <div class=\\\"main-controls-layout\\\">\";\n\n  if (!fs) {\n    ht += \"<i class=\\\"mfi-image-default\\\" data-action=\\\"center-width\\\"></i>\";\n  }\n\n  ht += \"<i class=\\\"mfi-image-add-width\\\" data-action=\\\"add-width\\\"></i>\\n    <i class=\\\"mfi-image-full-width\\\" data-action=\\\"full-width\\\"></i>\\n    <i class=\\\"mfi-cross left-spaced\\\" data-action=\\\"remove-block\\\"></i>\\n    </div>\\n    </div>\\n    </div>\\n    </div>\";\n  return ht;\n};\n\nEditor.prototype.getImageFigureControlTemplate = function () {\n  var ht = \"<div class='item-controls-cont'>\\n  <div class='item-controls-inner'>\\n  <i class='mfi-arrow-up action' data-action='goup' title='Move image up'></i>\\n  <i class='mfi-arrow-left action' data-action='goleft' title='Move image to left'></i>\\n  <i class='mfi-arrow-right action' data-action='goright' title='Move image to right'></i>\\n  <i class='mfi-cross action' data-action='remove' title='Remove image'></i>\\n  <i class='mfi-carriage-return action' data-action='godown' title='Move image to next line'></i>\\n  <i class='mfi-plus action' data-action='addpic' title='Add photo here'></i>\\n  <div class='extend-button action' data-action='stretch' title='Stretch to full width'><i class='mfi-extend-in-row'></i></div>\\n  </div>\\n  </div>\";\n  return ht;\n};\n\nEditor.prototype.getFigureTemplate = function () {\n  var ht = \"<figure contenteditable='false' class='item item-figure item-text-default' name='\".concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"' tabindex='0'>\\n  <div style='' class='padding-cont'> \\n  <div style='padding-bottom: 100%;' class='padding-box'></div> \\n  <img src='' data-height='' data-width='' data-image-id='' class='item-image' data-delayed-src='' /> \\n  \").concat(this.getImageFigureControlTemplate(), \"\\n  </div> \\n  <figcaption contenteditable='true' data-placeholder-value='Type caption for image (optional)' class='figure-caption caption'>\\n  <span class='placeholder-text'>Type caption for image (optional)</span> <br> \\n  </figcaption> \\n  </figure>\");\n  return ht;\n};\n\nEditor.prototype.figureCaptionTemplate = function (multiple) {\n  var plc = typeof multiple != 'undefined' ? \"Type caption for images(optional)\" : \"Type caption for image(optional)\";\n  var ht = \"<figcaption contenteditable='true' data-placeholder-value='\".concat(plc, \"' class='figure-caption caption'>\\n    <span class=\\\"placeholder-text\\\">\").concat(plc, \"<span> <br />\\n    </figcaption>\");\n  return ht;\n};\n\nEditor.prototype.getFrameTemplate = function () {\n  var ht = \"<figure contenteditable='false' class='item item-figure item-iframe item-first item-text-default' name='\".concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"' tabindex='0'>\\n  <div class='iframeContainer'>\\n  <div style='' class='padding-cont'> \\n  <div style='padding-bottom: 100%;' class='padding-box'>\\n  </div>\\n  <img src='' data-height='' data-width='' data-image-id='' class='item-image' data-delayed-src=''> \\n  </div> \\n  <div class='item-controls ignore'>\\n  <i class='mfi-icon mfi-play'></i>\\n  </div>\\n  </div> \\n  <figcaption contenteditable='true' data-placeholder-value='Type caption for video (optional)' class='figure-caption caption'>\\n  <span class='placeholder-text'>Type caption for video (optional)</span>\\\"\\n  </figcaption> \\n  </figure>\");\n  return ht;\n};\n\nEditor.prototype.template = function () {\n  if (this.publicationMode) {\n    var ht = \"<section class='block-content block-first block-last block-center-width' name='\".concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"'>\\n          <div class='main-divider' contenteditable='false'>\\n            <hr class='divider-line' tabindex='-1'/>\\n          </div> \\n        \").concat(this.getStoriesSectionMenu(), \"\\n        <div class='main-body'>  \\n        <div class='block-content-inner center-column'>\").concat(this.getPlaceholders(), \"</div> </div> </section>\\n        \").concat(this.getSingleStorySectionTemplate(), \"\\n        \").concat(this.getSingleSectionTemplate());\n    return ht;\n  }\n\n  var ht = \"<section class='block-content block-first block-last' name='\".concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"'>\\n    <div class='main-divider' contenteditable='false'>\\n      <hr class='divider-line' tabindex='-1'/>\\n    </div>\\n    <div class='main-body'>\\n      <div class='block-content-inner center-column'>\").concat(this.getPlaceholders(), \"</div>\\n    </div>\\n    </section>\");\n  return ht;\n};\n\nEditor.prototype.templateBackgroundSectionForImage = function () {\n  var ht = \"<section name=\\\"\".concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"\\\" class=\\\"block-content block-image image-in-background with-background\\\">\\n  <div class=\\\"block-background\\\" data-scroll=\\\"aspect-ratio-viewport\\\" contenteditable=\\\"false\\\" data-image-id=\\\"\\\" data-width=\\\"\\\" data-height=\\\"\\\">\\n  <div class=\\\"block-background-image\\\" style=\\\"display:none;\\\"></div>\\n  </div>\\n  <div class=\\\"table-view\\\">\\n  <div class=\\\"table-cell-view\\\" contenteditable=\\\"false\\\">\\n  <div class=\\\"main-body\\\" contenteditable=\\\"true\\\">\\n  <div class=\\\"block-content-inner center-column\\\">\\n  <h2 name=\\\"\").concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"\\\" class=\\\"item item-h2 item-text-default item-first item-selected\\\" data-placeholder-value=\\\"Continue writing\\\">\\n  <span class=\\\"placeholder-text\\\">Continue writing</span><br>\\n  </h2>\\n  </div></div>\\n  </div></div>\\n  <div class=\\\"block-caption\\\">\\n  <label name=\\\"\").concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"\\\" data-placeholder-value=\\\"Type caption \\\" class=\\\"section-caption item-text-default item-last\\\">\\n  <span class=\\\"placeholder-text\\\">Type caption </span><br>\\n  </label>\\n  </div>\\n  </section>\");\n  return ht;\n};\n\nEditor.prototype.templateBackgroundSectionForVideo = function () {\n  var ht = \"<section name=\\\"\".concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"\\\" class=\\\"block-content video-in-background block-image image-in-background with-background\\\">\\n  <div class=\\\"block-background\\\" data-scroll=\\\"aspect-ratio-viewport\\\" contenteditable=\\\"false\\\" data-image-id=\\\"\\\" data-width=\\\"\\\" data-height=\\\"\\\">\\n  <div class=\\\"block-background-image\\\" style=\\\"display:none;\\\"></div>\\n  </div>\\n  <div class=\\\"table-view\\\">\\n  <div class=\\\"table-cell-view\\\" contenteditable=\\\"false\\\">\\n  <div class=\\\"main-body\\\" contenteditable=\\\"true\\\">\\n  <div class=\\\"block-content-inner center-column\\\">\\n  <h2 name=\\\"\").concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"\\\" class=\\\"item item-h2 item-text-default item-first item-selected\\\" data-placeholder-value=\\\"Continue writing\\\" data-scroll=\\\"native\\\">\\n  <span class=\\\"placeholder-text\\\">Continue writing</span><br>\\n  </h2>\\n  </div></div>\\n  </div></div>\\n  <div class=\\\"block-caption\\\">\\n  <label name=\\\"\").concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"\\\" data-placeholder-value=\\\"Type caption \\\" class=\\\"section-caption item-text-default item-last\\\">\\n  <span class=\\\"placeholder-text\\\">Type caption </span><br>\\n  </label>\\n  </div>\\n  </section>\");\n  return ht;\n};\n\nEditor.prototype.baseParagraphTmpl = function () {\n  return \"<p class='item item-p' name='\".concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"'><br></p>\");\n};\n\nEditor.prototype.hideImageToolbar = function () {\n  if (this.image_toolbar) {\n    this.image_toolbar.hide();\n  }\n};\n\nEditor.prototype.hideContentBar = function () {\n  if (this.content_bar) {\n    this.content_bar.hide();\n  }\n}; // DOM related methods //\n\n\nEditor.prototype.getSelectedText = function () {\n  var text = \"\";\n\n  if (typeof window.getSelection !== \"undefined\") {\n    text = window.getSelection().toString();\n  } else if (typeof document.selection !== \"undefined\" && document.selection.type === \"Text\") {\n    text = document.selection.createRange().text;\n  }\n\n  return text;\n};\n\nEditor.prototype.selection = function () {\n  if (window.getSelection) {\n    return window.getSelection();\n  } else if (document.selection && document.selection.type !== \"Control\") {\n    return document.selection;\n  }\n};\n\nEditor.prototype.getRange = function () {\n  var editor, range;\n  editor = this.elNode;\n  range = this.selection && this.selection.rangeCount && this.selection.getRangeAt(0);\n\n  if (!range) {\n    range = document.createRange();\n  }\n\n  if (!editor.contains(range.commonAncestorContainer)) {\n    range.selectNodeContents(editor);\n    range.collapse(false);\n  }\n\n  return range;\n};\n\nEditor.prototype.setRange = function (range) {\n  range = range || this.current_range;\n\n  if (!range) {\n    range = this.getRange();\n    range.collapse(false);\n  }\n\n  this.selection().removeAllRanges();\n  this.selection().addRange(range);\n  return this;\n};\n\nEditor.prototype.getCharacterPrecedingCaret = function () {\n  var precedingChar, precedingRange, range, sel;\n  precedingChar = \"\";\n  sel = void 0;\n  range = void 0;\n  precedingRange = void 0;\n  var node = this.getNode();\n\n  if (node) {\n    if (window.getSelection) {\n      sel = window.getSelection();\n\n      if (sel.rangeCount > 0) {\n        range = sel.getRangeAt(0).cloneRange();\n        range.collapse(true);\n        range.setStart(node, 0);\n        precedingChar = range.toString().slice(0);\n      }\n    } else if ((sel = document.selection) && sel.type !== \"Control\") {\n      range = sel.createRange();\n      precedingRange = range.duplicate();\n      precedingRange.moveToElementText(containerEl);\n      precedingRange.setEndPoint(\"EndToStart\", range);\n      precedingChar = precedingRange.text.slice(0);\n    }\n  }\n\n  return precedingChar;\n};\n\nEditor.prototype.isLastChar = function () {\n  return this.getNode().textContent.trim().length === this.getCharacterPrecedingCaret().trim().length;\n};\n\nEditor.prototype.isFirstChar = function () {\n  return this.getCharacterPrecedingCaret().trim().length === 0;\n};\n\nEditor.prototype.isSelectingAll = function (element) {\n  var a, b;\n  a = this.getSelectedText().killWhiteSpace().length;\n  b = element.textContent.killWhiteSpace().length;\n  return a === b;\n};\n\nEditor.prototype.setRangeAt = function (element, _int) {\n  var range, sel;\n\n  if (_int == null) {\n    _int = 0;\n  }\n\n  range = document.createRange();\n  sel = window.getSelection();\n  range.setStart(element, _int);\n  range.collapse(true);\n  sel.removeAllRanges();\n  sel.addRange(range);\n  return element.focus();\n};\n\nEditor.prototype.setRangeAtText = function (element, _int2) {\n  var node, range, sel;\n\n  if (_int2 == null) {\n    _int2 = 0;\n  }\n\n  range = document.createRange();\n  sel = window.getSelection();\n  node = element.firstChild;\n  range.setStart(node, 0);\n  range.setEnd(node, 0);\n  range.collapse(true);\n  sel.removeAllRanges();\n  sel.addRange(range);\n  return element.focus();\n};\n\nEditor.prototype.focus = function (focusStart) {\n  if (!focusStart) {\n    this.setRange();\n  }\n\n  this.elNode.focus();\n  return this;\n};\n\nEditor.prototype.focusNode = function (node, range) {\n  range.setStartAfter(node);\n  range.setEndBefore(node);\n  range.collapse(false);\n  return this.setRange(range);\n};\n\nEditor.prototype.getTextNodeParent = function () {\n  var node, range, root, selection;\n  node = void 0;\n  root = this.elNode, selection = this.selection();\n\n  if (selection.rangeCount < 1) {\n    return;\n  }\n\n  range = selection.getRangeAt(0);\n  node = range.commonAncestorContainer;\n\n  if (!node || node === root) {\n    return null;\n  }\n\n  while (node.nodeType != 1) {\n    node = node.parentNode;\n  }\n\n  if (root && root.contains(node) && root != node) {\n    return node;\n  } else {\n    return null;\n  }\n};\n\nEditor.prototype.getNode = function () {\n  var node, range, root, selection;\n  node = void 0;\n  root = this.elNode, selection = this.selection();\n\n  if (selection.rangeCount < 1) {\n    return;\n  }\n\n  range = selection.getRangeAt(0);\n  node = range.commonAncestorContainer;\n\n  if (!node || node === root) {\n    return null;\n  }\n\n  while (node.nodeType != 1) {\n    node = node.parentNode;\n  }\n\n  var pt = node.closest('.block-content-inner') != null ? node.closest('.block-content-inner') : root;\n\n  while (node && (node.nodeType !== 1 || !node.hasClass(\"item\")) && node.parentNode !== pt) {\n    node = node.parentNode;\n  }\n\n  if (node != null && !node.hasClass(\"item-li\") && !node.hasClass('figure-in-row')) {\n    var elementRoot = node.closest('.block-content-inner');\n\n    while (node && node.parentNode !== elementRoot && node != root) {\n      node = node.parentNode;\n    }\n  }\n\n  if (root && root.contains(node) && root != node) {\n    return node;\n  } else {\n    return null;\n  }\n};\n\nEditor.prototype.markAsSelected = function (element) {\n  if (!element || element && element.nodeType != 1) {\n    return;\n  }\n\n  this.elNode.querySelectorAll(\".item-selected\").forEach(function (el) {\n    el.removeClass(\"figure-focused\");\n    el.removeClass(\"item-selected\");\n  });\n  this.elNode.querySelectorAll(\".figure-focused\").forEach(function (el) {\n    return el.removeClass(\"figure-focused\");\n  });\n  document.querySelectorAll('.grid-focused').forEach(function (el) {\n    return el.removeClass('grid-focused');\n  });\n\n  if (element.hasClass('block-grid-caption')) {\n    var bg = element.closest('.block-grid');\n\n    if (bg) {\n      bg.addClass('grid-focused');\n    }\n  }\n\n  element.addClass(\"item-selected\");\n\n  if (this.image_toolbar) {\n    this.image_toolbar.hide();\n  }\n\n  this.setElementName(element);\n  this.displayTooltipAt(element);\n  this.activateBlock(element);\n\n  if (element.hasClass(\"item-first\") && element.closest('.block-first') != null) {\n    this.reachedTop = true;\n\n    if (element.querySelectorAll(\"br\").length === 0) {\n      return element.append(document.createElement(\"br\"));\n    }\n  } else {\n    this.reachedTop = false;\n  }\n};\n\nEditor.prototype.activateBlock = function (elem) {\n  this.elNode.querySelectorAll('.block-selected').forEach(function (el) {\n    return el.removeClass('block-selected');\n  });\n  var bdc = elem.closest('.block-content');\n\n  if (bdc != null) {\n    bdc.addClass('block-selected');\n  }\n};\n\nEditor.prototype.setupFirstAndLast = function () {\n  var il = this.elNode.querySelector('.item-last');\n  var imf = this.elNode.querySelector('.item-first');\n\n  if (il != null) {\n    il.removeClass('item-last');\n  }\n\n  if (imf != null) {\n    imf.removeClass('item-first');\n  }\n\n  var blocks = this.elNode.querySelectorAll('.block-content-inner');\n\n  if (blocks.length > 0) {\n    var chh = blocks[0].children;\n\n    if (chh != null && chh.length > 0) {\n      chh[0].addClass('item-first');\n    }\n\n    var llh = blocks[blocks.length - 1];\n    var cllh = llh.children;\n\n    if (cllh != null && cllh.length > 0) {\n      cllh[cllh.length - 1].addClass('item-last');\n    }\n  }\n\n  return;\n}; // DOM Related methods ends //\n// EDIT content methods //\n\n\nEditor.prototype.scrollTo = function (node) {\n  if (node.isElementInViewport()) {\n    return;\n  } //top = node.offsetTop;\n\n\n  _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].scrollToTop();\n};\n\nEditor.prototype.setupLinks = function (elems) {\n  var _this6 = this;\n\n  if (elems.length != 0) {\n    elems.forEach(function (ii) {\n      _this6.setupLink(ii);\n    });\n  }\n};\n\nEditor.prototype.setupLink = function (n) {\n  var href, parent_name;\n  parent_name = n.parentNode.tagName.toLowerCase();\n  n.addClass(\"markup-\" + parent_name);\n  href = n.attr(\"href\");\n  return n.attr(\"data-href\", href);\n}; // EDIT content methods ends //\n// Toolbar related methods //\n\n\nEditor.prototype.displayTooltipAt = function (element) {\n  if (!this.content_bar) {\n    return;\n  }\n\n  if (!element || element.tagName === \"LI\") {\n    return;\n  }\n\n  this.hideContentBar();\n  this.content_bar.hide();\n  this.content_bar.elNode.removeClass('on-darkbackground');\n\n  if (!element.textContent.isEmpty() && element.querySelectorAll('.placeholder-text').length != 1) {\n    return;\n  }\n\n  if (element.closest('.with-background') != null) {\n    this.content_bar.elNode.addClass('on-darkbackground');\n  }\n\n  var rect = element.getBoundingClientRect();\n  this.positions = {\n    top: element.offsetTop,\n    left: rect.left\n  };\n\n  if (element.hasClass('item-h2')) {\n    this.positions.top += 10;\n  } else if (element.hasClass('item-h3')) {\n    this.positions.top += 5;\n  } else if (element.hasClass('item-h4')) {\n    this.positions.top += 5;\n  }\n\n  var pl = document.querySelector('.hide-placeholder');\n\n  if (pl != null) {\n    pl.removeClass('hide-placeholder');\n  }\n\n  if (element.querySelectorAll('.placeholder-text').length) {\n    element.addClass('hide-placeholder');\n  } else {\n    element.removeClass('hide-placeholder');\n  }\n\n  this.content_bar.show(element);\n  return this.content_bar.move(this.positions);\n};\n\nEditor.prototype.displayTextToolbar = function (sel) {\n  var _this7 = this;\n\n  return setTimeout(function () {\n    var pos;\n    pos = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getSelectionDimensions();\n\n    _this7.text_toolbar.render();\n\n    _this7.relocateTextToolbar(pos);\n\n    _this7.toolbar = _this7.text_toolbar;\n    return _this7.text_toolbar.show();\n  }, 10);\n};\n\nEditor.prototype.handleTextSelection = function (anchor_node) {\n  if (!anchor_node) {\n    return;\n  }\n\n  var text = this.getSelectedText();\n\n  if (this.mode == 'read' && text && (text.length < 10 || text.length > 160)) {\n    this.text_toolbar.hide();\n    return;\n  }\n\n  if (this.image_toolbar) {\n    this.image_toolbar.hide();\n  }\n\n  if (anchor_node.matches(\".item-mixtapeEmbed, .item-figure\") && !text.isEmpty()) {\n    this.text_toolbar.hide();\n    var sel = this.selection(),\n        range,\n        caption,\n        eleme;\n\n    if (sel) {\n      range = sel.getRangeAt(0), caption, eleme = range.commonAncestorContainer;\n      caption = eleme != null ? eleme.closest('.caption') : null;\n\n      if (caption != null) {\n        this.current_node = anchor_node;\n        return this.displayTextToolbar();\n      }\n    }\n  }\n\n  if (!anchor_node.matches(\".item-mixtapeEmbed, .item-figure\") && !text.isEmpty() && anchor_node.querySelectorAll('.placeholder-text').length == 0) {\n    this.current_node = anchor_node;\n    return this.displayTextToolbar();\n  } else {\n    this.text_toolbar.hide();\n  }\n};\n\nEditor.prototype.relocateTextToolbar = function (position) {\n  var height, left, padd, top;\n  var elRect = this.toolbar.elNode.getBoundingClientRect();\n  height = elRect.height;\n  padd = elRect.width / 2;\n  left = position.left + position.width / 2 - padd;\n\n  if (left < 0) {\n    left = position.left;\n  }\n\n  if (this.isIOS) {\n    top = position.top + window.scrollY + height;\n    this.text_toolbar.elNode.addClass('showing-at-bottom');\n  } else {\n    this.text_toolbar.elNode.removeClass('showing-at-bottom');\n    top = position.top + window.scrollY - height;\n  }\n\n  var elCss = this.text_toolbar.elNode.style;\n  elCss.left = left + 'px';\n  elCss.top = top + 'px';\n  elCss.position = 'absolute';\n}; // Toolbar related methods ends //\n\n\nEditor.prototype.hidePlaceholder = function (node, ev) {\n  var ev_type = ev.key || ev.keyIdentifier;\n\n  if ([UPARROW, DOWNARROW, LEFTARROW, RIGHTARROW].indexOf(ev.which) != -1) {\n    this.skip_keyup = true;\n    return;\n  }\n\n  if (node && node.hasClass('item-figure')) {\n    node.querySelectorAll('.placeholder-text').forEach(function (el) {\n      return el.parentNode.removeChild(el);\n    });\n    return;\n  }\n\n  if (node && node.querySelectorAll('.placeholder-text').length) {\n    node.innerHTML = '<br />';\n    this.setRangeAt(node);\n  }\n}; // EVENT LISTENERS //\n\n\nEditor.prototype.cleanupEmptyModifierTags = function (elements) {\n  elements.forEach(function (element) {\n    element.querySelectorAll('i, b, strong, em').forEach(function (item) {\n      if (item.textContent.killWhiteSpace().length == 0) {\n        var pnt = item.parentNode;\n        item.parentNode.replaceChild(document.createTextNode(''), item);\n\n        if (pnt != null) {\n          pnt.normalize();\n        }\n      }\n    });\n  });\n};\n\nEditor.prototype.convertPsInnerIntoList = function (item, splittedContent, match) {\n  var _this8 = this;\n\n  var split = splittedContent,\n      ht = '',\n      k = 0,\n      counter = match.matched[0].charAt(0); // FIXME .. counter checking for many chars which are not implements, not sure other languages have\n  // 26 characters or more.. \n  // just avoid the splitting part if we have more than 26 characters and its not numerical\n\n  if (['a', 'A', 'i', 'I', '', '', ''].indexOf(counter) != -1 && split.length > 26) {\n    return;\n  }\n\n  var count = isNaN(parseInt(counter)) ? counter : parseInt(counter);\n\n  while (k < split.length) {\n    var sf = '\\\\s*' + count + '(.|\\\\))\\\\s';\n    var exp = new RegExp(sf);\n    var sp = split[k].replace(exp, '');\n    ht += '<li>' + sp + '</li>';\n    k++;\n    count = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].incrementCounter(count);\n  } // we have a sequence..\n\n\n  var olN = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement('<ol class=\"postList\">' + ht + '</ol>');\n  item.parentNode.replaceChild(olN, item);\n  this.addClassesToElement(olN);\n\n  if (olN.children) {\n    Array.from(olN.children).forEach(function (elm) {\n      _this8.setElementName(elm);\n    });\n  }\n};\n\nEditor.prototype.doesTwoItemsMakeAList = function (first, second) {\n  var f = first,\n      s = second,\n      firstMatch = f.match(/\\s*[1aA](\\.|\\))\\s*/),\n      secondMatch = s.match(/\\s*[2bB](\\.|\\))\\s*/);\n\n  if (firstMatch && secondMatch) {\n    return {\n      matched: firstMatch,\n      type: 'ol'\n    };\n  }\n\n  firstMatch = f.match(/^\\s*(\\-|\\*)\\s*$/);\n  secondMatch = s.match(/^\\s*(\\-|\\*)\\s*$/);\n\n  if (firstMatch && secondMatch) {\n    return {\n      matched: firstMatch,\n      type: 'ul'\n    };\n  }\n\n  return {\n    matched: false\n  };\n};\n\nEditor.prototype.handleUnwrappedLists = function (elements) {\n  var _this = this;\n\n  elements.forEach(function (item) {\n    if (item.hasClass('item-figure')) {\n      return;\n    }\n\n    var html = item.innerHTML;\n\n    if (html.trim().length !== 0) {\n      // first case\n      var split = html.split('<br>');\n\n      if (split.length >= 2 && split[1] != '') {\n        var match = _this.doesTwoItemsMakeAList(split[0], split[1]);\n\n        match.matched = false;\n\n        if (match.matched) {\n          _this.convertPsInnerIntoList(item, split, match);\n        }\n      }\n    }\n  });\n};\n\nEditor.prototype.handleUnwrapParagraphs = function (elements) {\n  elements.forEach(function (item) {\n    var p = item.querySelectorAll('p');\n\n    if (p.length) {\n      var currNodeName = item.tagName.toLowerCase();\n\n      if (currNodeName == 'blockquote') {\n        var d = document.createElement('div');\n\n        for (var i = 0; i < p.length; i = i + 1) {\n          var _len = p.children.length;\n\n          for (var j = 0; j < _len; j++) {\n            d.appendChild(p.children[j]);\n          }\n\n          p.parentNode.removeChild(p);\n        }\n\n        var len = d.children.length;\n\n        for (var _i2 = 0; _i2 < len; _i2++) {\n          item.appendChild(d.children[_i2]);\n        }\n      }\n    }\n  });\n};\n\nEditor.prototype.handleUnwrappedImages = function (elements) {\n  var _this = this;\n\n  elements.forEach(function (item) {\n    if (item.hasClass('ignore-block') && item.hasClass('item-uploading')) {\n      return;\n    }\n\n    var img = item.querySelectorAll('img');\n\n    if (img.length) {\n      item.attr('data-pending', true);\n\n      if (item && item.children) {\n        var children = item.children;\n        var div = document.createElement('p');\n\n        for (var i = 0; i < children.length; i++) {\n          var it = children[i];\n\n          if (it == img[0]) {\n            continue;\n          } else {\n            div.appendChild(it);\n          }\n        }\n\n        item.insertAdjacentElement('afterend', div); //div.insertAfter(item);\n\n        _this.addClassesToElement(div);\n\n        _this.setElementName(div);\n      }\n\n      return _this.image_uploader.uploadExistentImage(img);\n    }\n  });\n};\n\nEditor.prototype.handleUnwrappedFrames = function (elements) {\n  var _this9 = this;\n\n  elements.forEach(function (element) {\n    element.querySelectorAll('iframe').forEach(function (im) {\n      _this9.video_uploader.uploadExistentIframe(im);\n    });\n  });\n};\n\nEditor.prototype.handleSpanReplacements = function (element) {\n  var replaceWith = element.querySelectorAll('.replace-with');\n  replaceWith.forEach(function (node) {\n    var hasBold = node.hasClass('bold'),\n        hasItalic = node.hasClass('italic');\n\n    if (hasBold && hasItalic) {\n      node.parentNode.replaceChild(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(\"<i class=\\\"markup-i\\\"><b class=\\\"markup-b\\\">\".concat(node.innerHTML, \"</b></i>\")), node);\n    } else if (hasItalic) {\n      node.parentNode.replaceChild(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(\"<i class=\\\"markup-i\\\">\".concat(node.innerHTML, \"</i>\")), node);\n    } else if (hasBold) {\n      node.parentNode.replaceChild(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(\"<b class=\\\"markup-i\\\">\".concat(node.innerHTML, \"</b>\")), node);\n    }\n  });\n};\n\nEditor.prototype.removeUnwantedSpans = function () {\n  this.elNode.addEventListener('DOMNodeInserted', function (ev) {\n    var node = ev.target;\n\n    if (node.nodeType == 1 && node.nodeName == 'SPAN') {\n      if (!node.hasClass('placeholder-text')) {\n        var pn = node.parentNode;\n        var lastInserted = null;\n        Array.from(node.childNodes).forEach(function (el) {\n          if (lastInserted == null) {\n            pn.insertBefore(el, node.nextSibling);\n            lastInserted = el;\n          } else {\n            pn.insertBefore(el, lastInserted.nextSibling);\n            lastInserted = el;\n          }\n        });\n        pn.removeChild(node); // node.parentNode.replaceChild(node, node.children);\n      }\n    }\n  });\n};\n\nEditor.prototype.cleanPastedText = function (text) {\n  var regs = [// Remove anything but the contents within the BODY element\n  [new RegExp(/^[\\s\\S]*<body[^>]*>\\s*|\\s*<\\/body[^>]*>[\\s\\S]*$/g), ''], // cleanup comments added by Chrome when pasting html\n  [new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g), ''], // Trailing BR elements\n  [new RegExp(/<br>$/i), ''], // replace two bogus tags that begin pastes from google docs\n  [new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi), ''], [new RegExp(/<\\/b>(<br[^>]*>)?$/gi), ''], // un-html spaces and newlines inserted by OS X\n  [new RegExp(/<span class=\"Apple-converted-space\">\\s+<\\/span>/g), ' '], [new RegExp(/<br class=\"Apple-interchange-newline\">/g), '<br>'], // replace google docs italics+bold with a span to be replaced once the html is inserted\n  [new RegExp(/<span[^>]*(font-style:italic;font-weight:(bold|700)|font-weight:(bold|700);font-style:italic)[^>]*>/gi), '<span class=\"replace-with italic bold\">'], // replace google docs italics with a span to be replaced once the html is inserted\n  [new RegExp(/<span[^>]*font-style:italic[^>]*>/gi), '<span class=\"replace-with italic\">'], //[replace google docs bolds with a span to be replaced once the html is inserted\n  [new RegExp(/<span[^>]*font-weight:(bold|700)[^>]*>/gi), '<span class=\"replace-with bold\">'], // replace manually entered b/i/a tags with real ones\n  [new RegExp(/&lt;(\\/?)(i|b|a)&gt;/gi), '<$1$2>'], // replace manually a tags with real ones, converting smart-quotes from google docs\n  [new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|\"||)(((?!&quot;|&rdquo;|&ldquo;|\"||).)*)(?:&quot;|&rdquo;|&ldquo;|\"||)(?:(?!&gt;).)*&gt;/gi), '<a href=\"$1\">'], // Newlines between paragraphs in html have no syntactic value,\n  // but then have a tendency to accidentally become additional paragraphs down the line\n  [new RegExp(/<\\/p>\\n+/gi), '</p>'], [new RegExp(/\\n+<p/gi), '<p'], // Microsoft Word makes these odd tags, like <o:p></o:p>\n  [new RegExp(/<\\/?o:[a-z]*>/gi), ''], // Microsoft Word adds some special elements around list items\n  [new RegExp(/<!\\[if !supportLists\\]>(((?!<!).)*)<!\\[endif]\\>/gi), '$1']];\n\n  for (var i = 0; i < regs.length; i += 1) {\n    text = text.replace(regs[i][0], regs[i][1]);\n  }\n\n  return text;\n};\n\nEditor.prototype.insertTextAtCaretPosition = function (textToInsert, haveMoreNodes) {\n  if (document.getSelection && document.getSelection().getRangeAt) {\n    var sel = document.getSelection();\n    var range = sel.getRangeAt(0);\n    var ca = range.commonAncestorContainer;\n    var caption = ca.closest('figcaption');\n\n    var getBlockContainer = function getBlockContainer(node) {\n      while (node) {\n        if (node.nodeType == 1 && node.nodeName == 'FIGCAPTION') {\n          return node;\n        }\n\n        node = node.parentNode;\n      }\n    };\n\n    var generateRightParts = function generateRightParts(node) {\n      if (sel.rangeCount > 0) {\n        var blockEl = getBlockContainer(range.endContainer);\n\n        if (blockEl) {\n          var ran = range.cloneRange();\n          ran.selectNodeContents(blockEl);\n          ran.setStart(range.endContainer, range.endOffset);\n          return ran.extractContents();\n        }\n      }\n    };\n\n    var generateLeftParts = function generateLeftParts(node) {\n      if (sel.rangeCount > 0) {\n        var blockEl = getBlockContainer(range.startContainer);\n\n        if (blockEl) {\n          var ran = range.cloneRange();\n          ran.selectNodeContents(blockEl);\n          ran.setEnd(range.startContainer, range.startOffset);\n          return ran.extractContents();\n        }\n      }\n    };\n\n    if (sel.type == 'Caret') {\n      off = range.endOffset;\n      var rest = '';\n      rest = generateRightParts();\n\n      if (ca.nodeType == 3) {\n        ca = ca.parentNode;\n      }\n\n      ca.appendChild(textToInsert);\n\n      if (!haveMoreNodes) {\n        ca.appendChild(rest);\n      }\n\n      return rest;\n    }\n\n    if (sel.type == 'Range') {\n      var left = '';\n      var right = '';\n      left = generateLeftParts();\n\n      if (haveMoreNodes) {\n        right = generateRightParts();\n      }\n\n      if (ca.nodeType == 3) {\n        ca = ca.parentNode;\n      }\n\n      ca.innerHTML = left;\n      ca.appendChild(textToInsert);\n\n      if (!haveMoreNodes) {\n        ca.appendChild(right);\n      }\n\n      return right;\n    }\n  }\n};\n\nEditor.prototype.doPaste = function (pastedText) {\n  var _this10 = this;\n\n  if (pastedText.match(/<\\/*[a-z][^>]+?>/gi)) {\n    pastedText = this.cleanPastedText(pastedText);\n    var pei = this.paste_element;\n\n    if (pei != null) {\n      this.paste_element.parentNode.removeChild(pei);\n    }\n\n    pei = document.createElement('div');\n    pei.style.display = 'none';\n    this.paste_element = pei;\n    this.elNode.closest('.editor-wrapper').appendChild(pei);\n\n    if (pei != null) {\n      pei.innerHTML = \"<span>\".concat(pastedText, \"</span>\");\n    } // fix span with related tags \n\n\n    this.handleSpanReplacements(pei);\n    this.pastingContent = true;\n\n    var _this = this;\n\n    this.setupElementsClasses(pei, function () {\n      var last_node, new_node, nodes, num, top;\n      nodes = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(_this10.paste_element.innerHTML);\n\n      if (nodes != null && typeof nodes['length'] !== 'undefined') {\n        nodes = _toConsumableArray(nodes); //\n      } else if (nodes != null) {\n        // single element\n        nodes = [nodes]; //this.aa.insertAdjacentElement('afterend', nodes);\n      }\n\n      var after = _this10.aa;\n\n      for (var i = 0; i < nodes.length; i++) {\n        var nd = nodes[i];\n        after.insertAdjacentElement('afterend', nd);\n        after = nd;\n      }\n\n      var aa = _this10.aa;\n      var caption;\n\n      if (aa.hasClass('item-figure')) {\n        if (aa.hasClass('figure-in-row')) {\n          var grid = aa.closest('.block-grid');\n\n          if (grid != null) {\n            caption = grid.querySelector('.block-grid-caption');\n          }\n        } else {\n          caption = aa.querySelector('figcaption');\n        }\n      } else if (aa.hasClass('block-grid-caption')) {\n        caption = aa;\n      }\n\n      if (caption != null) {\n        var first = nodes;\n        var firstText = first.textContent;\n        var leftOver = '';\n\n        if (aa.hasClass('item-text-default')) {\n          caption.innerHTML = firstText;\n        } else {\n          leftOver = _this10.insertTextAtCaretPosition(firstText, nodes.length - 1); // don't count the current node\n        }\n\n        aa.removeClass('item-text-default');\n        nodes.splice(0, 1);\n        first.parentNode.removeChild(first);\n\n        if (leftOver != '') {\n          var o = document.createElement('p');\n          o.appendChild(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(leftOver));\n          o.insertAfter(nodes.lastElementChild);\n        }\n      }\n\n      if (!nodes.length) {\n        return;\n      }\n\n      if (aa.textContent == '') {\n        aa.parentNode.removeChild(aa);\n      }\n\n      if (_this10.paste_element != null) {\n        var pt = _this10.paste_element.querySelector('figure');\n\n        if (pt != null) {\n          _this10.paste_element.parentNode.removeChild(pei);\n        }\n      }\n\n      last_node = nodes[nodes.length - 1];\n\n      if (last_node && last_node.length) {\n        last_node = last_node[0];\n      }\n\n      num = last_node.childNodes.length;\n\n      _this10.setRangeAt(last_node, num);\n\n      if (new_node != null) {\n        new_node = _this10.getNode();\n        top = new_node.offsetTop;\n\n        _this10.markAsSelected(new_node);\n      }\n\n      _this10.displayTooltipAt(_this10.elNode.querySelector(\".item-selected\"));\n\n      _this10.cleanupEmptyModifierTags(nodes); // handle unwrapped images\n\n\n      _this10.handleUnwrappedImages(nodes); // unwrapped iframes, if we can handle, we should\n\n\n      _this10.handleUnwrappedFrames(nodes); // unwrapped lists items, inside p's or consective p's\n\n\n      _this10.handleUnwrappedLists(nodes); // unwrap p's which might be inside other elements\n\n\n      _this10.handleUnwrapParagraphs(nodes);\n\n      var figs = _this10.elNode.querySelectorAll('figure');\n\n      figs.forEach(function (ite) {\n        var it = ite;\n\n        if (it.querySelectorAll('img').length == 0) {\n          it.parentNode.removeChild(it);\n        }\n      });\n\n      var captions = _this10.elNode.querySelectorAll('figcaption');\n\n      captions.forEach(function (ite) {\n        var it = ite.closest('.item');\n\n        if (it != null && it.querySelectorAll('img').length == 0) {\n          it.parentNode.removeChild(it);\n        }\n      });\n      return _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].scrollToTop(top);\n    });\n    return false;\n  } else {\n    //its plain text\n    var node = this.aa;\n\n    if (node.hasClass('item-figure')) {\n      var caption;\n\n      if (node.hasClass('figure-in-row')) {\n        var grid = node.closest('.block-grid');\n        caption = grid != null ? grid.querySelector('.block-grid-caption') : null;\n      } else {\n        caption = node.querySelector('figcaption');\n      }\n\n      if (caption != null) {\n        caption.innerHTML = pastedText;\n        return false;\n      }\n    }\n  }\n};\n\nEditor.prototype.handlePaste = function (ev) {\n  ev.preventDefault();\n  var cbd, pastedText;\n  this.aa = this.getNode();\n  pastedText = void 0;\n\n  if (window.clipboardData && window.clipboardData.getData) {\n    pastedText = window.clipboardData.getData('Text');\n  } else if (ev.clipboardData && ev.clipboardData.getData) {\n    cbd = ev.clipboardData;\n    pastedText = cbd.getData('text/html').isEmpty() ? cbd.getData('text/plain') : cbd.getData('text/html');\n  }\n\n  this.doPaste(pastedText);\n  return false;\n};\n\nEditor.prototype.handleDblclick = function (e) {\n  var node;\n  var tg = e.target.closest('.main-controls');\n\n  if (tg != null) {\n    return false;\n  }\n\n  node = this.getNode();\n\n  if (!node) {\n    this.setRangeAt(this.prev_current_node);\n  }\n\n  return false;\n};\n\nEditor.prototype.handleMouseDown = function (e) {\n  var node,\n      anchor_node,\n      el = e.toElement;\n\n  if (el.hasClass('placeholder-text') || el.querySelectorAll('.placeholder-text').length) {\n    node = el.closest('.figure-caption');\n\n    if (node != null) {\n      e.preventDefault();\n      _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(node, 0);\n    } else {\n      node = el.closest('.item');\n\n      if (node != null) {\n        e.preventDefault();\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(node, 0);\n      }\n    }\n  } else if (el.hasClass('block-background') || el.hasClass('table-view') || el.hasClass('table-cell-view')) {\n    var section = el.closest('section');\n\n    if (section != null) {\n      this.selectFigure(section);\n    }\n  } else if (el.hasClass('block-grid-caption')) {\n    var bg = el.closest('.block-grid');\n\n    if (bg != null) {\n      bg.addClass('grid-focused');\n    }\n  }\n}; // NOTE don't use the event, as its just dummy, function gets called from selection change also\n\n\nEditor.prototype.handleMouseUp = function () {\n  var anchor_node,\n      selection = this.selection();\n\n  if (!selection && selection.anchorNode.hasClass('main-divider')) {\n    var new_anchor = selection.anchorNode,\n        focusTo = new_anchor.nextElementSibling.querySelector('.block-content-inner:first-child .item:first-child');\n\n    if (focusTo != null) {\n      this.setRangeAt(focusTo);\n      _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(focusTo);\n    }\n  }\n\n  anchor_node = this.getNode();\n\n  if (!anchor_node) {\n    return;\n  }\n\n  this.prev_current_node = anchor_node;\n  this.handleTextSelection(anchor_node);\n  this.markAsSelected(anchor_node);\n\n  if (!anchor_node.hasClass('item-figure')) {\n    return this.displayTooltipAt(anchor_node);\n  } else {\n    this.hideContentBar();\n    return this;\n  }\n};\n\nEditor.prototype.handleArrow = function (ev) {\n  var current_node;\n  current_node = this.getNode();\n\n  if (current_node != null) {\n    this.markAsSelected(current_node);\n    return this.displayTooltipAt(current_node);\n  }\n};\n\nEditor.prototype.handleTab = function (anchor_node, event) {\n  var nextTabable = function nextTabable(node) {\n    var next = node.next('.item');\n\n    if (next != null) {\n      return next;\n    }\n\n    var cont = node.closest('.block-content-inner');\n    next = cont != null ? cont.nextElementSibling : null;\n\n    if (next != null) {\n      return next;\n    }\n\n    var sec = node.closest('.block-content');\n    next = sec != null ? sec.next() : null;\n\n    if (next != null) {\n      var block = next.querySelector('.block-content-inner:last-child');\n\n      if (block != null) {\n        var item = block.querySelector('.item:last-child');\n\n        if (item != null) {\n          return item;\n        } else {\n          return block;\n        }\n      } else {\n        return next;\n      }\n    }\n\n    return false;\n  };\n\n  var prevTabable = function prevTabable(node) {\n    var prev = node.prev('.item');\n\n    if (prev != null) {\n      return prev;\n    }\n\n    var cont = node.closest('.block-content-inner');\n    cont = cont != null ? cont.previousElementSibling : null;\n\n    if (cont != null && (cont.hasClass('block-grid') || cont.hasClass('full-width-column'))) {\n      return cont;\n    } else if (cont.length && cont.hasClass('center-column')) {\n      var i = cont.querySelector('.item:last-child');\n\n      if (i != null) {\n        return i;\n      }\n    }\n\n    var sec = node.closest('.block-content');\n    prev = sec.previousElementSibling;\n\n    if (prev != null) {\n      var last = prev.querySelector('.block-content-inner:last-child');\n\n      if (last != null && last.hasClass('block-grid')) {\n        return last;\n      } else if (last != null && last.hasClass('center-column')) {\n        var i = last.querySelector('.item:last-child');\n\n        if (i != null) {\n          return i;\n        }\n      }\n    }\n\n    return false;\n  };\n\n  var next;\n\n  if (!anchor_node) {\n    anchor_node = document.querySelector('.item-selected');\n\n    if (!anchor_node) {\n      anchor_node = document.querySelector('.grid-focused');\n    }\n  }\n\n  if (!anchor_node) {\n    return;\n  }\n\n  if (event.shiftKey) {\n    next = prevTabable(anchor_node);\n  } else {\n    next = nextTabable(anchor_node);\n  }\n\n  if (next) {\n    if (next.hasClass('block-grid')) {\n      var cap = next.querySelector('.block-grid-caption');\n\n      if (cap != null) {\n        this.setRangeAt(cap);\n      }\n\n      next.addClass('grid-focused');\n    } else if (next.hasClass('full-width-column')) {\n      var fig = next.querySelector('.item-figure');\n\n      if (fig != null) {\n        var cap = fig.querySelector('figcaption');\n\n        if (cap.length) {\n          this.setRangeAt(cap);\n        }\n\n        this.selectFigure(fig);\n      }\n    } else if (next.hasClass('item-figure')) {\n      var cap = next.querySelector('figcaption');\n\n      if (cap != null) {\n        this.setRangeAt(cap);\n      }\n\n      this.selectFigure(next);\n    } else if (next.hasClass('with-background')) {\n      var items = next.querySelector('.item:first-child');\n\n      if (items != null) {\n        this.setRangeAt(items[0]);\n      }\n\n      this.selectFigure(next);\n    } else {\n      this.setRangeAt(next);\n      this.markAsSelected(next);\n      this.displayTooltipAt(next);\n    }\n\n    return this.scrollTo(next);\n  }\n};\n\nEditor.prototype.handleArrowForKeyDown = function (ev) {\n  if (ev.shiftKey) {\n    // probably trying\n    return;\n  }\n\n  var caret_node,\n      current_node,\n      ev_type,\n      n,\n      next_node,\n      num,\n      prev_node,\n      crossing_section = false,\n      cn;\n  caret_node = this.getNode();\n  current_node = caret_node;\n  ev_type = ev.key || ev.keyIdentifier;\n\n  switch (ev_type) {\n    case \"Left\":\n    case \"Right\":\n      if (!current_node || !current_node.length) {\n        if (document.querySelector(\".item-selected\") != null) {\n          current_node = document.querySelector(\".item-selected\");\n        }\n      }\n\n      if (current_node.querySelectorAll('.placeholder-text').length == 1) {\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].stopEvent(ev);\n        return false;\n      }\n\n      break;\n\n    case \"Down\":\n      if (!current_node || !current_node.length) {\n        if (document.querySelector(\".item-selected\") != null) {\n          current_node = document.querySelector(\".item-selected\");\n        }\n      }\n\n      next_node = current_node.nextElementSibling;\n\n      if (next_node == null) {\n        n = this.findNextFocusableElement(current_node);\n        next_node = n.node;\n        crossing_section = n.section_crossed;\n      }\n\n      if (current_node.hasClass('item-figure') && !ev.target.hasClass('figure-caption')) {\n        // we move to caption unles its a partialwidth\n        if (current_node.hasClass('figure-in-row') && next_node && !next_node.hasClass('figure-in-row')) {\n          var cont = current_node.closest('.block-content-inner');\n\n          if (cont != null) {\n            var last = cont.querySelector('.item-figure:last-child');\n\n            if (last != null && last.attr('name') == current_node.attr('name')) {\n              next_node = cont.closest('.block-grid').querySelector('.block-grid-caption');\n            }\n          }\n        } else if (!next_node || !current_node.hasClass('figure-in-row')) {\n          next_node = current_node.querySelector('.figure-caption');\n        }\n      } else if (current_node.hasClass('item-figure') && ev.target.hasClass('figure-caption')) {\n        if (current_node.hasClass('figure-in-row')) {\n          current_node.closest('.block-content-inner').removeClass('figure-focused');\n        }\n\n        if (!next_node.length) {\n          // we don't have a next node\n          var cont = current_node.closest('.block-content-inner').nextElementSibling;\n\n          if (cont != null) {\n            next_node = cont.querySelector('.item:first-child');\n          }\n        }\n      }\n\n      cn = current_node;\n\n      if (!cn.hasClass(\"item\") && cn.nodeName != 'FIGCAPTION') {\n        return;\n      }\n\n      if (cn.hasClass('item-last') && _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].editableCaretOnLastLine(current_node)) {\n        return;\n      }\n\n      if (!next_node) {\n        return;\n      }\n\n      if (next_node.hasClass('figure-caption') || next_node.hasClass('block-grid-caption')) {\n        var figure = next_node.closest('.item-figure');\n\n        if (figure != null || current_node.hasClass('figure-in-row')) {\n          this.hideImageToolbar();\n          this.markAsSelected(figure);\n          this.setRangeAt(next_node);\n\n          if (figure.hasClass('figure-in-row')) {\n            figure.closest('.block-content-inner').addClass('figure-focused');\n          }\n\n          if (current_node.hasClass('figure-in-row')) {\n            current_node.closest('.block-grid').addClass('grid-focused');\n          }\n\n          _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(next_node);\n          ev.preventDefault();\n          return false;\n        }\n      }\n\n      if (current_node.hasClass(\"item-figure\") && next_node.hasClass(\"item-figure\")) {\n        this.scrollTo(next_node);\n        this.skip_keyup = true;\n        this.selectFigure(next_node);\n        return false;\n      }\n\n      if (next_node.hasClass(\"item-figure\") && caret_node) {\n        this.skip_keyup = true;\n        this.selectFigure(next_node);\n        ev.preventDefault();\n        return false;\n      } else if (next_node.hasClass(\"item-mixtapeEmbed\")) {\n        n = current_node.next(\".item-mixtapeEmbed\");\n        num = n.childNodes.length;\n        this.setRangeAt(n, num);\n        this.scrollTo(n);\n        return false;\n      }\n\n      if (current_node.hasClass(\"item-figure\") && next_node.hasClass(\"item\")) {\n        this.scrollTo(next_node);\n\n        if (next_node.querySelectorAll('.placeholder-text').length) {\n          this.markAsSelected(next_node);\n          this.setRangeAt(next_node);\n          _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(next_node, 0);\n          ev.preventDefault();\n          return false;\n        } else {\n          this.markAsSelected(next_node);\n          this.setRangeAt(next_node);\n          ev.preventDefault();\n          return false;\n        }\n      }\n\n      if (next_node.hasClass('item-last') && next_node.querySelector('.placeholder-text') != null) {\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].stopEvent(ev);\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(next_node, 0);\n        return false;\n      }\n\n      if (next_node.querySelectorAll('.placeholder-text').length) {\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(next_node, 0);\n        return false;\n      }\n\n      if (crossing_section) {\n        ev.preventDefault();\n        this.setRangeAt(next_node);\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(next_node, 0);\n        this.markAsSelected(next_node);\n        return false;\n      }\n\n      this.markAsSelected(next_node);\n      break;\n\n    case \"Up\":\n      if (!current_node || !current_node.length) {\n        if (document.querySelector(\".item-selected\") != null) {\n          current_node = document.querySelector(\".item-selected\");\n        }\n      }\n\n      prev_node = current_node.previousElementSibling;\n\n      if (prev_node == null) {\n        n = this.findPreviousFocusableElement(current_node);\n        prev_node = n.node;\n        crossing_section = n.section_crossed;\n      }\n\n      if (typeof prev_node == 'undefined') {\n        prev_node = current_node.previousElementSibling;\n      }\n\n      if (current_node.hasClass('block-grid-caption')) {\n        var lastRow = current_node.closest('.block-grid').querySelector('.block-grid-row');\n\n        if (lastRow != null) {\n          prev_node = lastRow.querySelector('.item-figure:last-child');\n        }\n      } else if (current_node.hasClass('block-grid-row') && ev.target.hasClass('figure-caption')) {\n        prev_node = current_node.querySelector('.figure-in-row:last-child');\n      } else if (current_node.hasClass('block-grid-row')) {} else {\n        if (prev_node.hasClass('item-figure') && !ev.target.hasClass('figure-caption')) {\n          if (prev_node.hasClass('figure-in-row')) {\n            var cont = prev_node.closest('.block-content-inner'),\n                lastGraf = cont ? cont.querySelector('.item-figure:last-child') : null;\n\n            if (cont != null && lastGraf != null && lastGraf.attr('name') == prev_node.attr('name')) {\n              prev_node = prev_node.querySelector('.figure-caption');\n            }\n          } else {\n            var caption = prev_node.querySelector('.figure-caption');\n            prev_node = caption;\n          }\n        } else if (current_node.hasClass('item-figure') && ev.target.hasClass('figure-caption')) {\n          if (current_node.hasClass('figure-in-row')) {\n            prev_node = current_node;\n          } else {\n            prev_node = current_node;\n          }\n        }\n      }\n\n      cn = current_node;\n\n      if (!cn.hasClass(\"item\") && !cn.hasClass('block-grid-caption')) {\n        return;\n      }\n\n      if (!(cn.hasClass(\"item-figure\") || !cn.hasClass('item-first'))) {\n        return;\n      }\n\n      if (prev_node.hasClass('block-grid-caption')) {\n        var grid = prev_node.closest('.block-grid');\n        grid.addClass('grid-focused');\n      }\n\n      if (prev_node.hasClass('figure-caption')) {\n        var figure = prev_node.closest('.item-figure');\n        this.hideImageToolbar();\n        this.markAsSelected(figure);\n        this.setRangeAt(prev_node);\n        this.scrollTo(prev_node);\n\n        if (figure.hasClass('figure-in-row')) {\n          figure.closest('.block-content-inner').addClass('figure-focused');\n        }\n\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(prev_node);\n        ev.preventDefault();\n        return false;\n      }\n\n      if (prev_node.hasClass(\"item-figure\")) {\n        document.activeElement.blur();\n        this.elNode.focus();\n        this.selectFigure(prev_node);\n        return false;\n      } else if (prev_node.hasClass(\"item-mixtapeEmbed\")) {\n        n = current_node.prev(\".item-mixtapeEmbed\");\n\n        if (n != null) {\n          num = n.childNodes.length;\n          this.setRangeAt(n, num);\n          this.scrollTo(n);\n        }\n\n        return false;\n      }\n\n      if (current_node.hasClass(\"item-figure\") && prev_node.hasClass(\"item\")) {\n        if (document.activeElement) {\n          document.activeElement.blur();\n          this.elNode.focus();\n        }\n\n        this.hideImageToolbar();\n        this.markAsSelected(prev_node);\n        this.scrollTo(prev_node);\n        this.setRangeAt(prev_node);\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(prev_node);\n        this.skip_keyup = true;\n        ev.preventDefault();\n        return false;\n      } else if (prev_node.hasClass(\"item\") && !crossing_section) {\n        n = current_node.prev(\".item\");\n\n        if (n != null) {\n          this.scrollTo(n);\n        } else {\n          this.scrollTo(prev_node);\n        }\n\n        this.markAsSelected(prev_node);\n\n        if (prev_node.hasClass('item-first') && prev_node.querySelector('.placeholder-text') != null) {\n          _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].stopEvent(ev);\n          _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(prev_node, 0);\n        }\n\n        return false;\n      }\n\n      if (crossing_section) {\n        ev.preventDefault();\n        this.setRangeAt(prev_node);\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(prev_node, 0);\n        this.markAsSelected(prev_node);\n        return false;\n      }\n\n  }\n};\n\nEditor.prototype.insertFancyChar = function (event, text) {\n  _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].stopEvent(event);\n  var node = this.getNode(),\n      textVal,\n      range = this.selection().getRangeAt(0);\n  range.deleteContents();\n\n  if (text == 'single' || text == 'double') {\n    textVal = node.textContent;\n    var leftQuote = false,\n        rightQuote = false;\n\n    if (text == null || text != null && text.trim().length == 0 || this.isFirstChar() || /\\s/.test(textVal.charAt(textVal.length - 1))) {\n      leftQuote = true;\n    }\n\n    if (text == 'single') {\n      if (leftQuote) {\n        text = QUOTE_LEFT_UNICODE;\n      } else {\n        text = QUOTE_RIGHT_UNICODE;\n      }\n    } else if (text == 'double') {\n      if (leftQuote) {\n        text = DOUBLEQUOTE_LEFT_UNICODE;\n      } else {\n        text = DOUBLEQUOTE_RIGHT_UNICODE;\n      }\n    }\n  } else if (text == 'dash') {\n    text = DASH_UNICODE;\n  }\n\n  var appended = false;\n\n  if (node.hasClass('pullquote') && !node.hasClass('with-cite') && (text == DOUBLEQUOTE_RIGHT_UNICODE || text == DASH_UNICODE)) {\n    if (_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].editableCaretAtEnd(node)) {\n      var cite = '<cite class=\"item-cite\">' + DASH_UNICODE + ' </cite>';\n      node.appendChild(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(cite));\n      _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(cite, 2);\n      node.addClass('with-cite');\n      appended = true;\n    }\n  }\n\n  if (!appended) {\n    var textNode,\n        range,\n        sel,\n        doc = document;\n    textNode = doc.createTextNode(text);\n    range.insertNode(textNode);\n    range = doc.createRange();\n    sel = this.selection();\n    range.setStart(textNode, 1);\n    range.collapse(true);\n    sel.removeAllRanges();\n    sel.addRange(range);\n  }\n}; // TODO for special chars insertion, keydown code is not differentiable\n\n\nEditor.prototype.handleKeyPress = function (e) {\n  var which = e.which;\n\n  switch (which) {\n    case SINGLE_QUOTE_WHICH:\n      this.insertFancyChar(e, 'single');\n      break;\n\n    case DOUBLE_QUOTE_WHICH:\n      this.insertFancyChar(e, 'double');\n      break;\n\n    case DASH_WHICH:\n      this.insertFancyChar(e, 'dash');\n      break;\n  }\n};\n\nEditor.prototype.handleShortCutKeys = function (e) {\n  var which = e.which;\n  this.current_node = this.getNode();\n  var node = this.current_node;\n\n  if (e.ctrlKey && which == CHAR_LINK) {\n    if (this.image_toolbar && (node.hasClass('item-figure') || node.hasClass('item-iframe'))) {\n      return this.image_toolbar.addLink(e);\n    }\n  }\n\n  if (e.ctrlKey && e.altKey) {\n    if (SHORT_CUT_KEYS.indexOf(which) != -1 && this.text_toolbar) {\n      return this.text_toolbar.shortCutKey(which);\n    }\n  } else if (e.ctrlKey && (which == CHAR_CENTER || which == CHAR_LINK)) {\n    return this.text_toolbar.shortCutKey(which, e);\n  }\n};\n\nEditor.prototype.handleKeyDown = function (e) {\n  var tg = e.target;\n\n  if (tg.hasClass('.autocomplete')) {\n    this.skip_keyup = true;\n    return;\n  }\n\n  if (e.ctrlKey && !e.shiftKey && [LEFTARROW, DOWNARROW, UPARROW, DOWNARROW].indexOf(e.which) != -1 && tg.hasClass('item-figure')) {\n    return this.handleKeyDownOnFigure(e, tg);\n  }\n\n  if (e.ctrlKey && !e.shiftKey && e.which >= 49 && e.which <= 52 && (tg.hasClass('item-figure') || document.querySelectorAll('.with-background.figure-focused').length)) {\n    if (this.image_toolbar) {\n      this.image_toolbar.shortCutKey(e.which, e);\n    }\n\n    return false;\n  }\n\n  var anchor_node, eventHandled, li, parent, utils_anchor_node;\n  anchor_node = this.getNode();\n  parent = anchor_node;\n\n  if (anchor_node) {\n    this.markAsSelected(anchor_node);\n  }\n\n  this.hidePlaceholder(anchor_node, e); // hide placeholder if we are in placeholder item\n\n  this.handleShortCutKeys(e);\n\n  if (e.which == ESCAPE) {\n    if (this.text_toolbar) {\n      this.skip_keyup = true;\n      this.text_toolbar.hide();\n    }\n\n    if (this.image_toolbar) {\n      this.skip_keyup = true;\n      this.image_toolbar.hide();\n    }\n\n    return false;\n  }\n\n  if (e.which === TAB) {\n    this.handleTab(anchor_node, e);\n    return false;\n  }\n\n  if (e.ctrlKey && !e.shiftKey && e.which == 67 && (!anchor_node || anchor_node.length == 0) && document.querySelector('.figure-focused') != null) {\n    if (document.createRange) {\n      var range = document.createRange();\n      var figure = document.querySelector('.figure-focused .item-image');\n      this.skip_keyup = true;\n\n      if (figure != null) {\n        var sel = this.selection();\n        sel.removeAllRanges();\n        range.selectNode(figure);\n        sel.addRange(range);\n      }\n    }\n  }\n\n  if (e.which == DELETE) {\n    if (this.reachedTop && this.isFirstChar() && anchor_node.next('.item') == null) {\n      var sec = anchor_node.closest('.block-content');\n\n      if (sec != null && sec.next('.block-content') != null) {\n        this.content_options.forEach(function (w) {\n          if (w && w.contentId && w.contentId == 'SECTION') {\n            w.handleDeleteKey(e, anchor_node);\n          }\n        });\n      }\n\n      var df = anchor_node.querySelector('.placeholder-text');\n      var intt = anchor_node.next('.item');\n\n      if (df != null && intt != null && intt.querySelectorAll('.placeholder-text').length) {\n        intt.parentNode.removeChild(intt);\n        anchor_node.addClass('item-last');\n        anchor_node.innerHTML = '<br />';\n      } else {\n        anchor_node.addClass('item-empty');\n        anchor_node.innerHTML = '<br />';\n      }\n\n      _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(anchor_node);\n      return false;\n    } else {\n      if (anchor_node.querySelectorAll('.placeholder-text').length) {\n        anchor_node.addClass('item-empty');\n        anchor_node.innerHTML = '<br />';\n        _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(anchor_node);\n        return false;\n      }\n    }\n\n    this.content_options.forEach(function (w) {\n      if (w.handleDeleteKey) {\n        return w.handleDeleteKey(e, parent);\n      }\n    });\n  }\n\n  if (e.which === ENTER) {\n    var sel = this.elNode.querySelector('.item-selected'),\n        placeholderText = sel != null ? sel.querySelector('.placeholder-text') : null;\n\n    if (sel != null && !sel.hasClass('item-figure') && placeholderText != null) {\n      sel.innerHTML = '<br />';\n      sel.addClass('item-empty');\n      placeholderText.parentNode.removeChild(placeholderText);\n    }\n\n    if (sel != null) {\n      sel.removeClass(\"item-selected\");\n    }\n\n    if (parent.hasClass(\"item-p\")) {\n      li = this.handleSmartList(parent, e);\n\n      if (li) {\n        anchor_node = li;\n      }\n    } else if (parent.hasClass(\"item-li\")) {\n      this.handleListLineBreak(parent, e);\n    }\n\n    this.content_options.forEach(function (w) {\n      if (w.handleEnterKey) {\n        return w.handleEnterKey(e, parent);\n      }\n    });\n\n    if (e.handled) {\n      return false;\n    }\n\n    if (sel.hasClass('block-grid-caption')) {\n      this.handleLineBreakWith(\"p\", parent);\n      this.setRangeAtText(document.querySelector(\".item-selected\"));\n      document.querySelector('.item-selected').dispatchEvent(new Event(\"mouseup\"));\n      return false;\n    }\n\n    if (parent.hasClass(\"item-mixtapeEmbed\") || parent.hasClass(\"item-iframe\") || parent.hasClass(\"item-figure\")) {\n      if (e.target.hasClass('figure-caption')) {\n        this.handleLineBreakWith(\"p\", parent);\n        this.setRangeAtText(document.querySelector(\".item-selected\"));\n        document.querySelector('.item-selected').dispatchEvent(new Event(\"mouseup\"));\n        return false;\n      } else if (!this.isLastChar()) {\n        return false;\n      }\n    }\n\n    if (parent.hasClass(\"item-iframe\") || parent.hasClass(\"item-figure\")) {\n      if (this.isLastChar()) {\n        this.handleLineBreakWith(\"p\", parent);\n        this.setRangeAtText(document.querySelector(\".item-selected\"));\n        document.querySelector('.item-selected').dispatchEvent(new Event(\"mouseup\"));\n        return false;\n      } else {\n        return false;\n      }\n    }\n\n    if (anchor_node && this.toolbar.lineBreakReg.test(anchor_node.nodeName)) {\n      if (this.isLastChar()) {\n        e.preventDefault();\n        this.handleLineBreakWith(\"p\", parent);\n      }\n    }\n\n    var _this11 = this;\n\n    setTimeout(function () {\n      var node = _this11.getNode();\n\n      if (!node) {\n        return;\n      }\n\n      node.removeAttribute('name');\n\n      _this11.setElementName(node);\n\n      if (node.nodeName.toLowerCase() === \"div\") {\n        node = _this11.replaceWith(\"p\", node);\n      }\n\n      var pctAll = node && node.nodeType == 1 ? node.children : null;\n\n      if (pctAll != null && pctAll.length) {\n        Array.from(pctAll).forEach(function (pa) {\n          if (pa.matches('.placeholder-text')) {\n            pct.parentNode.removeChild(pct);\n          }\n        });\n      } // const pct = node.querySelector('> .placeholder-text');\n      // if(pct != null) {\n      //   pct.parentNode.removeChild(pct);\n      // }\n\n\n      _this11.markAsSelected(node);\n\n      _this11.setupFirstAndLast();\n\n      if (node.textContent.isEmpty()) {\n        Array.from(node.children).forEach(function (n) {\n          n.parentNode.removeChild(n);\n        });\n        node.appendChild(document.createElement(\"br\"));\n\n        if (_this11.isTouch) {//$node.hammer({});\n        }\n      }\n\n      return _this11.displayTooltipAt(_this11.elNode.querySelector(\".item-selected\"));\n    }, 15);\n  }\n\n  if (e.which === BACKSPACE) {\n    eventHandled = false;\n    this.toolbar.hide();\n    anchor_node = this.getNode();\n    var sel_anchor = this.selection().anchorNode;\n\n    if (this.reachedTop) {}\n\n    if (anchor_node != null && anchor_node.querySelectorAll('.placeholder-text').length) {\n      e.preventDefault();\n      anchor_node.addClass('item-empty');\n      anchor_node.innerHTML = '<br />';\n      this.skip_keyup = true;\n      this.setRangeAt(anchor_node);\n      return false;\n    }\n\n    if ((this.prevented || this.reachedTop && this.isFirstChar()) && !sel_anchor.hasClass('block-background')) {\n      return false;\n    }\n\n    utils_anchor_node = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getNode();\n    this.content_options.forEach(function (w) {\n      var handled;\n\n      if (w.handleBackspaceKey && !handled) {\n        return handled = w.handleBackspaceKey(e, anchor_node);\n      }\n    });\n\n    if (eventHandled) {\n      e.preventDefault();\n      return false;\n    } // Undo to normal quotes and dash if user immediately pressed backspace\n\n\n    var existingText = this.getCharacterPrecedingCaret(),\n        existingTextLength = existingText.length,\n        charAtEnd = existingText.charAt(existingText.length - 1);\n\n    if (UNICODE_SPECIAL_CHARS.indexOf(charAtEnd) != -1) {\n      this.handleSpecialCharsBackspace(charAtEnd);\n      return false;\n    }\n\n    if (parent != null && parent.hasClass(\"item-li\") && this.getCharacterPrecedingCaret().length === 0) {\n      return this.handleListBackspace(parent, e);\n    }\n\n    if (anchor_node.hasClass(\"item-p\") && this.isFirstChar()) {\n      if (anchor_node.previousElementSibling && anchor_node.previousElementSibling.hasClass(\"item-figure\")) {//e.preventDefault();\n        //return false;\n      }\n    }\n\n    if (utils_anchor_node.hasClass(\"main-body\") || utils_anchor_node.hasClass(\"item-first\")) {\n      if (utils_anchor_node.textContent.isEmpty()) {\n        return false;\n      }\n    }\n\n    if (anchor_node && anchor_node.nodeType === 3) {}\n\n    if (anchor_node.hasClass(\"item-mixtapeEmbed\") || anchor_node.hasClass(\"item-iframe\")) {\n      if (anchor_node.textContent.isEmpty() || this.isFirstChar()) {\n        this.inmediateDeletion = this.isSelectingAll(anchor_node);\n\n        if (this.inmediateDeletion) {\n          this.handleInmediateDeletion(anchor_node);\n        }\n\n        return false;\n      }\n    }\n\n    if (anchor_node.previousElementSibling != null && anchor_node.previousElementSibling.hasClass(\"item-mixtapeEmbed\")) {\n      if (this.isFirstChar() && !anchor_node.textContent.isEmpty()) {\n        return false;\n      }\n    }\n\n    if (anchor_node.hasClass(\"item-first\")) {\n      if ((anchor_node.textContent.isEmpty() || anchor_node.textContent.length == 1) && anchor_node.closest('.block-first') != null) {\n        if (anchor_node.nextElementSibling && anchor_node.nextElementSibling.hasClass('item-last')) {\n          anchor_node.innerHTML = '';\n          return false;\n        }\n      }\n    }\n\n    var _this = this;\n\n    setTimeout(function () {\n      var backspacedTo = window.getSelection();\n\n      if (backspacedTo.type == 'Caret') {\n        _this.markAsSelected(backspacedTo.anchorNode);\n      }\n    }, 30);\n  }\n\n  if (e.which === SPACEBAR) {\n    if (parent.hasClass(\"item-p\")) {\n      this.handleSmartList(parent, e);\n    }\n  }\n\n  if (anchor_node) {\n    if (!anchor_node.textContent.isEmpty() && anchor_node.querySelectorAll('.placeholder-text').length == 0) {\n      this.hideContentBar();\n      anchor_node.removeClass(\"item-empty\");\n    }\n  }\n\n  if ([UPARROW, DOWNARROW, LEFTARROW, RIGHTARROW].indexOf(e.which) != -1) {\n    this.handleArrowForKeyDown(e);\n  }\n};\n\nEditor.prototype.handleSpecialCharsBackspace = function (charAtEnd) {\n  var anchor_node = '';\n\n  if (window.getSelection) {\n    var sel = window.getSelection();\n\n    if (sel.type != 'Caret') {\n      return;\n    }\n\n    var range = sel.getRangeAt(0);\n    var commonAn = range.commonAncestorContainer;\n\n    if (commonAn.nodeType == 3) {\n      // its a text node\n      var nv = commonAn.nodeValue;\n      var toReplaceWith = '';\n\n      if (charAtEnd == QUOTE_LEFT_UNICODE || charAtEnd == QUOTE_RIGHT_UNICODE) {\n        toReplaceWith = \"'\";\n      } else if (charAtEnd == DOUBLEQUOTE_LEFT_UNICODE || charAtEnd == DOUBLEQUOTE_RIGHT_UNICODE) {\n        toReplaceWith = '\"';\n      } else if (charAtEnd == DASH_UNICODE) {\n        toReplaceWith = \"-\";\n      }\n\n      var position = range.startOffset;\n\n      if (nv.length == 1) {\n        commonAn.nodeValue = toReplaceWith;\n        var nrange = document.createRange();\n        var sele = sel;\n        nrange.setStart(commonAn, 1);\n        nrange.collapse(true);\n        sele.removeAllRanges();\n        sele.addRange(nrange);\n      } else {\n        var newNodeValue = nv.substr(0, position - 1) + toReplaceWith + nv.substr(position);\n        commonAn.nodeValue = newNodeValue;\n        var nrange = document.createRange();\n        var sele = sel;\n        nrange.setStart(commonAn, position);\n        nrange.collapse(true);\n        sele.removeAllRanges();\n        sele.addRange(nrange);\n      }\n    }\n  }\n};\n\nEditor.prototype.handleKeyUp = function (e, node) {\n  var anchor_node, next_item, utils_anchor_node;\n\n  if (this.skip_keyup) {\n    this.skip_keyup = null;\n    return false;\n  }\n\n  this.toolbar.hide();\n  this.reachedTop = false;\n  anchor_node = this.getNode();\n  utils_anchor_node = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getNode();\n  this.handleTextSelection(anchor_node);\n\n  if ([BACKSPACE, SPACEBAR, ENTER].indexOf(e.which) != -1) {\n    if (anchor_node != null && anchor_node.hasClass(\"item-li\")) {\n      this.removeSpanTag(anchor_node);\n    }\n  }\n\n  if ([LEFTARROW, UPARROW, RIGHTARROW, DOWNARROW].indexOf(e.which) != -1) {\n    return this.handleArrow(e);\n  }\n\n  if (e.which === BACKSPACE) {\n    if (utils_anchor_node.hasClass(\"article-body\")) {\n      this.handleCompleteDeletion(this.elNode);\n\n      if (this.completeDeletion) {\n        this.completeDeletion = false;\n        return false;\n      }\n    }\n\n    if (utils_anchor_node.hasClass(\"main-body\") || utils_anchor_node.hasClass(\"item-first\")) {\n      if (utils_anchor_node.textContent.isEmpty()) {\n        next_item = utils_anchor_node.next(\".item\");\n\n        if (next_item) {\n          this.setRangeAt(next_item);\n          utils_anchor_node.parentNode.removeChild(utils_anchor_node);\n          this.setupFirstAndLast();\n        } else {\n          var cont = utils_anchor_node.closest('.with-background');\n\n          if (cont != null && cont.next('.block-content') != null) {\n            var nxtSection = cont.next('.block-content');\n            var item = nxtSection != null ? nxtSection.querySelector('.item') : null;\n\n            if (item != null) {\n              this.setRangeAt(item);\n            }\n\n            cont.parentNode.removeChild(cont);\n            this.fixSectionClasses();\n            this.setupFirstAndLast();\n          } else if (cont != null && cont.next('.block-content') != null) {\n            var havePrev = cont.prev('.block-content');\n\n            if (havePrev != null) {\n              var items = nxtSection.querySelectorAll('.item');\n\n              if (items.length) {\n                var item = items[items.length - 1];\n\n                if (item) {\n                  this.setRangeAt(item);\n                }\n\n                cont.remove();\n                this.fixSectionClasses();\n                this.setupFirstAndLast();\n              }\n            } else {\n              this.handleCompleteDeletion(utils_anchor_node);\n            }\n          }\n        }\n\n        return false;\n      }\n    }\n\n    if (!anchor_node) {\n      this.handleNullAnchor();\n      return false;\n    }\n\n    if (anchor_node.hasClass(\"item-first\")) {\n      if (this.getSelectedText() === this.getNode().textContent) {\n        this.getNode().innerHTML = \"<br>\";\n      }\n\n      this.markAsSelected(anchor_node);\n      this.setupFirstAndLast();\n      return false;\n    }\n\n    if (anchor_node.hasClass(\"item-last\")) {\n      if (anchor_node.textContent.isEmpty() && anchor_node.closest('.block-first') != null) {\n        if (anchor_node.previousElementSibling && anchor_node.previousElementSibling.hasClass('item-first')) {\n          _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].stopEvent(e);\n          anchor_node.innerHTML = this.subtitle_placeholder;\n          return false;\n        }\n      }\n    }\n\n    if (anchor_node.hasClass(\"item-first\")) {\n      if (anchor_node.textContent.isEmpty() && anchor_node.closest('.block-first') != null) {\n        if (anchor_node.nextElementSibling && anchor_node.nextElementSibling.hasClass('item-last')) {\n          _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].stopEvent(e);\n          anchor_node.innerHTML = this.title_placeholder;\n          return false;\n        }\n      }\n    }\n  }\n\n  var tg = e.target;\n\n  if (tg.nodeName && tg.nodeName.toLowerCase() == 'figcaption') {\n    if (tg.textContent.isEmpty()) {\n      if (tg.hasClass('block-grid-caption')) {\n        if (tg.closest('.block-grid') != null) {\n          tg.closest('.block-grid').addClass('item-text-default');\n        }\n      } else {\n        if (tg.closest('.item-figure') != null) {\n          tg.closest('.item-figure').addClass('item-text-default');\n        }\n      }\n    } else {\n      if (tg.hasClass('block-grid-caption')) {\n        if (tg.closest('.block-grid') != null) {\n          tg.closest('.block-grid').removeClass('item-text-default');\n        }\n      } else {\n        if (tg.closest('.item-figure') != null) {\n          tg.closest('.item-figure').removeClass('item-text-default');\n        }\n      }\n    }\n  }\n\n  if (e.which == BACKSPACE && tg.hasClass('figure-caption')) {\n    var caption = e.target,\n        text = caption.textContent;\n\n    if (text.killWhiteSpace().isEmpty() || text.length == 1 && text == \" \") {\n      if (!caption.attr('data-placeholder-value')) {\n        caption.attr('data-placeholder-value', 'Type caption for image(Optional)');\n      }\n\n      caption.appendChild(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement('<span class=\"placeholder-text\">' + caption.attr('data-placeholder-value') + '</span>'));\n\n      if (caption.closest('.item-figure') != null) {\n        caption.closest('.item-figure').addClass('item-text-default');\n      }\n    }\n  }\n};\n/** image drag and drop **/\n\n\nEditor.prototype.__positionsCache = [];\n\nEditor.prototype.createElementPositionsCache = function () {\n  if (this.__positionsCache.length == 0) {\n    var nodes = this.elNode.querySelectorAll('.item');\n    var cache = [];\n\n    for (var i = 0; i < nodes.length; i = i + 1) {\n      var it = nodes[i];\n      var o = it.getBoundingClientRect();\n      cache.push([it.attr('name'), o.top + it.height, o.left]);\n    }\n\n    cache.sort(function (a, b) {\n      return a[1] - b[1];\n    });\n    this.__positionsCache = cache;\n  }\n};\n\nEditor.prototype.generatePlaceholderForDrop = function (position) {\n  var i = 0,\n      cache = this.__positionsCache,\n      len = cache.length;\n\n  for (; i < len; i = i + 1) {\n    if (cache[i][1] > position) {\n      break;\n    }\n  }\n\n  var item = i > 0 ? cache[i - 1] : cache[0];\n\n  if (item) {\n    var already = document.querySelector('#drag_pc_' + item);\n\n    if (!already) {\n      var dp = document.querySelector('.drop-placeholder');\n      dp.parentNode.remove(dp);\n      var o = \"<div class=\\\"drop-placeholder\\\" id=\\\"drag_pc_\".concat(item, \"\\\"></div>\");\n      _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(o).insertAfter(document.querySelector('[name=\"' + item + '\"]'));\n    }\n  }\n};\n\nEditor.prototype.handleDragEnter = function (e) {\n  e.stopPropagation();\n  this.createElementPositionsCache();\n};\n\nEditor.prototype.handleDragExit = function (e) {\n  e.stopPropagation();\n};\n\nEditor.prototype.handleDragEnd = function (e) {\n  e.stopPropagation();\n  this.__positionsCache = {};\n};\n\nEditor.prototype.handleDrag = function (e) {\n  e.stopPropagation();\n  e.preventDefault();\n  var o = e.pageY;\n  this.generatePlaceholderForDrop(o);\n};\n\nEditor.prototype.handleDrop = function (e) {\n  e.stopPropagation();\n  e.preventDefault();\n  var dragItem = e.dataTransfer;\n  var files = dragItem.files;\n  var haveUploads = false;\n\n  if (!files || files.length == 0) {\n    this.image_uploader.uploadFiles(files, true);\n    haveUploads = true;\n  } else {\n    var html = dragItem.getData('text/html');\n\n    if (html != '') {\n      var placeholder = this.elNode.querySelector('.drop-placeholder');\n      var m = placeholder.next('.item');\n\n      if (m.length) {\n        this.aa = m;\n      } else {\n        m = placeholder.prev('.item');\n\n        if (m.length) {\n          this.aa = m;\n        } else {\n          this.aa = this.getNode();\n        }\n      }\n\n      this.doPaste(html);\n    }\n  }\n\n  if (haveUploads) {\n    document.querySelector('.drop-placeholder').hide();\n  } else {\n    document.querySelector('.drop-placeholder').remove();\n  }\n\n  return false;\n};\n\nEditor.prototype.handleLineBreakWith = function (element_type, from_element) {\n  var new_paragraph;\n  new_paragraph = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(\"<\" + element_type + \" class='item item-\" + element_type + \" item-empty item-selected'><br/></\" + element_type + \">\");\n\n  if (from_element.hasClass('block-grid-caption')) {\n    var cont = from_element.closest('.block-grid');\n\n    if (cont != null) {\n      cont.insertAdjacentElement('afterend', new_paragraph);\n    }\n  } else if (from_element.parentNode.matches('[class^=\"item-\"]')) {\n    from_element.parentNode.insertAdjacentElement('afterend', new_paragraph);\n  } else {\n    from_element.insertAdjacentElement('afterend', new_paragraph);\n  }\n\n  this.setRangeAt(new_paragraph);\n  return this.scrollTo(new_paragraph);\n};\n\nEditor.prototype.replaceWith = function (etype, from_element) {\n  var new_paragraph = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(\"<\".concat(etype, \" class='item item-\").concat(etype, \" item-empty item-selected'><br/></\").concat(etype, \">\"));\n  from_element.replaceWith(new_paragraph);\n  this.setRangeAt(new_paragraph);\n  this.scrollTo(new_paragraph);\n  return new_paragraph;\n}; // EVENT LISTENERS END //\n\n\nEditor.prototype.findNextFocusableElement = function (current_node) {\n  var inner,\n      cont,\n      crossing_section = false,\n      next_node;\n\n  if (current_node.hasClass('item-li')) {\n    var list = current_node.closest('.postList');\n\n    if (list.nextElementSibling != null) {\n      next_node = list.nextElementSibling;\n    }\n  }\n\n  if (!next_node) {\n    if (current_node.hasClass('figure-in-row')) {\n      var row = current_node.closest('.block-grid-row');\n      var nextRow = row != null ? row.nextElementSibling : null;\n\n      if (nextRow != null && !nextRow.hasClass('block-grid-caption')) {\n        next_node = nextRow.querySelector('.item-figure:first-child');\n      } else if (nextRow != null && nextRow.hasClass('block-grid-caption')) {\n        next_node = nextRow;\n      }\n    } else {\n      inner = current_node.closest('.block-content-inner');\n      cont = inner != null ? inner.nextElementSibling : null;\n\n      if (cont.hasClass('block-grid')) {\n        next_node = cont.querySelector('.block-grid-row:first-child .item:first-child');\n      } else if (cont != null) {\n        next_node = cont.querySelector('.item:first-child');\n      } else {\n        // probably a new section below then\n        var section = inner.closest('section'),\n            next_section = section != null ? section.nextElementSibling : null;\n\n        if (next_section != null) {\n          cont = next_section.querySelector('.main-body .block-content-inner:first-child');\n\n          if (cont != null) {\n            next_node = cont.querySelector('.item:first-child');\n            crossing_section = true;\n          }\n        }\n      }\n    }\n  }\n\n  return {\n    node: next_node,\n    section_crossed: crossing_section\n  };\n};\n\nEditor.prototype.findPreviousFocusableElement = function (current_node) {\n  var cont = current_node.closest('.block-content-inner');\n  cont = cont != null ? cont.previousElementSibling : null;\n  var prev_node,\n      crossing_section = false;\n\n  if (current_node.hasClass('figure-in-row')) {\n    var cr = current_node.closest('.block-grid');\n    var first = cr != null ? cr.querySelector('.block-grid-row:first-child .figure-in-row:first-child') : null;\n\n    if (first != null && first == current_node) {\n      var pr = cr.previousElementSibling;\n\n      if (pr != null && !pr.hasClass('block-grid')) {\n        prev_node = pr.querySelector('> .item:last-child');\n      } else if (pr && pr.hasClass('block-grid')) {\n        var lastCap = pr.querySelector('.block-grid-caption');\n        prev_node = lastCap;\n      }\n    }\n  }\n\n  if (!prev_node) {\n    if (cont.length && cont.hasClass('block-grid')) {\n      var caption = cont.querySelector('.block-grid-caption');\n      prev_node = caption;\n    } else {\n      if (cont != null) {\n        prev_node = cont.querySelector('.item:last-child');\n      } else {\n        var section = current_node.closest('section'),\n            prev_section = section != null ? section.previousElementSibling : null;\n\n        if (prev_section != null) {\n          cont = prev_section.querySelector('.main-body .block-content-inner:last-child');\n\n          if (cont != null) {\n            prev_node = cont.querySelector('.item:last-child');\n            crossing_section = true;\n          }\n        }\n      }\n    }\n  }\n\n  return {\n    node: prev_node,\n    section_crossed: crossing_section\n  };\n};\n\nEditor.prototype.moveFigureUp = function (figure) {\n  var prev = figure.previousElementSibling;\n  var toGrid = false;\n\n  if (prev != null) {\n    if (prev.hasClass('item')) {\n      figure.insertBefore(prev);\n    }\n  } else if (figure.hasClass('figure-full-width')) {} else {\n    var column = figure.closest('.block-content-inner');\n    var prevColumn = column.prev('.block-content-inner');\n\n    if (prevColumn != null) {\n      if (prevColumn.hasClass('block-grid')) {\n        this.moveFigureInsideGrid(figure, nextColumn, false);\n        toGrid = true;\n      } else if (prevColumn.hasClass('center-column')) {\n        prevColumn.appendChild(figure);\n      } else if (prevColumn.hasClass('full-width-column')) {\n        var prevBeforeFW = prevColumn.previousElementSibling;\n\n        if (prevBeforeFW != null) {\n          if (prevBeforeFW.hasClass('center-column')) {\n            prevBeforeFW.appendChild(figure);\n          } else if (prevBeforeFW.hasClass('full-width-column') || prevBeforeFW.hasClass('block-grid')) {\n            var centerColumn = this.pushCenterColumn(prevBeforeFW, false);\n            centerColumn.appendChild(figure);\n          }\n        }\n      }\n    }\n  }\n\n  if (!toGrid) {\n    var fc = figure.classList; //TODO\n\n    fc.remove('figure-in-row can-go-right can-go-down can-go-left');\n  }\n};\n\nEditor.prototype.moveFigureDown = function (figure) {\n  var next = figure.nextElementSibling,\n      toGrid = false;\n  figure.removeClass('figure-in-row');\n\n  if (next != null) {\n    if (next.hasClass('item')) {\n      figure.insertAfter(next);\n    }\n  } else if (figure.hasClass('figure-full-width')) {// full width image.. find next container\n  } else {\n    // figure is first item in the column\n    var column = figure.closest('.block-content-inner');\n    var nextColumn = column != null ? column.next('.block-content-inner') : null;\n\n    if (nextColumn != null) {\n      if (nextColumn.hasClass('block-grid')) {\n        // next item is grid, add image to the grid\n        this.moveFigureInsideGrid(figure, nextColumn, true);\n        toGrid = true;\n      } else if (nextColumn.hasClass('center-column')) {\n        // next is text based center clumn.. prepend item there..\n        nextColumn.insertBefore(figure, nextColumn.firstChild);\n      } else if (nextColumn.hasClass('full-width-column')) {\n        //next is full width image..move image to next column after that..\n        var nextAfterFW = nextColumn.nextElementSibling;\n\n        if (nextAfterFW != null) {\n          // we have something after next column\n          if (nextAfterFW.hasClass('center-column')) {\n            // its centered column\n            nextAfterFW.insertBefore(figure, nextAfterFW.firstChild); //Utils.prependNode(figure, nextAfterFW);\n          } else if (nextAfterFW.hasClass('full-width-column') || nextAfterFW.hasClass('block-grid')) {\n            // anotehr full width here..or block grid put a center column inbetween and put figure there\n            var centerColumn = this.pushCenterColumn(nextAfterFW, true);\n            centerColumn.appendChild(figure);\n          }\n        }\n      }\n    }\n  }\n\n  if (!toGrid) {\n    figure.removeClass('can-go-left can-go-right can-go-down figure-in-row');\n  }\n};\n\nEditor.prototype.moveFigureInsideGrid = function (figure, grid, firstItem) {\n  if (firstItem) {\n    var row = grid.querySelector('.block-grid-row:first-child');\n    figure.addClass('figure-in-row');\n    _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].prependNode(figure, row);\n    var figures = row.querySelectorAll('.item-figure');\n    this.streamer.notifySubscribers('Katana.Images.Restructure', {\n      container: row,\n      count: figures.length,\n      figures: figures\n    });\n  } else {\n    var row = grid.querySelector('.block-grid-row:last-child');\n    figure.addClass('figure-in-row');\n    row.appendChild(figure);\n    var figures = row.querySelectorAll('.item-figure');\n    this.streamer.notifySubscribers('Katana.Images.Restructure', {\n      container: row,\n      count: figures.length,\n      figures: figures\n    });\n  }\n};\n\nEditor.prototype.pushCenterColumn = function (place, before) {\n  var div = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(\"<div class=\\\"center-column block-content-inner\\\"></div>\");\n\n  if (before) {\n    div.insertBefore(place);\n  } else {\n    div.insertAfter(place);\n  }\n\n  return div;\n};\n\nEditor.prototype.addClassesToElement = function (element, forceKlass) {\n  var n, name, new_el;\n  n = element;\n  var fK = typeof forceKlass != 'undefined' ? forceKlass : false;\n  name = n.nodeName.toLowerCase();\n\n  if (name == 'blockquote') {\n    n.removeClass('text-center');\n  } else {\n    n.removeClass('text-center');\n    n.removeClass('pullquote');\n  }\n\n  var hasEmpty = false;\n\n  if (n.hasClass('item-empty')) {\n    hasEmpty = true;\n  }\n\n  name = name == \"a\" ? \"anchor\" : name;\n\n  switch (name) {\n    case \"p\":\n    case \"pre\":\n      n.removeAttribute('class');\n      n.addClass(\"item item-\" + name);\n\n      if (fK) {\n        n.addClass(forceKlass);\n      }\n\n      if (name === \"p\" && n.querySelectorAll(\"br\").length === 0) {\n        n.appendChild(document.createElement(\"br\"));\n      }\n\n      break;\n\n    case \"div\":\n      if (n.hasClass('block-grid-row')) {} else if (!n.hasClass(\"item-mixtapeEmbed\")) {\n        n.removeAttribute('class');\n        n.addClass(\"item item-\" + name);\n      }\n\n      break;\n\n    case \"h1\":\n    case \"h2\":\n    case \"h3\":\n    case \"h4\":\n    case \"h5\":\n    case \"h6\":\n      if (name === \"h1\") {\n        new_el = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(\"<h2 class='item item-h2'>\".concat(n.textContent, \"</h2>\"));\n        n.parentNode.replaceChild(new_el, n);\n        this.setElementName(n);\n      } else {\n        n.removeAttribute('class');\n        n.addClass(\"item item-\" + name);\n      }\n\n      if (fK) {\n        n.addClass(forceKlass);\n      }\n\n      break;\n\n    case \"code\":\n      n.removeAttribute('class');\n      n.unwrap().wrap(\"<p class='item item-pre'></p>\");\n      n = n.parentNode;\n      break;\n\n    case \"ol\":\n    case \"ul\":\n      n.removeAttribute('class');\n      n.addClass(\"postList\");\n      n.querySelectorAll('li').forEach(function (li) {\n        li.removeAttribute('class');\n        li.addClass('item item-li');\n      });\n      break;\n\n    case \"img\":\n      this.image_uploader.uploadExistentImage(n);\n      break;\n\n    case \"anchor\":\n    case \"a\":\n    case 'strong':\n    case 'em':\n    case 'br':\n    case 'b':\n    case 'u':\n    case 'i':\n      n.removeAttribute('class');\n      n.addClass('markup-' + name);\n\n      if (n.closest('.item') == null) {\n        n.wrap(\"<p class='item item-p'></p>\");\n      }\n\n      n = n.parentNode;\n      break;\n\n    case \"blockquote\":\n      n.removeAttribute('class');\n\n      if (n.hasClass('pullquote')) {\n        n.addClass('pullquote');\n      }\n\n      ;\n\n      if (n.hasClass('with-cite')) {\n        n.addClass('with-cite');\n      }\n\n      n.addClass('item item-' + name);\n\n      if (fK) {\n        n.addClass(fK);\n      }\n\n      break;\n\n    case \"figure\":\n      if (n.hasClass(\"item-figure\")) {\n        n = n;\n      }\n\n      break;\n\n    case \"figcaption\":\n      if (n.hasClass('block-grid-caption') || n.hasClass('figure-caption')) {\n        n = n;\n      }\n\n      break;\n\n    default:\n      n.wrap(\"<p class='item item-\".concat(name, \"'></p>\"));\n      n = n.parentNode;\n  }\n\n  if (['figure', 'img', 'iframe', 'ul', 'ol'].indexOf(name) == -1) {\n    /*var n = n;\n    n.html(n.html().replace(/&nbsp;/g, ' ')); */\n  }\n\n  if (hasEmpty) {\n    n.addClass('item-empty');\n  }\n\n  return n;\n};\n\nEditor.prototype.addHammer = function (element) {\n  if (this.isTouch) {// $(element).hammer({});\n  }\n};\n\nEditor.prototype.setupElementsClasses = function (element, cb) {\n  if (!element) {\n    this.element = this.elNode.querySelectorAll('.block-content-inner');\n  } else {\n    this.element = typeof element['length'] == 'undefined' ? [element] : element;\n  }\n\n  var _this = this;\n\n  setTimeout(function () {\n    _this.cleanContents(_this.element);\n\n    _this.wrapTextNodes(_this.element);\n\n    var ecC = [];\n    var allAs = [];\n\n    _this.element.forEach(function (elcc) {\n      var cc = elcc.children ? Array.from(elcc.children) : [];\n      ecC = ecC.concat(cc);\n      var aas = elcc.querySelectorAll('a');\n\n      if (aas.length) {\n        aas = Array.from(aas);\n        allAs = allAs.concat(aas);\n      }\n    });\n\n    ecC.forEach(function (n) {\n      _this.addClassesToElement(n);\n\n      _this.setElementName(n);\n    });\n\n    _this.setupLinks(allAs);\n\n    _this.setupFirstAndLast();\n\n    return cb();\n  }, 20);\n};\n\nEditor.prototype.cleanContents = function (element) {\n  var elm;\n\n  if (!element) {\n    elm = this.elNode.querySelectorAll('.block-content-inner');\n  } else {\n    elm = typeof element['length'] == 'undefined' ? [element] : element;\n  }\n\n  _cleaner__WEBPACK_IMPORTED_MODULE_10__[\"default\"].it(elm);\n};\n\nEditor.prototype.wrapTextNodes = function (element) {\n  if (!element) {\n    element = this.elNode.querySelectorAll('.block-content-inner');\n  } else {\n    element = element;\n  }\n\n  var ecChildren = [];\n  element.forEach(function (elm) {\n    var elmc = elm.children ? Array.from(elm.children) : [];\n    ecChildren = ecChildren.concat(elmc);\n  });\n  var ecw = ecChildren.filter(function (item) {\n    var ii = item;\n\n    if (ii.nodeType === 3) {\n      var ht = ii.innerHTML;\n\n      if (ht.trim().length > 0) {\n        return true;\n      }\n    }\n\n    return false;\n  });\n  _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].arrayToNodelist(ecw).wrap(\"<p class='item grap--p'></p>\");\n};\n\nEditor.prototype.setElementName = function (element) {\n  var el = element;\n\n  if (el.tagName == 'LI') {\n    return el.attr('name', _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId());\n  }\n\n  if (!el.matches('[name]')) {\n    if (el.tagName == 'UL') {\n      var elChilds = Array.prototype.filter.call(el.children, function (e) {\n        return e.tagName === 'LI';\n      });\n      var lis = elChilds; //el.querySelectorAll(' > li');\n\n      lis.forEach(function (item) {\n        var li = item;\n\n        if (!li.matches('[name]')) {\n          li.attr('name', _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId());\n        }\n      });\n    }\n\n    return el.attr(\"name\", _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId());\n  }\n};\n\nEditor.prototype.handleSmartList = function (item, e) {\n  var li, chars, match, regex;\n  chars = this.getCharacterPrecedingCaret();\n  match = chars.match(/^\\s*(\\-|\\*)\\s*$/);\n\n  if (match) {\n    e.preventDefault();\n    regex = new RegExp(/\\s*(\\-|\\*)\\s*/);\n    li = this.listify(item, \"ul\", regex, match);\n  } else {\n    match = chars.match(/^\\s*[1aAiI](\\.|\\))\\s*$/);\n\n    if (match) {\n      e.preventDefault();\n      regex = new RegExp(/\\s*[1aAiI](\\.|\\))\\s*/);\n      li = this.listify(item, \"ol\", regex, match);\n    }\n  }\n\n  return li;\n};\n\nEditor.prototype.handleListLineBreak = function (li, e) {\n  var list, paragraph, content;\n  this.hideContentBar();\n  list = li.parentNode;\n  paragraph = document.createElement('p');\n\n  if (list.children != null && list.children.length === 1 && li.textContent.trim() === \"\") {\n    this.replaceWith(\"p\", list);\n  } else if (li.textContent.trim() === \"\" && li.nextElementSibling !== null) {\n    e.preventDefault();\n  } else if (li.nextElementSibling !== null) {\n    if (li.textContent.isEmpty()) {\n      e.preventDefault();\n      paragraph.parentNode.insertBefore(list, paragraph.nextElementSibling); // list.after(paragraph);\n\n      li.addClass(\"item-removed\");\n      li.parentNode.removeChild(li);\n    } else if (li.previousElementSibling !== null && li.previousElementSibling.textContent.trim() === \"\" && this.getCharacterPrecedingCaret() === \"\") {\n      e.preventDefault();\n      content = li.innerHTML;\n      paragraph.parentNode.insertBefore(list, paragraph.nextElementSibling); // list.after(paragraph);\n\n      if (li.previousElementSibling) {\n        li.previousElementSibling.parentNode.removeChild(li.previousElementSibling);\n      }\n\n      li.addClass(\"item-removed\");\n      li.parentNode.removeChild(li);\n      paragraph.innerHTML = content;\n    }\n  }\n\n  if (list && list.children.length === 0) {\n    list.parentNode.removeChild(list);\n  }\n\n  if (li.hasClass(\"item-removed\")) {\n    this.addClassesToElement(paragraph);\n    this.setRangeAt(paragraph);\n    this.markAsSelected(paragraph);\n    return this.scrollTo(paragraph);\n  }\n};\n\nEditor.prototype.listify = function (paragraph, listType, regex, match) {\n  var li, list, content;\n  this.removeSpanTag(paragraph);\n  content = paragraph.innerHTML.replace(/&nbsp;/g, \" \").replace(regex, \"\");\n  var type = match[0].charAt(0);\n\n  switch (listType) {\n    case \"ul\":\n      list = document.createElement('ul');\n      break;\n\n    case \"ol\":\n      list = document.createElement('ol');\n      break;\n\n    default:\n      return false;\n  }\n\n  this.addClassesToElement(list);\n  this.replaceWith(\"li\", paragraph);\n\n  if (type != 1) {\n    list.addClass('postList--' + type);\n    list.attr('type', type);\n  }\n\n  li = document.querySelector(\".item-selected\");\n\n  if (li != null) {\n    this.setElementName(li);\n    li.innerHTML = content;\n\n    if (li.children != null) {\n      li.children.wrap(list);\n    }\n\n    if (li.querySelectorAll(\"br\").length === 0) {\n      li.appendChild(document.createElement(\"br\"));\n    }\n\n    this.setRangeAt(li);\n  }\n\n  return li;\n};\n\nEditor.prototype.handleListBackspace = function (li, e) {\n  var list, paragraph, content;\n  list = li.parentNode;\n  liPr = li.parentNode.tagName.toLowerCase();\n\n  if (liPr != 'ul' && liPr != 'ol') {\n    return;\n  }\n\n  if (li.previousElementSibling != null) {\n    e.preventDefault();\n    list.insertBefore(li);\n    content = li.innerHTML;\n    this.replaceWith(\"p\", li);\n    paragraph = document.querySelector(\".item-selected\");\n\n    if (paragraph != null) {\n      paragraph.removeClass(\"item-empty\");\n      paragraph.innerHTML = content;\n    }\n\n    if (list.children != null && list.children.length == 0) {\n      list.parentNode.removeChild(list);\n    }\n\n    return this.setupFirstAndLast();\n  }\n};\n\nEditor.prototype.removeSpanTag = function (item) {\n  item.querySelectorAll(\"span\").forEach(function (sp) {\n    if (!sp.hasClass('placeholder-text')) {\n      if (sp.children != null) {\n        var content = Array.from(sp.children);\n        content.forEach(function (cn) {\n          sp.parentNode.insertBefore(cn, sp);\n        });\n        sp.parentNode.removeChild(sp);\n      }\n    }\n  });\n  return item;\n};\n\nEditor.prototype.handleInmediateDeletion = function (element) {\n  var new_node;\n  this.inmediateDeletion = false;\n  new_node = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.baseParagraphTmpl()).insertBefore(element);\n  new_node.addClass(\"item-selected\");\n  this.setRangeAt(element.previousElementSibling);\n  return element.parentNode.removeChild(element);\n};\n\nEditor.prototype.handleUnwrappedNode = function (element) {\n  var new_node, tmpl;\n  tmpl = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.baseParagraphTmpl());\n  this.setElementName(tmpl);\n  element.wrap(tmpl);\n  new_node = document.querySelector(\"[name='\" + tmpl.attr('name') + \"']\");\n  new_node.addClass(\"item-selected\");\n  this.setRangeAt(new_node);\n  return false;\n};\n/*\nThis is a rare hack only for FF (I hope),\nwhen there is no range it creates a new element as a placeholder,\nthen finds previous element from that placeholder,\nthen it focus the prev and removes the placeholder.\na nasty nasty one...\n  */\n\n\nEditor.prototype.handleNullAnchor = function () {\n  var node, num, prev, range, sel, span;\n  sel = this.selection();\n\n  if (sel.isCollapsed && sel.rangeCount > 0) {\n    if (sel.anchorNode.hasClass('block-background')) {\n      return;\n    }\n\n    range = sel.getRangeAt(0);\n    span = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.baseParagraphTmpl());\n    range.insertNode(span);\n    range.setStart(span, 0);\n    range.setEnd(span, 0);\n    sel.removeAllRanges();\n    sel.addRange(range);\n    node = range.commonAncestorContainer;\n    prev = node.previousElementSibling;\n    num = prev.children;\n\n    if (prev != null && prev.hasClass(\"item\")) {\n      this.setRangeAt(prev, num);\n      node.parentNode.removeChild(node);\n      this.markAsSelected(this.getNode());\n    } else if (prev != null && prev.hasClass(\"item-mixtapeEmbed\")) {\n      this.setRangeAt(prev, num);\n      node.parentNode.removeChild();\n      this.markAsSelected(this.getNode());\n    } else if (!prev) {\n      this.setRangeAt(this.elNode.querySelector(\".block-content-inner p\"));\n    }\n\n    return this.displayTooltipAt(this.elNode.querySelector(\".item-selected\"));\n  }\n};\n\nEditor.prototype.handleCompleteDeletion = function (element) {\n  if (element.textContent.isEmpty()) {\n    this.selection().removeAllRanges();\n    this.render();\n\n    var _this = this;\n\n    setTimeout(function () {\n      _this.setRangeAt(_this.elNode.querySelector('.block-content-inner p'));\n    }, 20);\n    this.completeDeletion = true;\n    return;\n  }\n}; // Anchor tooltip //\n\n\nEditor.prototype.displayPopOver = function (ev, matched) {\n  return this.tooltip.displayAt(ev, matched);\n};\n\nEditor.prototype.hidePopOver = function (ev, matched) {\n  return this.tooltip.hide(ev, matched);\n}; // Anchor tooltip ends //\n// Image toolbar related  //\n\n\nEditor.prototype.displayImageToolbar = function () {\n  var _this12 = this;\n\n  if (!this.image_toolbar) {\n    return;\n  }\n\n  setTimeout(function () {\n    var pos = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getImageSelectionDimension();\n\n    _this12.image_toolbar.render();\n\n    _this12.image_toolbar.show();\n\n    _this12.relocateImageToolbar(pos);\n  }, 16);\n};\n\nEditor.prototype.relocateImageToolbar = function (position) {\n  if (position == null) {\n    return;\n  }\n\n  var height, left, padd, top, scrollTop;\n  var ebr = this.image_toolbar.elNode.getBoundingClientRect();\n  height = ebr.height;\n  padd = ebr.width / 2;\n  top = position.top - height + document.body.scrollTop;\n  left = position.left + position.width / 2 - padd;\n  scrollTop = window.pageYOffset;\n\n  if (scrollTop > top) {\n    top = scrollTop;\n  }\n\n  var cst = this.image_toolbar.elNode.style;\n  cst.left = left;\n  cst.top = top;\n  cst.position = 'absolute';\n};\n\nEditor.prototype.selectFigure = function (figure) {\n  if (!figure) {\n    return;\n  }\n\n  if (this.image_toolbar) {\n    this.image_toolbar.hide();\n  }\n\n  this.elNode.querySelectorAll(\".figure-focused\").forEach(function (el) {\n    return el.removeClass(\"figure-focused\");\n  });\n\n  if (figure.hasClass('with-background')) {\n    figure.addClass('figure-focused');\n    this.displayImageToolbar();\n    var item = figure.querySelector('.item');\n\n    if (item != null) {\n      _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setCaretAtPosition(item, 0);\n      item.focus();\n      return;\n    }\n  } else {\n    this.markAsSelected(figure.querySelector('.padding-cont'));\n    figure.addClass('figure-focused item-selected');\n    var bg = figure.closest(\".block-grid\");\n\n    if (bg != null) {\n      bg.addClass('figure-focused');\n    }\n\n    this.selection().removeAllRanges();\n    this.displayImageToolbar();\n  }\n\n  if (figure.hasClass('figure-in-row')) {\n    var bci = figure.closest('.block-content-inner');\n\n    if (bci != null) {\n      bci.addClass('figure-focused grid-focused');\n    }\n  }\n\n  figure.focus();\n};\n\nEditor.prototype.handleGrafFigureSelectImg = function (ev, matched) {\n  var element;\n  var text = this.getSelectedText();\n\n  if (text && text.killWhiteSpace().length > 0) {\n    return false;\n  }\n\n  element = matched ? matched : ev.currentTarget;\n  var sec = element.closest('.with-background');\n\n  if (sec != null) {\n    this.selectFigure(sec);\n  } else {\n    this.selectFigure(element.closest('.item-figure'));\n  }\n\n  if (this.mode == 'write' || this.mode == 'read') {\n    //ev.preventDefault();\n    return false;\n  }\n};\n\nEditor.prototype.handleGrafFigureTypeCaption = function (ev) {\n  var element = ev.currentTarget,\n      text = element.textContent,\n      figure = element.closest('figure');\n\n  if (figure != null) {\n    if (!text || text.isEmpty()) {\n      figure.addClass('item-text-default');\n    } else {\n      figure.removeClass('item-text-default');\n    }\n  }\n\n  return;\n};\n\nEditor.prototype.handleFigureAnchorClick = function (ev, matched) {\n  ev.preventDefault();\n  return false;\n};\n\nEditor.prototype.handleKeyDownOnFigure = function (ev, figure) {\n  var keyCode = ev.keyCode;\n\n  if (!this.image_toolbar) {\n    return;\n  }\n\n  switch (keyCode) {\n    case LEFTARROW:\n      this.image_toolbar.commandPositionSwitch('left', figure);\n      ev.preventDefault();\n      return false;\n      break;\n\n    case RIGHTARROW:\n      this.image_toolbar.commandPositionSwitch('right', figure);\n      ev.preventDefault();\n      return false;\n      break;\n\n    case UPARROW:\n      ev.preventDefault();\n      this.image_toolbar.commandPositionSwitch('up', figure);\n      return false;\n      break;\n\n    case DOWNARROW:\n      ev.preventDefault();\n      this.image_toolbar.commandPositionSwitch('down', figure);\n      return false;\n      break;\n\n    case ENTER:\n      break;\n  }\n};\n\nEditor.prototype.handleImageActionClick = function (ev, matched) {\n  var tg = matched ? matched : ev.currentTarget,\n      action = tg.attr('data-action'),\n      figure = tg.closest('figure');\n  _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].stopEvent(ev);\n\n  switch (action) {\n    case 'remove':\n      if (this.image_toolbar) {\n        ev.preventDefault();\n        this.image_toolbar.removeFigure(figure);\n        return false;\n      }\n\n      break;\n\n    case 'goleft':\n      if (this.image_toolbar) {\n        ev.preventDefault();\n        this.image_toolbar.commandPositionSwitch('left', figure);\n        return false;\n      }\n\n      break;\n\n    case 'goright':\n      if (this.image_toolbar) {\n        ev.preventDefault();\n        this.image_toolbar.commandPositionSwitch('right', figure);\n        return false;\n      }\n\n      break;\n\n    case 'godown':\n      if (this.image_toolbar) {\n        ev.preventDefault();\n        this.image_toolbar.commandPositionSwitch('down', figure);\n        return false;\n      }\n\n      break;\n\n    case 'goup':\n      if (this.image_toolbar) {\n        ev.preventDefault();\n        this.image_toolbar.commandPositionSwitch('up', figure);\n        return false;\n      }\n\n    case 'addpic':\n      var row = figure.closest('.block-grid-row');\n\n      if (row != null) {\n        this.streamer.notifySubscribers('Katana.Images.Add', {\n          row: row\n        });\n      } else {\n        this.streamer.notifySubscribers('Katana.Images.Add', {\n          figure: figure\n        });\n      }\n\n      break;\n\n    case 'stretch':\n      if (this.image_toolbar) {\n        this.image_toolbar.commandPositionSwitch('stretch', figure);\n        return false;\n      }\n\n      break;\n  }\n};\n\nEditor.prototype.embedIFrameForPlayback = function (ev) {\n  var elem = ev.target,\n      frameContainer = elem.closest('.iframeContainer'),\n      image = null;\n\n  if (frameContainer != null) {\n    image = frameContainer.querySelector('[data-frame-url]');\n  }\n\n  if (image != null) {\n    var frameUrl = image.attr('data-frame-url') + '&autoplay=1';\n    var iframe = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement('<iframe src=\"' + frameUrl + '\"></iframe>');\n    image.parentNode.replaceChild(iframe, image);\n    frameContainer.addClass('hide-controls');\n  }\n}; // Image toolbar related ends //\n\n/** \n* after image/embeds layout manipulation, we may end up with lots of linear same layouts\n* function merges them together\n*/\n\n\nEditor.prototype.mergeInnerSections = function (section) {\n  var _this = this;\n\n  var merge = function merge() {\n    var inners = section.querySelectorAll('.block-content-inner');\n\n    if (inners.length) {\n      for (var i = 0; i < inners.length; i = i + 1) {\n        var curr = inners[i],\n            k = i + 1,\n            next = typeof inners[k] != 'undefined' ? inners[k] : false;\n\n        if (next) {\n          if (next.querySelectorAll('.item').length == 0) {\n            next.parentNode.removeChild(next);\n            return merge();\n          }\n\n          if (!curr.hasClass('block-grid') && _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].elementsHaveSameClasses(curr, next)) {\n            next.querySelectorAll('.item').forEach(function (elm) {\n              curr.appendChild(elm);\n            });\n\n            _this.setupFirstAndLast();\n\n            next.parentNode.removeChild(next);\n            return merge();\n          }\n        }\n      }\n    }\n  };\n\n  merge(0);\n};\n\nEditor.prototype.cleanUpInnerSections = function () {\n  var inners = this.elNode.querySelectorAll('.block-content-inner');\n\n  for (var i = 0; i < inners.length; i = i + 1) {\n    var curr = inners[i];\n\n    if (curr.querySelectorAll('.item').length == 0) {\n      curr.parentNode.removeChild(curr);\n    }\n  }\n\n  var blockGrid = this.elNode.querySelectorAll('.block-grid');\n\n  for (var i = 0; i < blockGrid.length; i = i + 1) {\n    var curr = blockGrid[i];\n\n    if (curr.querySelectorAll('.item-figure').length == 0) {\n      curr.parentNode.removeChild(curr);\n    }\n  }\n\n  var blockRows = this.elNode.querySelectorAll('.block-grid-row');\n\n  for (var i = 0; i < blockRows.length; i = i + 1) {\n    var curr = blockRows[i];\n\n    if (curr.querySelectorAll('.item-figure').length == 0) {\n      curr.parentNode.removeChild(curr);\n    }\n  }\n};\n\nEditor.prototype.fixSectionClasses = function () {\n  this.elNode.querySelectorAll('section').forEach(function (el) {\n    el.removeClass('block-first');\n    el.removeClass('block-last');\n  });\n  var fc = this.elNode.querySelector('section:first-child');\n\n  if (fc != null) {\n    fc.addClass('block-first');\n  }\n\n  var lc = this.elNode.querySelector('section:last-child');\n\n  if (lc != null) {\n    lc.addClass('block-last');\n  }\n};\n\nEditor.prototype.refreshStoriesMenus = function (val) {\n  if (val == '') {\n    return;\n  }\n\n  var toAdd = null;\n\n  if (val == 'featured') {\n    var menu = this.menuOpts[0];\n    toAdd = document.createElement('option');\n    toAdd.value = menu[0];\n    toAdd.text = menu[1];\n  } else if (val == 'latest') {\n    var menu = this.menuOpts[1];\n    toAdd = document.createElement('option');\n    toAdd.value = menu[0];\n    toAdd.text = menu[1];\n  }\n\n  var stfors = this.elNode.querySelectorAll('.block-stories [data-for=\"storytype\"]');\n\n  if (stfors.length) {\n    for (var i = 0; i < stfors.length; i = i + 1) {\n      var stf = stfors[i];\n\n      if (toAdd != null) {\n        stf.appendChild(toAdd);\n      }\n    }\n  }\n};\n\nEditor.prototype.removeUnnecessarySections = function () {\n  var sects = this.elNode.querySelectorAll('section');\n\n  for (var i = 0; i < sects.length; i = i + 1) {\n    var sec = sects[i];\n\n    if (sec.querySelectorAll('.item').length == 0) {\n      sec.parentNode.removeChild(sec);\n    }\n  }\n\n  this.parallaxCandidateChanged();\n};\n\nEditor.prototype.mergeWithUpperSection = function (curr) {\n  var upper = curr.prev('.block-content');\n\n  if (upper != null) {\n    var mb = upper.querySelector('.main-body');\n\n    if (mb != null) {\n      var cmb = curr.querySelector('.main-body > .block-content-inner');\n      mb.appendChild(cmb);\n    }\n\n    curr.parentNode.removeChild(curr);\n    this.mergeInnerSections(upper);\n    var newLast = upper.querySelector('.item:last-child');\n\n    if (newLast != null) {\n      this.markAsSelected(newLast);\n    }\n  }\n\n  this.parallaxCandidateChanged();\n};\n\nEditor.prototype.splitContainer = function (atNode, insrtSection, carryContent) {\n  var currContainer = atNode.closest('.block-content'),\n      currInner = atNode.closest('.block-content-inner'),\n      insertAfterContainer,\n      newContainer,\n      newInner,\n      carry = carryContent ? true : carryContent,\n      insertSection = typeof insrtSection == 'undefined' || insrtSection == null ? _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.getSingleSectionTemplate()) : insrtSection,\n      carryContainer = false;\n\n  if (!carry) {\n    newContainer = insertSection;\n    newContainer.insertAfter(currContainer);\n    carryContainer = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.getSingleSectionTemplate());\n    carryContainer.insertAfter(newContainer);\n    newContainer = carryContainer;\n    insertAfterContainer = carryContainer;\n  } else {\n    newContainer = insertSection;\n    insertAfterContainer = currContainer;\n  }\n\n  newInner = newContainer.querySelector('.main-body');\n\n  if (currInner != null) {\n    while (currInner.nextElementSibling != null) {\n      newInner.appendChild(currInner.nextElementSibling);\n    }\n  }\n\n  var splittedLayout = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.getSingleLayoutTempalte());\n  splittedLayout.attr('class', currInner.attr('class'));\n\n  while (atNode.nextElementSibling != null) {\n    splittedLayout.appendChild(atNode.nextElementSibling);\n  }\n\n  splittedLayout.insertBefore(atNode, splittedLayout.firstChild);\n  newInner.insertBefore(splittedLayout, newInner.firstChild);\n  newContainer.insertAfter(insertAfterContainer);\n  this.removeUnnecessarySections();\n  this.fixSectionClasses();\n};\n\nEditor.prototype.appendTextSection = function () {\n  var sec = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.getSingleSectionTemplate());\n  var mb = sec.querySelector('.main-body');\n\n  if (mb != null) {\n    var mbs = '<div class=\"block-content-inner center-column\"><p class=\"item item-p item-empty\" name=\"' + _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId() + '\"><br /></p></div>';\n    mb.appendChild(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(mbs));\n  }\n\n  this.elNode.appendChild(sec);\n};\n\nEditor.prototype.parallaxImages = []; // canvas scrolling related stuff\n\nEditor.prototype.parallaxCandidateChanged = function () {\n  var sects = this.elNode.querySelectorAll('.image-in-background'),\n      scrolling,\n      _this = this,\n      parallaxRect = this.parallax.getBoundingClientRect();\n\n  if (this.parallaxContext && sects.length) {\n    sects.forEach(function (se) {\n      se.addClass('talking-to-canvas');\n      se.removeClass('talk-to-canvas');\n    });\n  }\n\n  this.parallaxImages = [];\n  this.sectionsForParallax = sects;\n\n  for (var i = 0; i < sects.length; i = i + 1) {\n    var item = sects[i];\n    var bg = item.querySelector('.block-background-image');\n\n    if (bg != null) {\n      // const styles = getComputedStyle(bg);\n      var path = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStyle(bg, 'backgroundImage'); // styles.getPropertyValue('background-image');\n\n      path = /^url\\((['\"]?)(.*)\\1\\)$/.exec(path);\n      path = path ? path[2] : '';\n\n      if (path != '') {\n        var img = new Image();\n        img.src = path;\n        this.parallaxImages.push(img);\n      }\n    }\n  }\n\n  scrolling = function scrolling() {\n    _this.checkViewPortForCanvas();\n  };\n\n  if (sects != null && sects.length) {\n    _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].unregisterFromScroll('katana', scrolling);\n    _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].registerForScroll('katana', scrolling);\n    this.checkViewPortForCanvas();\n  } else if (!sects.length) {\n    this.parallaxContext.clearRect(0, 0, parallaxRect.width, parallaxRect.height);\n    _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].unregisterFromScroll('katana', scrolling);\n  }\n};\n\nEditor.prototype.calculatePosition = function (img, sect) {\n  var iratio = img.naturalWidth / img.naturalHeight,\n      sectionRect = sect.getBoundingClientRect(),\n      sectionWidth = sectionRect.width,\n      sectionHeight = sectionRect.height,\n      sectionBottom = sectionRect.bottom,\n      parallaxRect = this.parallax.getBoundingClientRect(),\n      canvasHeight = parallaxRect.height,\n      scaledImageWidth = sectionWidth,\n      scaledImageHeight = scaledImageWidth / iratio;\n  var padding = 50,\n      singlePad = padding / 2;\n  var iX, iY, iWidth, iHeight, cX, cY, cWidth, cHeight;\n\n  if (sectionHeight > scaledImageHeight - padding) {\n    var delta = sectionHeight - canvasHeight,\n        buffer = scaledImageHeight - canvasHeight,\n        factor = buffer / delta;\n\n    if (sectionRect.top >= 0) {\n      iY = 0;\n      cY = sectionRect.top;\n      cHeight = canvasHeight;\n    } else if (sectionBottom < canvasHeight) {\n      iY = canvasHeight - sectionBottom;\n      cHeight = sectionBottom;\n      cY = 0;\n    } else {\n      iY = -1 * sectionRect.top * factor;\n      cY = 0;\n      cHeight = sectionRect.height + sectionRect.top;\n    }\n\n    iHeight = img.naturalWidth * cHeight / sectionWidth;\n  } else {\n    if (sectionRect.top >= 0) {\n      iY = 0;\n      cY = sectionRect.top;\n      cHeight = sectionRect.height - sectionRect.top;\n    } else {\n      iY = -1 * sectionRect.top;\n      cY = 0;\n      cHeight = sectionRect.height + sectionRect.top;\n    }\n\n    iHeight = img.naturalWidth * cHeight / sectionWidth;\n  }\n\n  iX = 0;\n  cX = 0;\n  iWidth = img.naturalWidth;\n  cWidth = sectionWidth;\n  return {\n    ix: iX,\n    iy: iY,\n    iw: iWidth,\n    ih: iHeight,\n    cx: cX,\n    cy: cY,\n    cw: cWidth,\n    ch: cHeight\n  };\n};\n\nEditor.prototype.checkViewPortForCanvas = function () {\n  var i = 0,\n      sect,\n      sections = this.sectionsForParallax,\n      isVisible = false,\n      draf = [],\n      videos = [];\n\n  for (; i < sections.length; i = i + 1) {\n    sect = sections[i];\n    isVisible = sect.isElementVerticallyInViewPort();\n\n    if (isVisible) {\n      if (this.mode == 'read' && sect.hasClass('video-in-background')) {\n        videos.push(sect);\n      } else {\n        var img = this.parallaxImages[i],\n            pos = this.calculatePosition(img, sect);\n        draf.push([img, pos]);\n      }\n    }\n  }\n\n  var parallaxRect = this.parallax.getBoundingClientRect();\n\n  if (draf.length > 0) {\n    this.parallaxContext.clearRect(0, 0, parallaxRect.width, parallaxRect.height);\n    this.addImageToCanvas(draf);\n  } else {\n    this.parallaxContext.clearRect(0, 0, parallaxRect.width, parallaxRect.height);\n  }\n\n  if (this.mode == 'read') {\n    if (videos.length) {\n      _player__WEBPACK_IMPORTED_MODULE_5__[\"default\"].cameInView(videos);\n    } else {\n      _player__WEBPACK_IMPORTED_MODULE_5__[\"default\"].notInView();\n    }\n  }\n};\n\nEditor.prototype.addImageToCanvas = function (draf, image, pos) {\n  for (var i = 0; i < draf.length; i = i + 1) {\n    var image = draf[i][0];\n    var pos = draf[i][1];\n    this.parallaxContext.drawImage(image, pos.ix, pos.iy, pos.iw, pos.ih, pos.cx, pos.cy, pos.cw, pos.ch);\n  }\n};\n/** notes related **/\n\n\nEditor.prototype.showNoteIcon = function (ev) {\n  if (this.notesManager) {\n    this.notesManager.showNote(ev);\n  }\n};\n/** notes related ends **/\n\n/** mobile touch handling **/\n\n\nvar _pressWatch = null,\n    _pressHappened = false;\n\nEditor.prototype.handleTap = function (ev) {\n  var _this13 = this;\n\n  if (_pressHappened) {\n    setTimeout(function () {\n      var txt = _this13.getSelectedText();\n\n      if (txt == '' && _pressWatch) {\n        clearInterval(_pressWatch);\n        _pressHappened = false;\n      }\n    }, 100); // force wait\n  }\n};\n\nEditor.prototype.handlePress = function (ev) {\n  var _pressHappened = true,\n      prev,\n      _this = this;\n\n  _pressWatch = setInterval(function () {\n    var txt = _this.getSelectedText();\n\n    if (prev && txt != prev && txt != '') {\n      _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].animationFrame.call(window, function () {\n        _this.handleMouseUp(false);\n      });\n    } else if (!prev && txt != '') {\n      _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].animationFrame.call(window, function () {\n        _this.handleMouseUp(false);\n      });\n    }\n\n    prev = txt;\n  }, 250);\n};\n/** mobile touch handling ends **/\n\n/** section stories event handling **/\n\n\nEditor.prototype.handleSectionToolbarItemClicked = function (ev) {\n  var tg = ev.currentTarget,\n      action = tg.attr('data-action');\n\n  if (this.section_options) {\n    this.section_options.command(action, tg);\n    this.activateBlock(tg);\n    return;\n  }\n};\n\nEditor.prototype.handleSectionToolbarItemKeyUp = function (ev) {\n  var which = ev.which,\n      stopFor = [BACKSPACE, DELETE, LEFTARROW, RIGHTARROW];\n\n  if (stopFor.indexOf(which) != -1) {\n    ev.stopPropagation();\n    ev.stopImmediatePropagation();\n  }\n\n  return;\n};\n\nEditor.prototype.handleSectionToolbarItemKeyDown = function (ev) {\n  var which = ev.which,\n      stopFor = [BACKSPACE, DELETE, LEFTARROW, RIGHTARROW];\n\n  if (stopFor.indexOf(which) != -1) {\n    ev.stopPropagation();\n    ev.stopImmediatePropagation();\n  }\n\n  return;\n};\n\nEditor.prototype.handleSectionToolbarItemKeyPress = function (ev) {};\n\nEditor.prototype.handleSectionToolbarItemMouseUp = function (ev) {\n  _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].simpleStop(ev);\n  return;\n};\n\nEditor.prototype.handleSectionToolbarItemMouseDown = function (ev) {\n  _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].simpleStop(ev);\n  return;\n};\n\nEditor.prototype.handleSectionToolbarItemDblclick = function (ev) {\n  _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].simpleStop(ev);\n  return;\n};\n\nEditor.prototype.handleSelectionStoryTypeChange = function (ev) {\n  var ctg = ev.currentTarget,\n      cont = ctg.closest('.main-controls'),\n      input = cont != null ? cont.querySelector('[data-for=\"tagname\"]') : null,\n      autoCont = input != null ? input.closest('.autocomplete-buttons') : null;\n\n  if (ctg.value == 'tagged') {\n    autoCont.show();\n    input.focus();\n  } else {\n    autoCont.hide();\n  }\n};\n\nEditor.prototype.handleSelectionStoryCountChange = function (ev) {\n  var ctg = ev.currentTarget;\n  var section = ctg.closest('.block-stories');\n  var val = parseInt(ctg.value);\n\n  if (!isNaN(val) && section != null) {\n    section.attr('data-story-count', val);\n    var bd = section.querySelector('.main-body');\n    this.fillStoryPreview(bd, val);\n  }\n};\n\nvar KatanaEditor = function KatanaEditor(opts) {\n  var selector = opts.selector;\n  var node = document.querySelector(selector);\n\n  if (node != null) {\n    return new Editor(_objectSpread(_objectSpread({}, opts), {}, {\n      node: node\n    }));\n  }\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (KatanaEditor);\n\n//# sourceURL=webpack:///./src/js/editor.js?");

/***/ }),

/***/ "./src/js/lib/sanitize.js":
/*!********************************!*\
  !*** ./src/js/lib/sanitize.js ***!
  \********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n/**\n * Copyright (c) 2010 by Gabriel Birke\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the 'Software'), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nfunction Sanitize() {\n  var i, e, options;\n  options = arguments[0] || {};\n  this.config = {};\n  this.config.elements = options.elements ? options.elements : [];\n  this.config.attributes = options.attributes ? options.attributes : {};\n  this.config.attributes[Sanitize.ALL] = this.config.attributes[Sanitize.ALL] ? this.config.attributes[Sanitize.ALL] : [];\n  this.config.allow_comments = options.allow_comments ? options.allow_comments : false;\n  this.allowed_elements = {};\n  this.config.protocols = options.protocols ? options.protocols : {};\n  this.config.add_attributes = options.add_attributes ? options.add_attributes : {};\n  this.dom = options.dom ? options.dom : document;\n\n  for (i = 0; i < this.config.elements.length; i++) {\n    this.allowed_elements[this.config.elements[i]] = true;\n  }\n\n  this.config.remove_element_contents = {};\n  this.config.remove_all_contents = false;\n\n  if (options.remove_contents) {\n    if (options.remove_contents instanceof Array) {\n      for (i = 0; i < options.remove_contents.length; i++) {\n        this.config.remove_element_contents[options.remove_contents[i]] = true;\n      }\n    } else {\n      this.config.remove_all_contents = true;\n    }\n  }\n\n  this.transformers = options.transformers ? options.transformers : [];\n}\n\nSanitize.REGEX_PROTOCOL = /^([A-Za-z0-9\\+\\-\\.\\&\\;\\*\\s]*?)(?:\\:|&*0*58|&*x0*3a)/i; // emulate Ruby symbol with string constant\n\nSanitize.RELATIVE = '__RELATIVE__';\nSanitize.ALL = '__ALL__';\n\nSanitize.prototype.clean_node = function (container) {\n  var fragment = this.dom.createDocumentFragment();\n  this.current_element = fragment;\n  this.whitelist_nodes = [];\n  /**\n   * Utility function to check if an element exists in an array\n   */\n\n  function _array_index(needle, haystack) {\n    var i;\n\n    for (i = 0; i < haystack.length; i++) {\n      if (haystack[i] == needle) return i;\n    }\n\n    return -1;\n  }\n\n  function _merge_arrays_uniq() {\n    var result = [];\n    var uniq_hash = {};\n    var i, j;\n\n    for (i = 0; i < arguments.length; i++) {\n      if (!arguments[i] || !arguments[i].length) continue;\n\n      for (j = 0; j < arguments[i].length; j++) {\n        if (uniq_hash[arguments[i][j]]) continue;\n        uniq_hash[arguments[i][j]] = true;\n        result.push(arguments[i][j]);\n      }\n    }\n\n    return result;\n  }\n  /**\n   * Clean function that checks the different node types and cleans them up accordingly\n   * @param elem DOM Node to clean\n   */\n\n\n  function _clean(elem) {\n    var clone;\n\n    switch (elem.nodeType) {\n      // Element\n      case 1:\n        _clean_element.call(this, elem);\n\n        break;\n      // Text\n\n      case 3:\n        clone = elem.cloneNode(false);\n        this.current_element.appendChild(clone);\n        break;\n      // Entity-Reference (normally not used)\n\n      case 5:\n        clone = elem.cloneNode(false);\n        this.current_element.appendChild(clone);\n        break;\n      // Comment\n\n      case 8:\n        if (this.config.allow_comments) {\n          clone = elem.cloneNode(false);\n          this.current_element.appendChild(clone);\n        }\n\n        break;\n\n      default:\n        if (console && console.log) console.log(\"unknown node type\", elem.nodeType);\n        break;\n    }\n  }\n\n  function _clean_element(elem) {\n    var i, j, clone, parent_element, name, allowed_attributes, attr, attr_name, attr_node, protocols, del, attr_ok;\n\n    var transform = _transform_element.call(this, elem);\n\n    elem = transform.node;\n    name = elem.nodeName.toLowerCase(); // check if element itself is allowed\n\n    parent_element = this.current_element;\n\n    if (this.allowed_elements[name] || transform.whitelist) {\n      this.current_element = this.dom.createElement(elem.nodeName);\n      parent_element.appendChild(this.current_element); // clean attributes\n\n      var attrs = this.config.attributes;\n      allowed_attributes = _merge_arrays_uniq(attrs[name], attrs[Sanitize.ALL], transform.attr_whitelist);\n\n      for (i = 0; i < allowed_attributes.length; i++) {\n        attr_name = allowed_attributes[i];\n        attr = elem.attributes[attr_name];\n\n        if (attr) {\n          attr_ok = true; // Check protocol attributes for valid protocol\n\n          if (this.config.protocols[name] && this.config.protocols[name][attr_name]) {\n            protocols = this.config.protocols[name][attr_name];\n            del = attr.value.toLowerCase().match(Sanitize.REGEX_PROTOCOL);\n\n            if (del) {\n              attr_ok = _array_index(del[1], protocols) != -1;\n            } else {\n              attr_ok = _array_index(Sanitize.RELATIVE, protocols) != -1;\n            }\n          }\n\n          if (attr_ok) {\n            attr_node = document.createAttribute(attr_name);\n            attr_node.value = attr.value;\n            this.current_element.setAttributeNode(attr_node);\n          }\n        }\n      } // Add attributes\n\n\n      if (this.config.add_attributes[name]) {\n        for (attr_name in this.config.add_attributes[name]) {\n          attr_node = document.createAttribute(attr_name);\n          attr_node.value = this.config.add_attributes[name][attr_name];\n          this.current_element.setAttributeNode(attr_node);\n        }\n      }\n    } // End checking if element is allowed\n    // If this node is in the dynamic whitelist array (built at runtime by\n    // transformers), let it live with all of its attributes intact.\n    else if (_array_index(elem, this.whitelist_nodes) != -1) {\n        this.current_element = elem.cloneNode(true); // Remove child nodes, they will be sanitiazied and added by other code\n\n        while (this.current_element.childNodes.length > 0) {\n          this.current_element.removeChild(this.current_element.firstChild);\n        }\n\n        parent_element.appendChild(this.current_element);\n      } // iterate over child nodes\n\n\n    if (!this.config.remove_all_contents && !this.config.remove_element_contents[name]) {\n      for (i = 0; i < elem.childNodes.length; i++) {\n        _clean.call(this, elem.childNodes[i]);\n      }\n    } // some versions of IE don't support normalize.\n\n\n    if (this.current_element.normalize) {\n      this.current_element.normalize();\n    }\n\n    this.current_element = parent_element;\n  } // END clean_element function\n\n\n  function _transform_element(node) {\n    var output = {\n      attr_whitelist: [],\n      node: node,\n      whitelist: false\n    };\n    var i, j, transform;\n\n    for (i = 0; i < this.transformers.length; i++) {\n      transform = this.transformers[i]({\n        allowed_elements: this.allowed_elements,\n        config: this.config,\n        node: node,\n        node_name: node.nodeName.toLowerCase(),\n        whitelist_nodes: this.whitelist_nodes,\n        dom: this.dom\n      });\n      if (transform == null) continue;else if (_typeof(transform) == 'object') {\n        if (transform.whitelist_nodes && transform.whitelist_nodes instanceof Array) {\n          for (j = 0; j < transform.whitelist_nodes.length; j++) {\n            if (_array_index(transform.whitelist_nodes[j], this.whitelist_nodes) == -1) {\n              this.whitelist_nodes.push(transform.whitelist_nodes[j]);\n            }\n          }\n        }\n\n        output.whitelist = transform.whitelist ? true : false;\n\n        if (transform.attr_whitelist) {\n          output.attr_whitelist = _merge_arrays_uniq(output.attr_whitelist, transform.attr_whitelist);\n        }\n\n        output.node = transform.node ? transform.node : output.node;\n      } else {\n        throw new Error(\"transformer output must be an object or null\");\n      }\n    }\n\n    return output;\n  }\n\n  for (var i = 0; i < container.childNodes.length; i++) {\n    _clean.call(this, container.childNodes[i]);\n  }\n\n  if (fragment.normalize) {\n    fragment.normalize();\n  }\n\n  return fragment;\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Sanitize);\n\n//# sourceURL=webpack:///./src/js/lib/sanitize.js?");

/***/ }),

/***/ "./src/js/models/common.js":
/*!*********************************!*\
  !*** ./src/js/models/common.js ***!
  \*********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\nfunction Common() {\n  var opts = arguments.length ? arguments[0] : {};\n  this.factory = opts.factory;\n  this.contentTags = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'pre', 'blockquote', 'li', 'figcaption'];\n  this.markupTags = ['a', 'b', 'strong', 'u', 'i', 'em', 'cite'];\n}\n\nCommon.prototype.readMarkups = function (element) {\n  var _this = this;\n\n  var original = element,\n      workingCopy = original.cloneNode(true),\n      textContent = workingCopy.textContent,\n      markups = [];\n\n  var workOnChildren = function workOnChildren(el) {\n    var children = el.childNodes;\n\n    for (var i = 0; i < children.length; i = i + 1) {\n      var node = children[i];\n\n      if (node.nodeType == Node.ELEMENT_NODE) {\n        var tagName = node.nodeName.toLowerCase();\n\n        if (_this.markupTags.indexOf(tagName) != -1) {\n          tagName = tagName == 'b' ? 'strong' : tagName;\n          tagName = tagName == 'i' ? 'em' : tagName;\n          var o = {};\n          o.tag = tagName;\n\n          if (o.tag == 'a') {\n            o.href = node.attr('href');\n          }\n\n          o.position = _this.findPositionInElement(node, original);\n          markups.push(o);\n        }\n\n        workOnChildren(node);\n      }\n    }\n  };\n\n  workOnChildren(element);\n  return markups;\n};\n\nCommon.prototype.findPositionInElement = function (positionOf, inElement) {\n  var baseElement = positionOf;\n\n  while (baseElement.parentNode != inElement) {\n    baseElement = baseElement.parentNode;\n  }\n\n  var childNodes = inElement.childNodes,\n      start,\n      end,\n      textSoFar = 0;\n\n  for (var i = 0; i < childNodes.length; i = i + 1) {\n    var node = childNodes[i];\n\n    if (baseElement != node) {\n      if (node.nodeType == Node.ELEMENT_NODE) {\n        textSoFar += node.textContent.length;\n      } else if (node.nodeType == Node.TEXT_NODE) {\n        textSoFar += node.nodeValue.length;\n      }\n    } else {\n      break;\n    }\n  }\n\n  start = textSoFar;\n  end = start + positionOf.textContent.length;\n  return {\n    start: start,\n    end: end\n  };\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (new Common());\n\n//# sourceURL=webpack:///./src/js/models/common.js?");

/***/ }),

/***/ "./src/js/models/factory.js":
/*!**********************************!*\
  !*** ./src/js/models/factory.js ***!
  \**********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils */ \"./src/js/utils.js\");\n/* harmony import */ var _stream__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../stream */ \"./src/js/stream.js\");\n/* harmony import */ var _section__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./section */ \"./src/js/models/section.js\");\n/* harmony import */ var _item__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./item */ \"./src/js/models/item.js\");\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./common */ \"./src/js/models/common.js\");\n\n\n\n\n\n\nfunction ModelFactory(opts) {\n  this.opts = opts;\n  this.streamer = _stream__WEBPACK_IMPORTED_MODULE_1__[\"default\"];\n  this.current_editor = opts.editor;\n  this.elNode = this.current_editor.elNode;\n  this.mode = opts.mode || 'read';\n  this._build = this._build.bind(this);\n  this.stop = this.stop.bind(this);\n  this.getSerializer = this.getSerializer.bind(this);\n  this.successCallback = this.successCallback.bind(this);\n  this.errorCallback = this.errorCallback.bind(this);\n  this.cache = {};\n  this.addTo = {};\n}\n\n;\nModelFactory.prototype.warmupOnly = false;\nModelFactory.prototype.goingForUnload = false;\n\nModelFactory.prototype.manage = function (warmup) {\n  var _this = this;\n\n  if (this.mode == 'write') {\n    if (typeof warmup != 'undefined') {\n      this.warmupOnly = true;\n      setTimeout(function () {\n        _this._build();\n      }, 1000);\n    }\n\n    this.timer = setInterval(this._build, 8000);\n    this.streamer.subscribe('Katana.Committer.doSave', function () {\n      _this._build();\n    });\n    window.addEventListener('beforeunload', function (e) {\n      _this.goingForUnload = true;\n      return _this._build();\n    });\n  }\n};\n\nModelFactory.prototype.stop = function () {\n  clearInterval(this.timer);\n};\n\nModelFactory.prototype._cache = {};\n\nModelFactory.prototype._fixNames = function () {\n  var items = this.elNode.querySelectorAll('[name]');\n\n  for (var i = 0; i < items.length; i = i + 1) {\n    var it = items[i];\n    var name = it.attr('name');\n    var duplicates = this.elNode.querySelectorAll('[name=\"' + name + '\"]');\n\n    if (duplicates && duplicates.length > 1) {\n      for (var k = 1; k < duplicates.length; k = k + 1) {\n        var dup = duplicates[k]; // make it nine digit in case we end up with some conflicts again\n\n        dup.attr('name', Math.random().toString(36).slice(9));\n      }\n    }\n  }\n};\n\nModelFactory.prototype.successCallback = function (e) {\n  this.cache = this.addTo;\n};\n\nModelFactory.prototype.errorCallback = function () {};\n\nModelFactory.prototype._build = function () {\n  this._fixNames();\n\n  var sections = this.elNode.querySelectorAll('section'),\n      i = 0,\n      section,\n      serializer = this.getSerializer('section'),\n      delta = false;\n\n  if (this.current_editor.currentRequestCount) {\n    if (this.goingForUnload) {\n      this.goingForUnload = false;\n      return 'Your story has unsaved changes.';\n    }\n\n    return;\n  }\n\n  this.addTo = {};\n\n  for (; i < sections.length; i = i + 1) {\n    section = sections[i];\n    serializer.build(section, i);\n  }\n  /*if (this.warmupOnly) {\n      this.cache = this.addTo;\n      this.warmupOnly = false;\n      return;\n    } */\n\n\n  delta = this.findDelta();\n\n  if (delta) {\n    //TODO generate sequence information here\n    this.streamer.notifySubscribers('Katana.Commit', {\n      delta: delta\n    });\n\n    if (this.goingForUnload) {\n      this.goingForUnload = false;\n      return 'Your story has unsaved changes.';\n    }\n  }\n};\n\nModelFactory.prototype.findDelta = function () {\n  var deltaOb = {},\n      item,\n      citem,\n      prop,\n      addTo = this.addTo,\n      cache = this.cache,\n      changeCounter = 0;\n\n  for (prop in addTo) {\n    if (addTo.hasOwnProperty(prop)) {\n      item = addTo[prop];\n      citem = typeof cache[prop] != 'undefined' ? cache[prop] : false;\n\n      if (citem && !_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].isEqual(item, citem)) {\n        deltaOb[prop] = item;\n        changeCounter++;\n      } else if (!citem) {\n        changeCounter++;\n        deltaOb[prop] = item;\n      }\n    }\n  }\n\n  for (prop in cache) {\n    if (cache.hasOwnProperty(prop)) {\n      citem = cache[prop];\n      item = typeof addTo[prop] == 'undefined' ? true : false;\n\n      if (item) {\n        changeCounter++;\n        deltaOb[prop] = {\n          'removed': true\n        };\n      }\n    }\n  }\n\n  if (changeCounter > 0) {\n    return deltaOb;\n  } else {\n    return false;\n  }\n};\n\nModelFactory.prototype.getLayoutType = function (element) {\n  if (element.hasClass('full-width-column')) {\n    return 6;\n  } else if (element.hasClass('center-column')) {\n    return 5;\n  }\n};\n\nModelFactory.prototype.serializers = {};\n\nModelFactory.prototype.getSerializer = function (name) {\n  if (!this.serializers[name]) {\n    var model = null;\n\n    if (name == 'section') {\n      model = new _section__WEBPACK_IMPORTED_MODULE_2__[\"default\"]({\n        factory: this,\n        common: _common__WEBPACK_IMPORTED_MODULE_4__[\"default\"]\n      });\n    } else if (name == 'item') {\n      model = new _item__WEBPACK_IMPORTED_MODULE_3__[\"default\"]({\n        factory: this,\n        common: _common__WEBPACK_IMPORTED_MODULE_4__[\"default\"]\n      });\n    }\n\n    if (model != null) {\n      this.serializers[name] = model;\n    }\n  }\n\n  return this.serializers[name];\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (ModelFactory);\n\n//# sourceURL=webpack:///./src/js/models/factory.js?");

/***/ }),

/***/ "./src/js/models/item.js":
/*!*******************************!*\
  !*** ./src/js/models/item.js ***!
  \*******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\nfunction Item(opts) {\n  this.common = opts.common;\n}\n\nItem.prototype.getType = function (element) {\n  var tagName = element.tagName.toLowerCase();\n\n  if (this.contentTags.indexOf(tagName) != -1) {\n    return 10;\n  } else {\n    return 11;\n  }\n};\n\nItem.prototype.build = function (element, index, sectionName) {\n  var ob = {};\n  this.elNode = element;\n  this.index = index;\n  ob.type = this.getType(element);\n  ob.name = this.elNode.attr('name');\n  ob.index = this.index;\n  ob.section = sectionName;\n  ob.tag = this.elNode.tagName.toLowerCase();\n\n  if (ob.type == 10) {\n    if (this.elNode.querySelectorAll('.placeholder-text').length) {\n      ob.empty = true;\n    } else if (ob.tag == 'li') {\n      ob.text = this.elNode.textContent;\n      ob.markups = this.common.readMarkups(this.elNode);\n      this.buildList(this.elNode, ob);\n    } else {\n      ob.text = this.elNode.textContent;\n      ob.markups = this.common.readMarkups(this.elNode);\n\n      if (this.elNode.hasClass('text-center')) {\n        ob.center = this.elNode.hasClass('text-center');\n      }\n\n      if (this.elNode.hasClass('pullquote')) {\n        ob.quote = true;\n\n        if (this.elNode.hasClass('with-cite')) {\n          ob.citation = true;\n        }\n      }\n    }\n  } else if (ob.type == 11) {\n    if (ob.tag == 'figure') {\n      this.buildFigure(this.elNode, ob);\n    }\n  }\n\n  this.factory.addTo[ob.name] = ob;\n};\n\nItem.prototype.buildFigure = function (element, ob) {\n  if (element && element.hasClass('item-text-default')) {\n    ob.text = '';\n    ob.empty = true;\n  } else {\n    var caption = element.querySelector('figcaption');\n\n    if (caption != null && caption.querySelector('.placeholder-text') != null) {\n      ob.empty = true;\n    } else {\n      ob.text = caption.textContent;\n      ob.markups = this.common.readMarkups(caption);\n    }\n  }\n\n  var meta = {};\n  var img = element.querySelector('img');\n\n  if (img != null) {\n    meta.resourceId = img.attr('data-image-id');\n    meta.resourceUrl = img.attr('data-delayed-src');\n    var pboxStyle = element.querySelector('.padding-box') != null ? element.querySelector('.padding-box').attr('style') : '';\n    meta.resourceMarkup = {\n      w: img.attr('data-width'),\n      h: img.attr('data-height'),\n      a: pboxStyle\n    };\n  } else {\n    meta.resourceMarkup = {};\n  }\n\n  if (element.hasClass('figure-to-left')) {\n    meta.resourceMarkup.s = element.querySelector('.padding-cont') != null ? element.querySelector('.padding-cont').attr('style') : '';\n    meta.pos = 0;\n  } else if (element.hasClass('figure-full-width')) {\n    meta.resourceMarkup.s = element.querySelector('.padding-cont') != null ? element.querySelector('.padding-cont').attr('data-style') : '';\n    meta.pos = 2;\n  } else if (element.hasClass('figure-in-row')) {\n    meta.resourceMarkup.s = element.querySelector('.padding-cont') != null ? element.querySelector('.padding-cont').attr('style') : '';\n    meta.pos = 3;\n    var st = element.attr('style') ? element.attr('style') : '';\n    meta.width = st.replace('width:', '').replace('%', '').replace(';', '');\n  } else {\n    meta.resourceMarkup.s = element.querySelector('.padding-cont') != null ? element.querySelector('.padding-cont').attr('style') : '';\n    meta.pos = 1;\n  }\n\n  if (element.hasClass('figure-in-row')) {\n    var inner = element.closest('.block-content-inner');\n    meta.partial = inner.attr('data-name');\n    meta.count = inner.attr('data-paragraph-count');\n    var row = element.closest('.block-grid-row');\n    meta.grid = -1;\n    var first = inner.querySelector('.block-grid-row:first-child .item-figure:first-child');\n\n    if (first != null && first == element) {\n      var gridCaption = inner.querySelector('.block-grid-caption');\n\n      if (gridCaption != null && gridCaption.querySelector('.placeholder-text') == null) {\n        ob.text = gridCaption.textContent;\n        ob.markups = this.common.readMarkups(gridCaption);\n        ob.empty = false;\n      }\n    }\n\n    if (inner.hasClass('block-grid-full')) {\n      meta.grid = 2;\n    } else if (inner.hasClass('block-grid-center')) {\n      meta.grid = 0;\n    }\n\n    if (row.length) {\n      meta.row = row.attr('data-name');\n      meta.rowElementCount = row.attr('data-paragraph-count');\n    }\n  } else {\n    meta.partial = false;\n  }\n\n  if (element.hasClass('item-figure') && !element.hasClass('item-iframe')) {\n    ob.type = 12;\n  } else if (element.hasClass('item-iframe')) {\n    ob.type = 13;\n    meta.resourceFrame = img.attr('data-frame-url');\n    meta.resourceAspect = img.attr('data-frame-aspect');\n    meta.resourceUrl = img.attr('src');\n\n    if (element.hasClass('can-go-background')) {\n      meta.allowbg = true;\n    } else {\n      meta.allowbg = false;\n    }\n  }\n\n  if (img != null && img.parentNode.hasClass('markup-anchor')) {\n    meta.link = img.parentNode.attr('href');\n  } else {\n    meta.link = false;\n  }\n\n  ob.meta = meta;\n};\n\nItem.prototype.buildList = function (element, ob) {\n  var prnt = element.closest('.postList'),\n      prntTag = prnt != null ? prnt.tagName.toLowerCase() : null;\n\n  if (prntTag == 'ul') {\n    ob.type = 14;\n  } else if (prntTag == 'ol') {\n    ob.type = 15;\n  }\n\n  if (prnt.length) {\n    if (prnt.attr('type')) {\n      ob.listType = prnt.attr('type');\n    }\n  }\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Item);\n\n//# sourceURL=webpack:///./src/js/models/item.js?");

/***/ }),

/***/ "./src/js/models/section.js":
/*!**********************************!*\
  !*** ./src/js/models/section.js ***!
  \**********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils */ \"./src/js/utils.js\");\n\n\nfunction Section(opts) {\n  this.common = opts.common;\n  this.build = this.build.bind(this);\n}\n\nSection.prototype.handleSelf = function () {\n  var name = this.elNode.attr('name'),\n      ob = {},\n      grounded,\n      markup;\n  ob.name = name;\n  ob.index = this.index;\n  ob.type = 0;\n\n  if (this.elNode.hasClass('block-add-width')) {\n    ob.width = 'add';\n  }\n\n  if (this.elNode.hasClass('with-background')) {\n    grounded = this.elNode.querySelector('.block-background');\n    ob.type = 1;\n    markup = {};\n\n    if (this.elNode.hasClass('talk-to-canvas')) {\n      markup.canvas = true;\n    }\n\n    if (grounded != null) {\n      markup.resourceId = grounded.attr('data-image-id');\n      markup.resourceType = 'image';\n      markup.resourceMarkup = {\n        w: grounded.attr('data-width'),\n        h: grounded.attr('data-height'),\n        a: grounded.attr('data-aspect'),\n        s: grounded.attr('data-style')\n      };\n    }\n\n    var bgImage = this.elNode.querySelector('.block-background-image');\n\n    if (bgImage != null) {\n      var path = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStyle(bgImage, 'backgroundImage');\n      path = /^url\\((['\"]?)(.*)\\1\\)$/.exec(path);\n      path = path ? path[2] : '';\n\n      if (this.elNode.hasClass('video-in-background')) {\n        markup.resourceFrame = bgImage.attr('data-frame-url');\n        markup.resourceAspect = bgImage.attr('data-frame-aspect');\n        ob.type = 2;\n      }\n\n      markup.resourceUrl = path;\n    }\n\n    ob.meta = markup;\n    var caption = this.elNode.querySelector('.section-caption');\n\n    if (caption != null) {\n      if (caption.querySelector('.placeholder-text') != null) {\n        ob.caption = {\n          empty: true\n        };\n      } else {\n        ob.caption = {};\n        ob.caption.text = caption.textContent;\n        ob.caption.markups = this.common.readMarkups(caption);\n      }\n    }\n  } else if (this.elNode.hasClass('block-stories')) {\n    ob.type = 5;\n    markup = {};\n    var storyType = this.elNode.querySelector('[data-for=\"storytype\"]'),\n        storyCount = this.elNode.attr('data-story-count');\n\n    if (storyType != null) {\n      markup.storyType = storyType.value;\n    }\n\n    if (markup.storyType == 'tagged') {\n      var auto = this.elNode.querySelector('.autocomplete');\n\n      if (auto != null) {//FIXME autocomplete\n        // var tagData = (auto).autocomplete('read');\n        // markup.storyTag = tagData;\n      }\n    }\n\n    if (!storyCount) {\n      storyCount = 6;\n    }\n\n    storyCount = parseInt(storyCount);\n\n    if (isNaN(storyCount) || storyCount > 10) {\n      storyCount = 6;\n    }\n\n    markup.storyCount = storyCount;\n\n    if (this.elNode.hasClass('as-list')) {\n      markup.list = 'list';\n    } else if (this.elNode.hasClass('as-image-list')) {\n      markup.list = 'image-list';\n    } else if (this.elNode.hasClass('as-image-grid')) {\n      markup.list = 'image-grid';\n    }\n\n    if (this.elNode.hasClass('block-center-width')) {\n      ob.width = 'center';\n    } else if (this.elNode.hasClass('block-add-width')) {\n      ob.width = 'add';\n    } else if (this.elNode.hasClass('block-full-width')) {\n      ob.width = 'full';\n    }\n\n    ob.meta = markup;\n  }\n\n  this.factory.addTo[name] = ob;\n};\n\nSection.prototype.build = function (element, index) {\n  this.elNode = element;\n  this.index = index;\n  var sectionName = this.elNode.attr('name');\n  this.handleSelf();\n  var layouts = this.elNode.querySelectorAll('.main-body .block-content-inner'),\n      i = 0,\n      layout;\n  childCount = 0;\n\n  for (; i < layouts.length; i = i + 1) {\n    layout = layouts[i];\n    var items = layout.querySelectorAll('.item'),\n        serializer = this.factory.getSerializer('item');\n\n    if (items.length == 0) {\n      layout.parentNode.removeChild(layout);\n    }\n\n    for (var k = 0; k < items.length; k = k + 1) {\n      serializer.build(items[k], childCount + k, sectionName);\n    }\n\n    childCount = childCount + items.length;\n  }\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Section);\n\n//# sourceURL=webpack:///./src/js/models/section.js?");

/***/ }),

/***/ "./src/js/notes/core.js":
/*!******************************!*\
  !*** ./src/js/notes/core.js ***!
  \******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils */ \"./src/js/utils.js\");\n/* harmony import */ var _boot__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../boot */ \"./src/js/boot.js\");\n/* harmony import */ var _stream__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../stream */ \"./src/js/stream.js\");\n/* harmony import */ var _details__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./details */ \"./src/js/notes/details.js\");\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\n\n\nfunction Notes(opts) {\n  this.opts = opts;\n  this.streamer = _stream__WEBPACK_IMPORTED_MODULE_2__[\"default\"];\n  this.handleMouseOver = this.handleMouseOver.bind(this);\n  this.handleNoteIconClick = this.handleNoteIconClick.bind(this);\n  this.incrementCounter = this.incrementCounter.bind(this);\n  this.decrementCounter = this.decrementCounter.bind(this);\n  _boot__WEBPACK_IMPORTED_MODULE_1__[\"default\"].it(this, opts);\n}\n\nNotes.prototype.initialize = function () {\n  var _this2 = this;\n\n  var opts = this.opts;\n\n  var _this = this;\n\n  this.current_editor = opts.editor;\n  opts.icon = this;\n  this.detailsHandler = new _details__WEBPACK_IMPORTED_MODULE_3__[\"default\"](_objectSpread(_objectSpread({}, opts), {}, {\n    node: document.querySelector('#markers_container')\n  }));\n  this.options = opts;\n  this.existing_notes = opts.currentNotes || [];\n  this.layout = opts.layout || 'side';\n  this.commentsCloserElement.addEventListener('click', function (ev) {\n    _this2.detailsHandler.closePreviousBox();\n\n    _this2.deactivateAll();\n  });\n  var w = 'innerWidth' in window ? window.innerWidth : _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getWindowWidth();\n  this.smallScreen = w <= 480 ? true : false;\n  var cc = document.querySelector('.center-column');\n  var layoutWidth = 1020;\n\n  if (cc != null) {\n    layoutWidth = cc.getBoundingClientRect().width;\n  }\n\n  var cen = (w - layoutWidth) / 2,\n      tot = cen + layoutWidth + 355;\n  this.llShift = false;\n\n  if (tot > w) {\n    this.llShift = false;\n    document.querySelector('body').addClass('notes-ll-shift');\n  }\n\n  this.readNotes();\n};\n\nNotes.prototype.events = {\n  'click .note-icon': 'handleNoteIconClick'\n};\n\nNotes.prototype.readNotes = function () {\n  var read_url = this.options.info.read_url + '/' + this.options.info.story.id;\n  var xhr = new XMLHttpRequest();\n  xhr.open(\"GET\", read_url, true);\n\n  xhr.onload = function () {\n    if (xhr.status == \"200\" && xhr.readyState == 4) {\n      try {\n        var resp = JSON.parse(xhr.responseText);\n\n        _this.parseNotes(resp);\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  };\n\n  xhr.send(null);\n};\n\nNotes.prototype.parseNotes = function (data) {\n  if (data && data.success) {\n    var dt,\n        notes = [];\n    dt = data.data;\n    var pieces = {};\n\n    if (dt.notes) {\n      notes = dt.notes;\n\n      for (var i = 0; i < notes.length; i = i + 1) {\n        pieces[notes[i].piece] = notes[i].count;\n      }\n    }\n\n    this.existing_notes = pieces;\n    this.refresh();\n  }\n};\n/** EVENTs handlers **/\n\n\nNotes.prototype.handleNoteIconClick = function (ev, matched) {\n  var currentHovered = matched ? matched : ev.currentTarget,\n      name;\n\n  if (currentHovered && currentHovered.nodeType == 1) {\n    name = currentHovered.attr('note-for');\n    against = document.querySelector('[name=\"' + name + '\"]');\n\n    if (against != null) {\n      this.deactivateAll();\n\n      var _this = this;\n\n      var curr = currentHovered;\n      document.body.addClass('notes-opened');\n      curr.addClass('is-clicked');\n\n      if (!_this.smallScreen) {\n        setTimeout(function () {\n          _this.repositionIcon(curr, against);\n\n          _this.activateCloser(against);\n\n          _this.detailsHandler.showDetailsFor(name, curr);\n        }, 300); // curr.animate({left: '-=160'}, 200, function () {\n        //   _this.activateCloser(curr);\n        // });  \n      } else {\n        _this.activateCloser(against);\n\n        _this.detailsHandler.showDetailsFor(name, curr);\n      }\n    }\n  }\n};\n\nNotes.prototype.commentsCloserElement = document.querySelector('#comments_closer');\n\nNotes.prototype.activateCloser = function (against) {\n  this.commentsCloserElement.addClass('active');\n  var w = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getWindowWidth();\n  var box = against.getBoundingClientRect();\n  var o = box.left + box.width;\n  this.commentsCloserElement.style.right = w - o + 'px';\n};\n\nNotes.prototype.deactivateCloser = function () {\n  this.commentsCloserElement.removeClass('active');\n  document.querySelector('body').removeClass('notes-opened');\n};\n\nNotes.prototype.deactivateAll = function () {\n  var clicked = this.elNode.querySelectorAll(\".is-clicked\");\n\n  if (clicked.length) {\n    clicked.removeClass('is-clicked').addClass('hide');\n\n    var _this = this;\n\n    setTimeout(function () {\n      _this.repositionIcon(clicked, undefined);\n    }, 240);\n  }\n\n  this.deactivateCloser();\n};\n\nNotes.prototype.hidePreviousVisible = function () {\n  var nics = this.elNode.querySelector('.note-icon.empty:not(.is-clicked)');\n\n  if (nics != null) {\n    nics.removeClass('is-active');\n  }\n\n  this.deactivateCloser();\n};\n\nNotes.prototype.showNoteIcon = function (ob) {\n  var noteIcon = this._getNoteIcon(ob);\n\n  noteIcon.addClass('is-active');\n\n  if (ob.selection != null) {\n    var range,\n        selection = ob.selection;\n\n    if (selection.getRangeAt) {\n      range = selection.getRangeAt(0);\n    } else {\n      range = selection[0];\n    }\n  }\n};\n\nNotes.prototype._getNoteIcon = function (ob) {\n  var name = ob.node.attr('name'),\n      node = ob.node,\n      onDark = false;\n\n  if (node.closest('.with-background') != null) {\n    onDark = true;\n  }\n\n  var existing = this.elNode.querySelector('[note-for=\"' + name + '\"]');\n\n  if (existing == null) {\n    if (typeof this.existing_notes[name] == 'undefined') {\n      existing = this._addIcon(name, 0);\n    } else {\n      existing = this._addIcon(name, this.existing_notes[name]);\n    }\n  }\n\n  if (onDark) {\n    existing.addClass('on-dark');\n  } else {\n    existing.removeClass('on-dark');\n  }\n\n  this.positionIcon(existing, node, ob.show);\n  return existing;\n};\n\nNotes.prototype.calculateIconPosition = function (against) {\n  var box = against.getBoundingClientRect();\n  var aoffset = {\n    top: box.top + document.body.scrollTop,\n    left: box.left + document.body.scrollLeft\n  };\n  var top = aoffset.top,\n      left = aoffset.left + box.width + 5;\n\n  if (this.smallScreen) {\n    if (left < 790) {\n      left = 800;\n    }\n  }\n\n  if (against.hasClass('item-h2')) {\n    top += 20;\n  } else if (against.hasClass('item-blockquote')) {\n    left += 42;\n  }\n\n  return {\n    left: left,\n    top: top\n  };\n};\n\nNotes.prototype.repositionIcon = function (icon, against) {\n  var name = icon.attr('note-for');\n  var ag;\n\n  if (typeof against != 'undefined') {\n    ag = against;\n  } else {\n    ag = document.querySelector('[name=\"' + name + '\"]');\n  }\n\n  if (ag != null) {\n    var pos = this.calculateIconPosition(ag);\n    var st = icon.style;\n    st.left = pos.left + 'px';\n    st.top = pos.top + 'px';\n    st.position = 'absolute'; //icon.css({left: pos.left, top : pos.top , position: 'absolute'});  \n\n    setTimeout(function () {\n      icon.removeClass('hide');\n    }, 100);\n  }\n};\n\nNotes.prototype.positionIcon = function (icon, against, show) {\n  if (against.length) {\n    if (this.smallScreen) {\n      //icon.addClass('open');\n      var iClicked = document.querySelector('.item-clicked');\n\n      if (iClicked != null) {\n        iClicked.removeClass('item-clicked');\n      }\n\n      if (typeof show != 'undefined' && show) {\n        this.elNode.removeClass('open');\n\n        var _this = this;\n\n        setTimeout(function () {\n          _this.elNode.addClass('open');\n        }, 200);\n      } else {\n        this.elNode.removeClass('open');\n      }\n\n      icon.addClass('item-clicked');\n    } else {\n      var pos = this.calculateIconPosition(against);\n      var ist = icon.style;\n      ist.left = pos.left + 'px';\n      ist.top = pos.top + 'px';\n      ist.position = 'absolute';\n    }\n  }\n};\n\nNotes.prototype.getIconTemplate = function () {\n  var ht = \"<div class=\\\"notes-marker-container note-icon empty\\\">\\n  <span class=\\\"notes-counter\\\" data-note-count=\\\"\\\"></span>\\n  <i class=\\\"mfi-comment\\\"></i>\\n  </div>\";\n  return _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(ht);\n};\n\nNotes.prototype._addIcon = function (name, currentCount) {\n  var icon = this.getIconTemplate();\n  var iconSpan = icon.querySelector('.notes-counter');\n\n  if (currentCount > 0) {\n    icon.removeClass('empty');\n    iconSpan.text(currentCount);\n    iconSpan.attr('data-note-count', currentCount);\n  }\n\n  icon.attr('note-for', name);\n  this.elNode.append(icon);\n  return icon;\n};\n/** event handlers end **/\n\n\nNotes.prototype.init = function () {\n  var _this = this;\n\n  this.streamer.subscribe('Katana.Event.Notes', function (ev) {\n    var node = ev.node,\n        text = ev.selectedText,\n        selection = null;\n\n    if (typeof ev.selectedText != 'undefined') {\n      selection = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].saveSelection();\n    }\n\n    _this.showNoteIcon({\n      node: node,\n      text: text,\n      selection: selection\n    });\n  });\n};\n\nNotes.prototype.existingNotes = function (notes) {\n  this.existing_notes = notes;\n  this.refresh();\n};\n\nNotes.prototype.currentHover = null; // called by editor on mouse over or tap in case of mobile\n\nNotes.prototype.showNote = function (ev) {\n  var currentHovered = ev.currentTarget,\n      name;\n\n  if (currentHovered && currentHovered.nodeType == 1) {\n    name = currentHovered.attr('name');\n\n    if (name != null && this.currentHover != name && !currentHovered.hasClass('item-empty') && !currentHovered.hasClass('item-figure')) {\n      this.hidePreviousVisible();\n      var ob = {\n        node: currentHovered,\n        text: '',\n        show: true\n      };\n      this.showNoteIcon(ob);\n      this.currentHover = name;\n    }\n  }\n};\n\nNotes.prototype.refresh = function () {\n  this.deactivateCloser();\n  var notes = this.existing_notes;\n\n  for (var name in notes) {\n    if (notes.hasOwnProperty(name)) {\n      var sel = this.current_editor.elNode.querySelector('[name=\"' + name + '\"]');\n\n      if (sel != null) {\n        this.showNoteIcon({\n          node: sel,\n          text: ''\n        });\n      }\n    }\n  }\n\n  this.detailsHandler.existingNotes(notes);\n};\n\nNotes.prototype.incrementCounter = function (name) {\n  var icon = this.elNode.querySelector('[note-for=\"' + name + '\"]');\n\n  if (icon != null) {\n    var counter = icon.querySelector('.notes-counter');\n\n    if (counter != null) {\n      var currentCount = parseInt(counter.attr('data-note-count'));\n\n      if (isNaN(currentCount)) {\n        currentCount = 0;\n      }\n\n      currentCount++;\n      counter.text(currentCount);\n      counter.attr('data-note-count', currentCount);\n      icon.removeClass('empty');\n    }\n  }\n};\n\nNotes.prototype.decrementCounter = function (name) {\n  var icon = this.elNode.querySelector('[note-for=\"' + name + '\"]');\n\n  if (icon != null) {\n    var counter = icon.querySelector('.notes-counter');\n\n    if (counter != null) {\n      var currentCount = parseInt(counter.attr('data-note-count'));\n      currentCount--;\n      counter.text(currentCount);\n      counter.attr('data-note-count', currentCount);\n\n      if (currentCount == 0) {\n        icon.addClass('empty');\n      }\n\n      if (currentCount == 0) {\n        counter.text('+');\n      }\n    }\n  }\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Notes);\n\n//# sourceURL=webpack:///./src/js/notes/core.js?");

/***/ }),

/***/ "./src/js/notes/details.js":
/*!*********************************!*\
  !*** ./src/js/notes/details.js ***!
  \*********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils */ \"./src/js/utils.js\");\n/* harmony import */ var _boot__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../boot */ \"./src/js/boot.js\");\n/* harmony import */ var _stream__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../stream */ \"./src/js/stream.js\");\n\n\n\n\nfunction Details(opts) {\n  this.opts = opts;\n  this.streamer = _stream__WEBPACK_IMPORTED_MODULE_2__[\"default\"];\n  this.handleSaveClick = this.handleSaveClick.bind(this);\n  this.handleCancelClick = this.handleCancelClick.bind(this);\n  this.showDetailsFor = this.showDetailsFor.bind(this);\n  _boot__WEBPACK_IMPORTED_MODULE_1__[\"default\"].it(this, opts);\n}\n\nDetails.prototype.initialize = function () {\n  var opts = this.opts;\n\n  if (opts.notes == null) {\n    opts.notes = {};\n  }\n\n  this.current_editor = opts.editor;\n  this.existing_notes = opts.notes || [];\n  this.iconHandler = opts.icon;\n  this.options = opts;\n  this.commentable = opts.info.commentable;\n  this.story = opts.info.story;\n  this.read_url = opts.info.read_url || '';\n  this.save_url = opts.info.save_url || '';\n  this.delete_url = opts.info.delete_url || '';\n  this.edit_url = opts.info.edit_url || '';\n  this.reply_url = opts.info.reply_url || '';\n  this.privacy_url = opts.info.privacy_url || '';\n  this.smallScreen = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getWindowWidth() <= 480 ? true : false;\n  this.currentUser = typeof Mefacto.User != 'undefined' && Mefacto.User.id != 0 ? Mefacto.User.id : false;\n};\n\nDetails.prototype.isLoggedIn = function () {\n  if (typeof this.story.user_name == 'undefined') {\n    return false;\n  }\n\n  return true;\n};\n\nDetails.prototype.events = {\n  'click .read-prev-notes': 'loadPreviousNotes',\n  'click .note-delete-link': 'handleDeleteClick',\n  'click .note-save-link': 'handleSaveClick',\n  'click .note-cancel-link': 'handleCancelClick',\n  'click .note-reply': 'handleReplyClick',\n  'click .note-edit': 'handleEditClick',\n  'click .note-edit-editor': 'handleEditorEditClick',\n  'click .note-delete-editor-link': 'handleEditorDeleteClick',\n  'click .note-cancel-editor-link': 'handleEditorCancelClick',\n  'click .note-visibility-change': 'handleVisibilityChangeClick',\n  'click .note-update-link': 'handleUpdateClick',\n  'click .note-login-btn': 'handleLoginAttempt',\n  'click .note-close-btn': 'handleCancelClick'\n};\n\nDetails.prototype.handleLoginAttempt = function () {\n  this.elNode.trigger({\n    type: 'Mefacto.UserRequired',\n    from: 'notes'\n  });\n  return false;\n};\n\nDetails.prototype.replyFormTemplate = function () {\n  return \" \\n  <div class=\\\"notes-form\\\">\\n  <textarea id=\\\"notes_textarea\\\" class=\\\"camouflaged editable text-autogrow notes-textarea text-small\\\" placeholder=\\\"Type here..\\\"></textarea>\\n  <div>\\n  <a class=\\\"note-update-link notes-form-link\\\" data-progress=\\\"Saving..\\\" tabindex=\\\"0\\\">Save</a>\\n  <a class=\\\"note-save-link notes-form-link\\\" data-progress=\\\"Saving..\\\" tabindex=\\\"0\\\">Save</a>\\n  <a class=\\\"note-delete-link notes-form-link danger\\\" data-progress=\\\"Deleting..\\\" tabindex=\\\"0\\\">Delete</a>\\n  <a class=\\\"note-cancel-link  notes-form-link plain\\\" tabindex=\\\"0\\\">Cancel</a>\\n  </div>\\n  </div>\";\n};\n\nDetails.prototype.containerTemplate = function (name) {\n  return \"<div class=\\\"notes-list-wrapper\\\" data-cont-for=\\\"\".concat(name, \"\\\">\\n    <div class=\\\"loading-notes\\\"> <span class=\\\"loader dark small ib\\\"></span>loading..</div>\\n    <ul class=\\\"notes-list no-margin\\\"></ul>\\n    <div class=\\\"notes-form-container\\\"></div>\\n    </div>\");\n};\n\nDetails.prototype.getForm = function (mode) {\n  var textArea = null;\n\n  if (this.replyForm == null) {\n    this.replyForm = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.replyFormTemplate());\n    textArea = this.replyForm.querySelector('.notes-textarea');\n\n    if (textArea != null) {\n      textArea.value = '';\n    } //var ta = this.replyForm.find('.notes-textarea').autogrow();\n\n  }\n\n  this.replyForm.removeClass('for-editing');\n  this.replyForm.removeAttribute('data-note-id');\n  this.replyForm.removeAttribute('disabled');\n  var updater = this.updateButtonClasses(this.replyForm);\n\n  if (mode == 'new') {\n    updater.element('.note-delete-link').add('hide').remove('show');\n    updater.element('.note-save-link').add('show').remove('hide');\n    updater.element('.note-update-link').add('hide').remove('show');\n    updater.element('.note-cancel-link').add('show').remove('hide');\n  } else if (mode == 'edit') {\n    updater.element('.note-delete-link').remove('hide').add('show');\n    updater.element('.note-update-link').add('show').remove('hide');\n    updater.element('.note-save-link').add('hide').remove('show');\n    updater.element('.note-cancel-link').add('show').remove('hide');\n  }\n\n  if (textArea) {\n    textArea.value = '';\n  }\n\n  this.replyForm.show();\n  return this.replyForm;\n};\n\nDetails.prototype.updateButtonClasses = function (form) {\n  var handler = function handler() {\n    var _this2 = this;\n\n    var e = null;\n\n    var element = function element(sel) {\n      el = form.querySelector(sel);\n      return _this2;\n    };\n\n    var add = function add(kls) {\n      if (el != null) {\n        el.addClass(kls);\n      }\n\n      return _this2;\n    };\n\n    var remove = function remove(kls) {\n      if (el != null) {\n        el.removeClass(kls);\n      }\n\n      return _this2;\n    };\n\n    return {\n      element: element,\n      add: add,\n      remove: remove\n    };\n  };\n\n  return new handler();\n};\n\nDetails.prototype.getNotesList = function (notes) {\n  var ht = '';\n\n  for (var i = 0; i < notes.length; i = i + 1) {\n    var html = this.getSingleNoteTemplate(notes[i]);\n    ht += html;\n  }\n\n  return ht;\n};\n\nDetails.prototype.createContainer = function (name, notes) {\n  var wrap = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.containerTemplate(name)),\n      eNotes = '';\n\n  if (notes.length) {\n    eNotes = this.getNotesList(notes);\n    var notesList = wrap.querySelector('.notes-list');\n\n    if (notesList != null) {\n      notesList.append(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(eNotes));\n    }\n  } else {\n    var _notesList = wrap.querySelector('.notes-list');\n\n    if (_notesList != null) {\n      _notesList.addClass('notes-list-empty');\n    }\n  }\n\n  this.elNode.append(wrap);\n  return wrap;\n};\n\nDetails.prototype.getContainer = function (name) {\n  var cont = this.elNode.querySelector('[data-cont-for=\"' + name + '\"]');\n\n  if (cont != null) {\n    var notes = typeof this.existing_notes[name] == 'undefined' ? [] : this.existing_notes[name];\n    cont = this.createContainer(name, notes);\n  }\n\n  return cont;\n};\n\nDetails.prototype.getSingleNoteTemplate = function (ob) {\n  var ht = \"<li class=\\\"post-note-item clearfix\\\" data-note-id=\\\"\".concat(ob.noteId, \"\\\">\\n    <div class=\\\"post-note-avatar smarty-photo rounded thumb bordered left\\\">\\n      <div class=\\\"profile-pic-bg\\\" style=\\\"background-image:url('\").concat(ob.avatarUrl, \"');\\\" ></div>\\n    </div>\\n    <div class=\\\"post-note-content-wrap\\\">\\n      <span class=\\\"post-note-author-name\\\">\\n        <a href=\\\"\").concat(ob.authorUrl, \"\\\" title=\\\"\").concat(ob.authorName, \"\\\" > \").concat(ob.authorName, \" </a>\\n      </span>\\n      <span class=\\\"post-note-content\\\">\\n        \").concat(ob.content, \"\\n      </span>\");\n\n  if (ob.edit && this.currentUser && this.currentUser == ob.user) {\n    if (typeof ob.changeTo != 'undefined') {\n      ht += \"<div data-editor-actions data-note=\\\"\".concat(ob.noteId, \"\\\" data-change-visibility=\\\"\").concat(ob.changeTo, \"\\\">\\n          <a class=\\\"note-edit text-small\\\" data-note-id=\\\"\").concat(ob.noteId, \"\\\" tabindex=\\\"0\\\">Edit</a>\\n          <a class=\\\"note-edit-editor\\\" data-edit-btn  tabindex=\\\"0\\\">More</a>\\n          </div>\");\n    } else {\n      ht += \"<div><a class=\\\"note-edit text-small\\\" data-note-id=\\\"\".concat(ob.noteId, \"\\\"  tabindex=\\\"0\\\">Edit</a></div>\");\n    }\n  } else if (ob.edit && typeof ob.changeTo == 'undefined') {\n    ht += \"<div><a class=\\\"note-edit text-small\\\" data-note-id=\\\"\".concat(ob.noteId, \"\\\" tabindex=\\\"0\\\">Edit</a></div>\");\n  } else if (ob.edit && typeof ob.changeTo != 'undefined') {\n    ht += \"<div data-editor-actions data-note=\\\"\".concat(ob.noteId, \"\\\" data-change-visibility=\\\"\").concat(ob.changeTo, \"\\\"><a class=\\\"note-edit-editor\\\" data-edit-btn  tabindex=\\\"0\\\">Edit</a></div>\");\n  }\n\n  ht += \"</div></li>\";\n  return ht;\n};\n\nDetails.prototype.handleUpdateClick = function (ev, matched) {\n  var form = matched ? matched.closest('.notes-form') : ev.currentTarget.closest('.notes-form');\n\n  if (form != null) {\n    var textArea = form.querySelector('textarea');\n    var text = \"\";\n\n    if (textArea != null) {\n      text = textArea.value;\n    }\n\n    var _this = this;\n\n    var deleting = false;\n\n    if (!text || text.trim().length == 0) {\n      //this.removeNote();\n      deleting = true;\n    }\n\n    var noteId = form.attr('data-note-id');\n    var container = form.closest('.notes-list-wrapper');\n    var list = container.querySelector('.notes-list');\n    var note = list != null ? list.querySelector('.post-note-item[data-note-id=\"' + noteId + '\"]') : null;\n    var piece = container.attr('data-cont-for');\n\n    if (deleting) {\n      form.attr('disabled', 'disabled');\n      this.makeRequest(this.delete_url + '/' + noteId, 'DELETE', {}, function (sresp) {\n        if (sresp && sresp.success) {\n          _this.iconHandler.decrementCounter(piece);\n\n          form.unwrap();\n\n          if (note != null) {\n            note.remove();\n          }\n\n          var nFormContainer = container.querySelector('.notes-form-container');\n\n          if (nFormContainer != null) {\n            nFormContainer.append(_this.getForm('new'));\n          }\n        } else {\n          form.removeAttribute('disabled');\n        }\n      }, function () {\n        form.removeAttribute('disabled');\n      }); // update \n    } else {\n      var sob = {};\n      sob.noteId = noteId;\n      sob.note = text;\n      sob.piece = piece;\n      sob.post = this.story.id;\n      sob.draft = this.story.type == 'story' ? false : true;\n      form.attr('disabled', 'disabled');\n      this.makeRequest(this.edit_url, 'POST', sob, function (sresp) {\n        if (sresp && sresp.success) {\n          var pnoteContent = note.querySelector('.post-note-content');\n\n          if (pnoteContent != null) {\n            pnoteContent.innerHTML = text;\n          }\n\n          note.show();\n          form.unwrap();\n          var nFormContainer = container.querySelector('.notes-form-container');\n\n          if (nFormContainer != null) {\n            nFormContainer.append(_this.getForm('new'));\n          }\n        } else {\n          form.removeAttribute('disabled');\n        }\n      }, function () {\n        // error callback\n        form.removeAttribute('disabled');\n      });\n    }\n\n    if (textArea != null) {\n      textArea.value = '';\n    }\n  }\n\n  return false;\n};\n\nDetails.prototype.handleEditorEditClick = function (ev, matched) {\n  var tg = matched ? matched : ev.currentTarget;\n\n  if (tg != null && tg.matches.call(tg, '[data-edit-btn]')) {\n    var actionWrap = tg.closest('[data-editor-actions]'),\n        noteId = actionWrap.attr('data-note');\n\n    if (actionWrap != null) {\n      var currentHTML = actionWrap.innerHTML;\n      currentHTML = '<div class=\"hide\">' + currentHTML + '</div>';\n      var changeToVisibilty = actionWrap.attr('data-change-visibility');\n      var visibilityChangeText = changeToVisibilty == 'public' ? 'Make Public' : 'Make Private';\n      var links = \"<a class=\\\"note-visibility-change \\\" data-changeTo=\\\"\".concat(changeToVisibilty, \"\\\" tabindex=\\\"0\\\">\").concat(visibilityChangeText, \"</a> &nbsp;<a class=\\\"note-delete-editor-link danger\\\"  data-progress=\\\"Deleting..\\\" tabindex=\\\"0\\\">Delete</a> &nbsp;\\n      <a class=\\\"note-cancel-editor-link plain\\\"  tabindex=\\\"0\\\">Cancel</a> &nbsp;\");\n      links += currentHTML;\n      actionWrap.innerHTML = links;\n    }\n  }\n\n  return false;\n};\n\nDetails.prototype.handleEditClick = function (ev, matched) {\n  var tg = matched ? matched : ev.currentTarget;\n\n  if (tg.length && tg.matches.call(tg, '[data-note-id]')) {\n    var alreadyOpen = document.querySelector('.notes-form.for-editing');\n\n    if (alreadyOpen != null) {\n      var ta = alreadyOpen.querySelector('textarea');\n      ta.focus();\n      ta.addClass('blinkOnce');\n    } else {\n      var noteId = tg.attr('data-note-id'),\n          li = tg.closest('.post-note-item[data-note-id=\"' + noteId + '\"]'),\n          form = this.getForm('edit');\n      form.addClass('for-editing');\n      form.attr('data-note-id', noteId);\n      var pNoteContent = li.querySelector('.post-note-content');\n      var textArea = form.querySelector('textarea');\n\n      if (pNoteContent != null && textArea != null) {\n        textArea.value = pNoteContent.innerText;\n      } else if (textArea != null) {\n        textArea.value = '';\n      }\n\n      if (li != null) {\n        li.insertBefore(form, li.firstChild); //form.insertBefore(li);\n\n        li.hide();\n      }\n\n      form.wrap(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement('<li class=\"has-form\"></li>'));\n      textArea.focus();\n    }\n  }\n\n  return false;\n};\n\nDetails.prototype.handleSaveClick = function (ev, matched) {\n  var form = matched ? matched.closest('.notes-form') : ev.currentTarget.closest('.notes-form');\n\n  if (form != null) {\n    var textArea = form.querySelector('textarea');\n    var text = \"\";\n\n    if (textArea != null) {\n      text = textArea.value;\n    }\n\n    var _this = this;\n\n    if (!text || text.trim().length == 0) {\n      return false;\n    }\n\n    var tmplOb = {};\n    tmplOb.noteId = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId();\n    tmplOb.authorName = this.story.user_name;\n    tmplOb.authorUrl = this.story.user_link;\n    tmplOb.avatarUrl = this.story.pic;\n    tmplOb.content = text;\n    tmplOb.edit = true;\n    var note = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.getSingleNoteTemplate(tmplOb)),\n        sob = {},\n        container = form.closest('.notes-list-wrapper');\n    sob.noteId = tmplOb.noteId;\n    sob.note = text;\n    sob.piece = container.attr('data-cont-for');\n    sob.post = this.story.id;\n    sob.draft = this.story.type == 'story' ? false : true;\n    form.attr('disabled', 'disabled');\n    this.saveRequest(sob, function (sresp) {\n      if (sresp && sresp.success) {\n        var list = container.querySelector('.notes-list');\n\n        if (list != null) {\n          list.append(note);\n          list.removeClass('notes-list-empty');\n\n          _this.iconHandler.incrementCounter(sob.piece);\n\n          var ta = form.querySelector('textarea');\n\n          if (ta != null) {\n            ta.focus();\n          }\n\n          var rnote = _this.elNode.find('[data-note-id=\"' + sresp.data.replace_note + '\"]');\n\n          if (rnote != null) {\n            rnote.attr('data-note-id', sresp.data.note_id);\n          }\n\n          form.removeAttribute('disabled');\n        }\n      } else {\n        form.removeAttribute('disabled');\n      }\n    }, function () {\n      form.removeAttribute('disabled');\n    });\n  }\n\n  return false;\n};\n\nDetails.prototype.saveRequest = function (ob, successCallback, errorCallback) {\n  var xhr = new XMLHttpRequest();\n  xhr.open(\"POST\", this.save_url, true);\n\n  xhr.onload = function () {\n    if (xhr.status == \"200\" && xhr.readyState == 4) {\n      try {\n        var response = JSON.parse(xhr.responseText);\n        successCallback(response);\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  };\n\n  xhr.send(ob);\n};\n\nDetails.prototype.handleCancelClick = function (ev, matched) {\n  var tg = matched ? matched : ev.currentTarget,\n      dontClose = false;\n\n  if (tg != null) {\n    var form = tg.closest('.for-editing');\n\n    if (form != null) {\n      var noteId = form.attr('data-note-id'),\n          container = form.closest('.notes-list-wrapper');\n      form.unwrap();\n\n      if (container != null) {\n        var nfc = container.querySelector('.notes-form-container');\n\n        if (nfc != null) {\n          nfc.append(this.getForm('new'));\n        }\n\n        var pnfc = container.querySelector('.post-note-item[data-note-id=\"' + noteId + '\"]');\n\n        if (pnfc != null) {\n          pnfc.show();\n        }\n      }\n\n      dontClose = true;\n    } else {\n      this.closePreviousBox();\n    }\n  }\n\n  if (!dontClose) {\n    this.iconHandler.deactivateAll();\n  }\n\n  return false;\n};\n\nDetails.prototype.handleEditorCancelClick = function (ev, matched) {\n  var tg = matched ? matched : ev.currentTarget;\n\n  if (tg != null) {\n    var actionWrap = tg.closest('[data-editor-actions]');\n\n    if (actionWrap != null) {\n      //var noteId = actionWrap.attr('data-note');\n      var hidenE = actionWrap.querySelector('.hide');\n\n      if (hidenE != null) {\n        actionWrap.innerHTML = hidenE.innerHTML;\n      }\n    }\n  }\n\n  return false;\n};\n\nDetails.prototype.handleVisibilityChangeClick = function (ev, matched) {\n  var tg = matched ? matched : ev.currentTarget,\n      actionWrap = tg.closest('[data-editor-actions]');\n\n  if (actionWrap != null) {\n    var noteId = actionWrap.attr('data-note'),\n        changeTo = tg.attr('data-changeTo'),\n        futureIfSuccess = changeTo == 'public' ? 'private' : 'public',\n        futureTextIfSuccess = changeTo == 'public' ? 'Make Private' : 'Make Public';\n    var xhr = new XMLHttpRequest();\n    xhr.open(\"POST\", this.privacy_url, true);\n\n    xhr.onload = function () {\n      if (xhr.status == \"200\" && xhr.readyState == 4) {\n        try {\n          var resp = JSON.parse(xhr.responseText);\n\n          if (resp && resp.success) {\n            tg.innerText = futureTextIfSuccess;\n            tg.attr('data-changeTo', futureIfSuccess);\n            actionWrap.attr('data-change-visibility', futureIfSuccess);\n          }\n        } catch (e) {\n          console.error(e);\n        }\n      }\n    };\n\n    xhr.send({\n      note: noteId,\n      visible: changeTo\n    });\n  }\n\n  return false;\n};\n\nDetails.prototype.handleEditorDeleteClick = function (ev, matched) {\n  var tg = matched ? matched : ev.currentTarget,\n      actionWrap = tg.closest('[data-editor-actions]');\n\n  if (actionWrap != null) {\n    var noteId = actionWrap.attr('data-note'),\n        container = actionWrap.closest('.notes-list-wrapper'),\n        piece = container.attr('data-cont-for'),\n        noteItem = tg.closest('.post-note-item'),\n        _this = this;\n\n    noteItem.attr('disabled', 'disabled');\n    this.deleteRequest(noteId, function () {\n      if (container.querySelectorAll('.post-note-item').length == 0) {\n        var noteslist = container.querySelector('.notes-list');\n\n        if (noteslist != null) {\n          noteslist.addClass('notes-list-empty');\n        }\n      }\n\n      var notesFormContainer = container.querySelector('.notes-form-container');\n\n      if (notesFormContainer != null) {\n        notesFormContainer.append(_this.getForm('new'));\n      }\n\n      var postNotesItem = container.querySelector('.post-note-item[data-note-id=\"' + noteId + '\"]');\n\n      if (postNotesItem != null) {\n        postNotesItem.remove();\n      }\n\n      var ta = container.querySelector('.notes-form-container textarea');\n\n      if (ta != null) {\n        ta.focus();\n      }\n\n      _this.iconHandler.decrementCounter(piece);\n    }, function () {\n      noteItem.removeAttribute('disabled');\n    });\n  }\n};\n\nDetails.prototype.handleDeleteClick = function (ev, matched) {\n  var tg = matched ? matched : ev.currentTarget,\n      editMode = tg.closest('.for-editing');\n\n  if (editMode != null) {\n    var noteId = editMode.attr('data-note-id'),\n        container = editMode.closest('.notes-list-wrapper'),\n        piece = container.attr('data-cont-for'),\n        _this = this;\n\n    editMode.attr('disabled', 'disabled');\n    this.deleteRequest(noteId, function () {\n      editMode.unwrap();\n      var postNote = container.querySelector('.post-note-item[data-note-id=\"' + noteId + '\"]');\n\n      if (postNote != null) {\n        postNote.remove();\n      }\n\n      _this.iconHandler.decrementCounter(piece);\n\n      if (container.querySelectorAll('.post-note-item').length == 0) {\n        var notesList = container.querySelector('.notes-list');\n\n        if (notesList != null) {\n          notesList.addClass('notes-list-empty');\n        }\n      }\n\n      var notesFormContainer = container.querySelector('.notes-form-container');\n\n      if (notesFormContainer != null) {\n        notesFormContainer.append(_this.getForm('new'));\n      }\n\n      var ta = container.find('.notes-form-container textarea');\n      ta.focus();\n    }, function () {\n      editMode.removeAttribute('disabled');\n    });\n  }\n\n  return false;\n};\n\nDetails.prototype.deleteRequest = function (noteId, successCallback, errorCallback) {\n  var xhr = new XMLHttpRequest();\n  var url = \"\".concat(this.delete_url, \"/\").concat(noteId);\n  xhr.open(\"DELETE\", url, true);\n\n  xhr.onload = function () {\n    if (xhr.readyState == 4 && xhr.status == \"200\") {\n      try {\n        var resp = JSON.parse(xhr.responseText);\n\n        if (resp) {\n          if (resp.success) {\n            successCallback();\n          } else {\n            errorCallback();\n          }\n        } else {\n          errorCallback();\n        }\n      } catch (e) {\n        errorCallback();\n      }\n    }\n  };\n\n  xhr.onerror = function () {\n    errorCallback();\n  };\n\n  xhr.send(null);\n};\n\nDetails.prototype.handleReplyClick = function (ev, matched) {\n  return false;\n};\n\nDetails.prototype.closePreviousBox = function () {\n  var copened = this.elNode.querySelector('.opened');\n\n  if (copened != null) {\n    copened.removeClass('opened');\n  }\n\n  this._currentlyOpen = null;\n};\n\nDetails.prototype._currentlyOpen = null;\n\nDetails.prototype.showDetailsFor = function (name, icon) {\n  if (name && name != this._currentlyOpen) {\n    this.closePreviousBox();\n    this.openFor(name, icon);\n    this._currentlyOpen = name;\n  } else if (name == this._currentlyOpen) {\n    this.closePreviousBox();\n  }\n};\n\nDetails.prototype.getSignInLink = function () {\n  return '<a href=\"javascript::;\" class=\"note-login-btn\">Login to leave a note</a><a class=\"note-close-btn\">Close</a>';\n};\n\nDetails.prototype.loadPreviousNotes = function (ev, matched) {\n  var tg = matched ? matched : ev.currentTarget;\n  var url = tg.attr('href');\n  var container = tg.closest('.notes-list-wrapper');\n  var name = container.attr('data-cont-for');\n  var icon = document.querySelector('[note-for=\"' + name + '\"]');\n  tg.innerHTML = '<span class=\"loader ib small dark\"></span> Loading..';\n  this.loadNotesDetails(name, icon, container, url);\n  return false;\n};\n\nDetails.prototype.loadNotesDetails = function (name, icon, container, loadUrl) {\n  var url = this.read_url + '/' + this.story.id + '/' + name,\n      _this = this,\n      mergeUserObject;\n\n  if (typeof loadUrl != 'undefined') {\n    url = loadUrl;\n  }\n\n  mergeUserObject = function mergeUserObject(note, user) {\n    note.authorName = user.name;\n    note.authorUrl = user.link;\n    note.avatarUrl = user.avatarUrl;\n  };\n\n  var getPreviousUrl = function getPreviousUrl(page) {\n    return \"\".concat(_this.read_url, \"/\").concat(_this.story.id, \"/\").concat(name, \"?page=\").concat(page);\n  };\n\n  var xhr = new XMLHttpRequest();\n  xhr.open(\"GET\", url, true);\n\n  xhr.onload = function () {\n    if (xhr.status == \"200\" && xhr.readyState == 4) {\n      try {\n        container.querySelectorAll('.loading-notes').forEach(function (el) {\n          return el.remove();\n        });\n        container.querySelectorAll('.read-prev-notes').forEach(function (el) {\n          return el.remove();\n        });\n        icon.addClass('notes-loaded');\n        var response = JSON.parse(xhr.responseText);\n\n        if (response && response.success) {\n          var dt = response.data;\n\n          if (dt.notes && dt.users) {\n            var notes = dt.notes;\n\n            for (var i = 0; i < notes.length; i = i + 1) {\n              var user = notes[i].user;\n\n              if (dt.users[user]) {\n                mergeUserObject(notes[i], dt.users[user]);\n              }\n            }\n\n            if (notes.length) {\n              var ht = _this.getNotesList(notes);\n\n              container.querySelectorAll('.read-prev-notes').forEach(function (el) {\n                return el.remove();\n              });\n              var li = container.querySelector('.notes-list');\n\n              if (dt.page) {\n                var page = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(\"<a href=\\\"\".concat(getPreviousUrl(dt.page), \"\\\" class=\\\"read-prev-notes\\\">Read previous</a>\"));\n                li.parentNode.insertBefore(page, li); //(page).insertBefore(li);\n              }\n\n              li.removeClass('notes-list-empty');\n              li.prepend(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(ht));\n            }\n          }\n        }\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  };\n\n  xhr.onerror = function () {\n    container.querySelectorAll('.loading-notes').forEach(function (el) {\n      return el.remove();\n    });\n  };\n\n  xhr.send(null);\n};\n\nDetails.prototype.openFor = function (name, icon) {\n  var container = this.getContainer(name),\n      isLoggedIn = this.isLoggedIn(),\n      form = isLoggedIn ? this.getForm('new') : _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.getSignInLink());\n\n  if (!icon.hasClass('notes-loaded')) {\n    var notesCounter = icon.querySelector('.notes-counter');\n\n    if (notesCounter != null) {\n      var count = notesCounter.attr('data-note-count');\n      count = parseInt(count);\n\n      if (!isNaN(count) && count > 0) {\n        this.loadNotesDetails(name, icon, container);\n      } else {\n        container.querySelectorAll('.loading-notes').forEach(function (el) {\n          return el.remove();\n        });\n      }\n    }\n  }\n\n  container.addClass('opened');\n\n  if (icon.hasClass('on-dark')) {\n    container.addClass('on-dark');\n  } else {\n    container.removeClass('on-dark');\n  }\n\n  var lb = container.querySelector('.note-login-btn');\n\n  if (lb != null) {\n    lb.remove();\n  }\n\n  var lc = container.find('.note-close-btn');\n\n  if (lc != null) {\n    lc.remove();\n  }\n\n  var notesFormContainer = container.querySelector('.notes-form-container');\n\n  if (notesFormContainer != null) {\n    notesFormContainer.append(form);\n  }\n\n  this.positionContainer(container, name);\n\n  if (form && form.querySelector('textarea') != null) {\n    form.querySelector('textarea').focus();\n  }\n};\n\nDetails.prototype.positionContainer = function (container, name) {\n  var against = document.querySelector('[name=\"' + name + '\"]');\n\n  if (against != null) {\n    if (this.smallScreen) {} else {\n      var rect = against.getBoundingClientRect();\n      var offset = {\n        top: rect.top + document.body.scrollTop,\n        left: rect.left + document.body.scrollLeft\n      };\n      var st = container.style;\n      var agwidth = parseFloat(getComputedStyle(against, null).width.replace(\"px\", \"\"));\n      st.left = offset.left + gwidth + 50 + 'px';\n      st.top = offset.top + 'px';\n      st.position = 'absolute';\n    }\n  }\n};\n\nDetails.prototype.makeRequest = function (url, method, params, scallback, ecallback) {\n  var xhr = new XMLHttpRequest();\n  xhr.open(method, url, true);\n\n  xhr.onload = function () {\n    if (xhr.status == \"200\" && xhr.readyState == 4) {\n      try {\n        var response = JSON.parse(xhr.responseText);\n\n        if (typeof scallback != 'undefined') {\n          scallback(response);\n        }\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  };\n};\n\nDetails.prototype.existingNotes = function (notes) {\n  this.existing_notes = notes;\n  this.elNode.innerHTML = ''; // remove all existing notes..\n\n  this.replyForm = null;\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Details);\n\n//# sourceURL=webpack:///./src/js/notes/details.js?");

/***/ }),

/***/ "./src/js/player.js":
/*!**************************!*\
  !*** ./src/js/player.js ***!
  \**************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/js/utils.js\");\n\nvar Player = {};\n\nfunction YouTubePlayer(url) {\n  this._url = url;\n  this.init(url);\n}\n\n;\n\nYouTubePlayer.prototype.init = function () {\n  this.onYoutubePlayerReady = this.onYoutubePlayerReady.bind(this);\n  this.parse();\n  this.createContainers();\n  return this;\n};\n\nYouTubePlayer.prototype.parse = function () {\n  var a = document.createElement('a');\n  a.href = this._url;\n  var path = a.pathname;\n  var videoId = path.replace('/embed/', '');\n  this.videoId = videoId;\n  return this;\n};\n\nYouTubePlayer.prototype.locateContainer = function () {\n  var nodes = document.querySelectorAll('.block-background-image[data-frame-url=\"' + this._url + '\"]');\n\n  if (nodes.length > 0) {\n    return nodes;\n  }\n\n  return false;\n};\n\nYouTubePlayer.prototype.createContainers = function () {\n  var nodes = this.locateContainer(); // in case we have multiple video embeds in background , but video is same.\n\n  if (nodes) {\n    for (var i = 0; i < nodes.length; i = i + 1) {\n      this.initPlayer(this._addContainer(nodes[i]));\n    }\n  }\n};\n\nYouTubePlayer.prototype.backgroundContainerTemplate = function () {\n  return \"<div class=\\\"video-container container-fixed in-background\\\" name=\\\"\".concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"\\\">\\n  <div class=\\\"actual-wrapper\\\" id=\\\"\").concat(_utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateId(), \"\\\"></div>\\n  </div>\");\n};\n\nYouTubePlayer.prototype._addContainer = function (node) {\n  if (node.hasClass('block-background-image')) {\n    var sec = node.closest('.video-in-background');\n\n    if (sec == null) {\n      return;\n    }\n\n    var alreadyAdded = sec.querySelector('.video-container');\n\n    if (alreadyAdded != null) {\n      var tmpl = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.backgroundContainerTemplate());\n      var aspect = node.attr('data-frame-aspect');\n\n      if (aspect && aspect.substring(0, 4) == '1.77') {\n        tmpl.addClass('video16by9');\n      } else if (!aspect) {\n        tmpl.addClass('video16by9');\n      }\n\n      tmpl.hide();\n      node.parentNode.insertBefore(tmpl, node);\n      return tmpl;\n    } else {\n      return alreadyAdded;\n    }\n  }\n};\n\nYouTubePlayer.prototype.initPlayer = function (container) {\n  if (typeof container == 'undefined') {\n    return;\n  }\n\n  var containerWrapper = container.querySelector('.actual-wrapper');\n\n  if (containerWrapper == null) {\n    return;\n  }\n\n  var containerId = containerWrapper.attr('id'),\n      width,\n      height,\n      playerOptions = {\n    autohide: true,\n    autoplay: false,\n    controls: 0,\n    disablekb: 1,\n    iv_load_policy: 3,\n    loop: 0,\n    modestbranding: 1,\n    showinfo: 0,\n    rel: 0\n  };\n  containerWrapper = container.closest('.block-background');\n\n  if (containerWrapper != null) {\n    var wrapperRect = containerWrapper.getBoundingClientRect();\n    width = wrapperRect.right - wrapperRect.left;\n    var wH = wrapperRect.bottom - wrapperRect.top;\n    height = wH < _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getWindowHeight() ? wH : _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getWindowHeight();\n  } else {\n    playerOptions.controls = 1;\n  }\n\n  new YT.Player(containerId, {\n    videoId: this.videoId,\n    playerVars: playerOptions,\n    events: {\n      'onReady': this.onYoutubePlayerReady\n    }\n  }); // this.players[containerId] = player;\n};\n\nYouTubePlayer.prototype.onYoutubePlayerReady = function (event) {\n  var target = event.target,\n      frame = target.getIframe(),\n      frameWrap = frame.closest('.video-container'),\n      sectionBackground = frame.closest('.block-background'),\n      containerSection = frame.closest('.video-in-background');\n\n  if (frameWrap != null && containerSection != null) {\n    var wh = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getWindowHeight(),\n        ww = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getWindowWidth(),\n        buttonsCont = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement('<div class=\"button-controls\"><div class=\"container\"><div class=\"row\"><div class=\"col-lg-12 columns\"></div></div></div></div>');\n    playButton = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement('<span class=\"play-button\" stat=\"play\"><i class=\"mfi-action\"></i></span>'), muteButton = _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement('<span class=\"mute-button\" stat=\"unmute\"><b><i class=\"mfi-action\"></i></b></span>');\n    asp = frameWrap.hasClass('video16by9') ? 1.77 : 1.33, frameHeight = ww / asp;\n    frame.attr('height', frameHeight);\n    frame.removeAttribute('width');\n    var neg = -1 * (frameHeight - wh) / 2;\n    var fsty = frameWrap.style;\n    fsty.position = 'absolute';\n    fsty.zIndex = 0;\n    fsty.top = neg + 'px';\n    var columns = buttonsCont.querySelector('.columns');\n\n    if (columns != null) {\n      columns.append(playButton);\n      columns.append(muteButton);\n    }\n\n    sectionBackground.insertAdjacentElement('afterend', buttonsCont);\n    sectionBackground.style.height = wh + 'px';\n    sectionBackground.style.overflow = 'hidden';\n    containerSection.addClass('video-frame-loaded player-youtube');\n    containerSection.style.position = relative;\n    var cf = containerSection.querySelector('.container-fixed');\n\n    if (cf != null) {\n      cf.show();\n    }\n\n    playButton.addEventListener('click', function () {\n      var ths = playButton;\n\n      if (ths.attr('stat') == 'pause') {\n        containerSection.toggleClass('video-playing').toggleClass('video-paused');\n        target.pauseVideo();\n        ths.attr('stat', 'play');\n      } else {\n        containerSection.toggleClass('video-playing');\n        containerSection.addClass('hide-preview');\n        target.playVideo();\n        ths.attr('stat', 'pause');\n      }\n    });\n    muteButton.addEventListener('click', function () {\n      var ths = muteButton;\n\n      if (ths.attr('stat') == 'unmute') {\n        target.unMute();\n        ths.attr('stat', 'mute');\n      } else {\n        target.mute();\n        ths.attr('stat', 'unmute');\n      }\n    });\n  } //target.playVideo();\n  // target.mute();\n\n};\n\nPlayer.manage = function (videos) {\n  if (!videos) {\n    return;\n  }\n\n  var youtubeLoadTimer,\n      _this = this;\n\n  if (videos.youtube) {\n    if (YoutubeScriptLoaded) {\n      _this.addYoutubePlayers(videos.youtube);\n    } else {\n      youtubeLoadTimer = setInterval(function () {\n        if (YoutubeScriptLoaded) {\n          clearInterval(youtubeLoadTimer);\n\n          _this.addYoutubePlayers(videos.youtube);\n        }\n      }, 1000);\n    }\n  }\n};\n\nPlayer.addYoutubePlayers = function (urls) {\n  for (var i = 0; i < urls.length; i = i + 1) {\n    var url = urls[i];\n    new YouTubePlayer(url);\n  }\n};\n\nPlayer.notInView = function () {};\n\nPlayer.cameInView = function (sects) {};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Player);\n\n//# sourceURL=webpack:///./src/js/player.js?");

/***/ }),

/***/ "./src/js/polyfills.js":
/*!*****************************!*\
  !*** ./src/js/polyfills.js ***!
  \*****************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\nString.prototype.killWhiteSpace = function () {\n  return this.replace(/\\s/g, '');\n};\n\nString.prototype.reduceWhiteSpace = function () {\n  return this.replace(/\\s+/g, ' ');\n};\n\nString.prototype.toDashedProperty = function () {\n  return this.replace(/([a-z](?=[A-Z]))/g, '$1 ').replace(/\\s/g, '-').toLowerCase();\n};\n\nString.prototype.isEmpty = function () {\n  return this.trim().length === 0;\n}; // polyfill IE9+ jquery.closest alternative\n\n\nif (!Element.prototype.matches) {\n  Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;\n}\n\nif (!Element.prototype.closest) {\n  Element.prototype.closest = function (s) {\n    var el = this;\n\n    do {\n      if (el.matches(s)) return el;\n      el = el.parentElement || el.parentNode;\n    } while (el !== null && el.nodeType === 1);\n\n    return null;\n  };\n}\n\nif (!Element.prototype.parent) {\n  Element.prototype.parent = function (s) {\n    // jquery .parent\n    var el = this;\n\n    if (el.parentNode == null) {\n      return null;\n    }\n\n    if (el.parentNode.parentNode == null) {\n      return null;\n    }\n\n    return el.parentNode.parentNode;\n  };\n}\n\nif (!Element.prototype.parentsUntil) {\n  Element.prototype.parentsUntil = function (s) {\n    var el = this,\n        last = el;\n\n    do {\n      if (el.matches(s)) {\n        return last;\n      }\n\n      last = el;\n      el = el.parentElement || el.parentNode;\n    } while (el !== null && el.nodeType === 1);\n\n    return null;\n  };\n}\n\nif (!Element.prototype.prev) {\n  Element.prototype.prev = function (s) {\n    var el = this;\n    var all = [];\n\n    while (el !== null) {\n      el = el.previousElementSibling || el.previousSibling;\n\n      if (el != null && el.nodeType === 1 && el.matches(s)) {\n        all.push(el);\n      }\n    } //TODO maybe revere order of array\n\n\n    return all.length == 0 ? null : all.length == 1 ? all[0] : all;\n  };\n}\n\nif (!Element.prototype.next) {\n  Element.prototype.next = function (s) {\n    var el = this;\n    var all = [];\n\n    while (el !== null) {\n      el = el.nextElementSibling || el.nextSibling;\n\n      if (el != null && el.nodeType === 1 && el.matches(s)) {\n        all.push(el);\n      }\n    }\n\n    return all.length == 0 ? null : all.length == 1 ? all[0] : all;\n  };\n}\n\n;\n\nif (!Element.prototype.insertAfter) {\n  Element.prototype.insertAfter = function (after) {\n    var el = this;\n\n    if (after == null) {\n      return null;\n    }\n\n    if (after.parentNode == null) {\n      return null;\n    }\n\n    after.parentNode.insertBefore(el, after.nextESibling);\n  };\n}\n\nif (!Element.prototype.hasClass) {\n  Element.prototype.hasClass = function (toTest) {\n    var el = this;\n    return el.classList.contains(toTest);\n  };\n}\n\nif (!Element.prototype.toggleClass) {\n  Element.prototype.toggleClass = function (toToggle) {\n    var el = this;\n\n    if (el.hasClass(toToggle)) {\n      el.removeClass(toToggle);\n    } else {\n      el.addClass(toToggle);\n    }\n\n    return el;\n  };\n}\n\nif (!Element.prototype.addClass) {\n  Element.prototype.addClass = function (toAdd) {\n    var el = this;\n    toAdd = toAdd.trim();\n    var all = toAdd.split(/\\s/);\n\n    if (all.length) {\n      all.forEach(function (a) {\n        el.classList.add(a);\n      });\n    }\n\n    return this;\n  };\n}\n\nif (!Element.prototype.removeClass) {\n  Element.prototype.removeClass = function (toRemove) {\n    var el = this;\n    toRemove = toRemove.trim();\n    var all = toRemove.split(/\\s/);\n\n    if (all.length) {\n      all.forEach(function (a) {\n        el.classList.remove(a);\n      });\n    }\n\n    return this;\n  };\n}\n\nif (!Element.prototype.attr) {\n  Element.prototype.attr = function (key, value) {\n    var el = this;\n\n    if (typeof value === 'undefined') {\n      return el.getAttribute(key);\n    }\n\n    el.setAttribute(key, value);\n    return this;\n  };\n}\n\nif (!Element.prototype.isElementInViewport) {\n  Element.prototype.isElementInViewport = function () {\n    var rect;\n    var el = this;\n    rect = el.getBoundingClientRect();\n    return rect.top >= 0 && rect.left >= 0 && rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) && rect.right <= (window.innerWidth || document.documentElement.clientWidth);\n  };\n}\n\nif (!Element.prototype.isElementVerticallyInViewPort) {\n  Element.prototype.isElementVerticallyInViewPort = function () {\n    var el = this;\n    var rect = el.getBoundingClientRect(),\n        wn = window,\n        dc = document,\n        ch = wn.innerHeight || dc.documentElement.clientHeight,\n        cw = wn.innerWidth || dc.documentElement.clientWidth,\n        vertInView;\n    vertInView = rect.top <= ch && rect.top + rect.height >= 0;\n    return vertInView;\n  };\n}\n\nif (!Element.prototype.hide) {\n  Element.prototype.hide = function () {\n    this.classList.add('hide');\n  };\n}\n\nif (!Element.prototype.show) {\n  Element.prototype.show = function () {\n    this.classList.remove('hide');\n  };\n}\n\nif (!Array.prototype.contains) {\n  Array.prototype.contains = function (el) {\n    return this.indexOf(el) !== -1;\n  };\n}\n\nif (!Node.prototype.remove) {\n  Node.prototype.remove = function () {\n    var el = this;\n\n    if (el.parentNode === null) {\n      return;\n    }\n\n    el.parentNode.removeChild(el);\n  };\n}\n\nif (!Node.prototype.append) {\n  Node.prototype.append = function (toAdd) {\n    var el = this;\n\n    if (toAdd === null) {\n      return;\n    }\n\n    if (toAdd instanceof NodeList) {\n      Array.prototype.forEach.call(toAdd, function (nd) {\n        el.appendChild(nd);\n      });\n    } else {\n      el.appendChild(toAdd);\n    }\n  };\n}\n\nif (!Node.prototype.prepend) {\n  Node.prototype.prepend = function (el) {\n    var refNode = this;\n\n    if (refNode != null && refNode.parentNode != null) {\n      return refNode.parentNode.insertBefore(el, refNode.parentNode.firstElementChild);\n    }\n\n    return null;\n  };\n}\n\nif (!Node.prototype.unwrap) {\n  Node.prototype.unwrap = function (el) {\n    // get the element's parent node\n    var parent = el.parentNode; // move all children out of the element\n\n    while (el.firstChild) {\n      parent.insertBefore(el.firstChild, el);\n    } // remove the empty element\n\n\n    return parent.removeChild(el);\n  };\n}\n\nif (!NodeList.prototype.wrap) {\n  NodeList.prototype.wrap = function (wrapper) {\n    if (this.length == 0) {\n      return;\n    }\n\n    var temp = document.createElement('div'),\n        parent = this.parentNode,\n        insertWhere = this.previousSibling,\n        target;\n    temp.innerHTML = wrapper;\n    target = temp.firstChild;\n\n    while (target.firstChild) {\n      target = target.firstChild;\n    }\n\n    Array.prototype.forEach.call(this, function (a) {\n      target.appendChild(a);\n    });\n    return parent.insertBefore(temp.firstChild, insertWhere ? insertWhere.nextSibling : parent.firstChild);\n  };\n}\n\nif (!Node.prototype.wrap) {\n  Node.prototype.wrap = function (wrapper) {\n    var temp = document.createElement('div'),\n        parent = this.parentNode,\n        insertWhere = this.previousSibling,\n        target;\n    temp.innerHTML = wrapper;\n    target = temp.firstChild;\n\n    while (target.firstChild) {\n      target = target.firstChild;\n    }\n\n    target.appendChild(this);\n    return parent.insertBefore(temp.firstChild, insertWhere ? insertWhere.nextSibling : parent.firstChild);\n  };\n}\n\nvar Poly = {};\n/* harmony default export */ __webpack_exports__[\"default\"] = (Poly);\n\n//# sourceURL=webpack:///./src/js/polyfills.js?");

/***/ }),

/***/ "./src/js/stream.js":
/*!**************************!*\
  !*** ./src/js/stream.js ***!
  \**************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nvar _SubWrap = function _SubWrap(name, cb, set) {\n  this.name = name;\n  this.cb = cb;\n  this.set = set;\n};\n\n_SubWrap.prototype.execute = function (ev) {\n  this.cb(ev);\n};\n\n_SubWrap.prototype.release = function () {\n  this.cb = null;\n  this.set.clear(this);\n};\n\nfunction Stream() {\n  var streamHandlers = {};\n\n  this.subscribe = function (name, cb) {\n    if (typeof streamHandlers[name] === 'undefined') {\n      streamHandlers[name] = new Set();\n    }\n\n    var sub = new _SubWrap(name, cb, streamHandlers[name]);\n    streamHandlers[name].add(sub);\n    return sub;\n  };\n\n  this.notifySubscribers = function (name, ev) {\n    if (typeof streamHandlers[name] === 'undefined') {\n      return;\n    }\n\n    var entries = streamHandlers[name].entries();\n\n    var _iterator = _createForOfIteratorHelper(entries),\n        _step;\n\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var _step$value = _slicedToArray(_step.value, 2),\n            k = _step$value[0],\n            v = _step$value[1];\n\n        v.execute(ev);\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n  };\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (new Stream());\n\n//# sourceURL=webpack:///./src/js/stream.js?");

/***/ }),

/***/ "./src/js/toolbars/image.js":
/*!**********************************!*\
  !*** ./src/js/toolbars/image.js ***!
  \**********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _boot__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../boot */ \"./src/js/boot.js\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils */ \"./src/js/utils.js\");\n/* harmony import */ var _stream__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../stream */ \"./src/js/stream.js\");\n\n\n\n\nfunction ImageToolbar(opts) {\n  this.opts = opts;\n  this.stream = _stream__WEBPACK_IMPORTED_MODULE_2__[\"default\"];\n  this.handleClick = this.handleClick.bind(this);\n  this.initialize = this.initialize.bind(this);\n  this.removeFigure = this.removeFigure.bind(this);\n  this.commandPositionSwitch = this.commandPositionSwitch.bind(this);\n  this.createlink = this.createlink.bind(this);\n  this.handleInputEnter = this.handleInputEnter.bind(this);\n  this.handleKeyDown = this.handleKeyDown.bind(this);\n  this.shortCutKey = this.shortCutKey.bind(this);\n  this.show = this.show.bind(this);\n  this.hide = this.hide.bind(this);\n  _boot__WEBPACK_IMPORTED_MODULE_0__[\"default\"].it(this, opts);\n}\n\nImageToolbar.prototype.el = '#mfImageToolbarBase';\nImageToolbar.prototype.events = {\n  \"mousedown .mf-menu-button\": \"handleClick\",\n  \"click .mf-menu-linkinput .mf-menu-button\": \"closeInput\",\n  \"keypress input\": \"handleInputEnter\",\n  \"keydown input\": \"handleKeyDown\"\n};\nImageToolbar.prototype.menuGridMode = false;\n\nImageToolbar.prototype.hide = function () {\n  this.elNode.removeClass('mf-menu--linkmode');\n  this.elNode.addClass('hide');\n};\n\nImageToolbar.prototype.initialize = function () {\n  var opts = this.opts;\n  this.current_editor = opts.editor;\n  this.mode = opts.mode;\n  this.config = opts.imageToolbarConfig || this.defaultConfig();\n  this.controller = null;\n  this.strReg = {\n    whiteSpace: /(^\\s+)|(\\s+$)/g,\n    mailTo: /^(?!mailto:|.+\\/|.+#|.+\\?)(.*@.*\\..+)$/,\n    http: /^(?!\\w+?:\\/\\/|mailto:|\\/|\\.\\/|\\?|#)(.*)$/\n  };\n};\n\nImageToolbar.prototype.setController = function (controller) {\n  this.controller = controller;\n};\n\nImageToolbar.prototype.defaultConfig = function () {\n  if (this.mode == 'write') {\n    return {\n      buttons: [{\n        a: 'sideleft',\n        i: 'image-left-buldge'\n      }, {\n        a: 'defaultsize',\n        i: 'image-default'\n      }, {\n        a: 'fullwidth',\n        i: 'image-full-width'\n      }, {\n        a: 'background',\n        i: 'image-background'\n      }, {\n        a: 'createlink',\n        i: 'link'\n      }]\n    };\n  }\n\n  return {\n    buttons: []\n  };\n};\n\nImageToolbar.prototype.template = function () {\n  if (this.config.buttons.length > 0) {\n    var html = \"<div class=\\\"mf-menu-linkinput\\\">\\n          <input class=\\\"mf-menu-input\\\" placeholder=\\\"http://\\\">\\n          <div class=\\\"mf-menu-button mf-link-close\\\">&#215;</div>\\n        </div>\\n        <ul class='mf-menu-buttons'>\";\n    this.config.buttons.forEach(function (item) {\n      html += \"<li class='mf-menu-button'><i class=\\\"mf-icon mfi-\".concat(item.i, \"\\\" data-action=\\\"\").concat(item.a, \"\\\"></i></li>\");\n    });\n    html += \"</ul>\";\n    return html;\n  }\n\n  return '';\n};\n\nImageToolbar.prototype.built = false;\n\nImageToolbar.prototype.render = function () {\n  if (!this.built) {\n    var html = this.template();\n    this.elNode.innerHTML = html;\n    this.built = true;\n  }\n\n  return this;\n};\n\nImageToolbar.prototype.refresh = function () {\n  this.elNode.querySelectorAll('.mf-menu-button').forEach(function (el) {\n    el.removeClass('hide');\n  });\n};\n\nImageToolbar.prototype.show = function () {\n  if (this.mode == 'write') {\n    this.current_editor.image_toolbar._show();\n  }\n};\n\nImageToolbar.prototype._show = function () {\n  this.elNode.addClass(\"mf-menu--active\");\n  this.displayHighlights();\n  this.elNode.removeClass('hide');\n};\n\nImageToolbar.prototype.handleClick = function (ev, matched) {\n  var action, element, input;\n\n  if (matched) {\n    element = matched.querySelector('.mf-icon');\n  } else {\n    element = ev.currentTarget.querySelector('.mf-icon');\n  }\n\n  if (element != null) {\n    action = element.attr(\"data-action\");\n\n    if (action) {\n      action = action.trim();\n    }\n\n    if (/(?:createlink)/.test(action)) {\n      this.actionIsLink(ev.currentTarget);\n    } else {\n      this.menuApply(action);\n    }\n\n    this.displayHighlights();\n  }\n\n  return false;\n};\n\nImageToolbar.prototype.shortCutKey = function (key, event) {\n  var didSomething = false;\n\n  switch (key) {\n    case 49:\n      // left budge\n      this.commandSideLeft();\n      didSomething = true;\n      break;\n\n    case 50:\n      // default\n      this.commandDefaultSize();\n      didSomething = true;\n      break;\n\n    case 51:\n      // full width\n      this.commandFullWidth();\n      didSomething = true;\n      break;\n\n    case 52:\n      // background image\n      this.commandBackground();\n      didSomething = true;\n      break;\n  }\n\n  if (didSomething) {\n    var _this = this;\n\n    setTimeout(function () {// _this.current_editor.image_toolbar.show();  \n    }, 50);\n  }\n};\n\nImageToolbar.prototype.actionIsLink = function (target, event) {\n  if (target.hasClass(\"active\")) {\n    this.removeLink();\n  } else {\n    this.elNode.addClass(\"mf-menu--linkmode\");\n\n    if (this.elNode.querySelector(\"input.mf-menu-input\") != null) {\n      this.elNode.querySelector(\"input.mf-menu-input\").focus();\n    }\n\n    if (typeof event != 'undefined') {\n      event.preventDefault();\n    }\n  }\n};\n\nImageToolbar.prototype.removeLink = function () {\n  var sel = document.querySelector('.item-figure.item-selected');\n\n  if (sel != null) {\n    sel.querySelector('img').unwrap();\n  }\n\n  this.elNode.querySelector('.mf-menu-input').value = '';\n};\n\nImageToolbar.prototype.closeInput = function (e) {\n  this.elNode.removeClass(\"mf-menu--linkmode\");\n  return false;\n};\n\nImageToolbar.prototype.handleInputEnter = function (e, matched) {\n  if (e.which === 13) {\n    if (matched) {\n      return this.createlink(matched);\n    } else {\n      return this.createlink(e.target);\n    }\n  }\n};\n\nImageToolbar.prototype.handleKeyDown = function (e) {\n  var which = e.which,\n      bd,\n      overLay;\n\n  if (which == 27) {\n    this.hide();\n  }\n};\n\nImageToolbar.prototype.createlink = function (input) {\n  var action, inputValue;\n  this.elNode.removeClass(\"mf-menu--linkmode\");\n\n  if (input.value != '') {\n    inputValue = input.value.replace(this.strReg.whiteSpace, \"\").replace(this.strReg.mailTo, \"mailto:$1\").replace(this.strReg.http, \"http://$1\");\n    var a = \"<a href=\\\"\".concat(inputValue, \"\\\" data-href=\\\"\").concat(inputValue, \"\\\" class=\\\"markup-anchor markup-figure-anchor\\\"></a>\");\n    var sel = document.querySelector('.item-figure.item-selected');\n\n    if (sel != null) {\n      sel.querySelector('img').wrap(a);\n    }\n\n    this.displayHighlights();\n  }\n};\n\nImageToolbar.prototype.addLink = function (e) {\n  if (this.mode == 'write') {\n    var sel = this.current_editor.elNode.querySelector('.item-figure.item-selected');\n\n    if (sel != null) {\n      this.actionIsLink(this.elNode.querySelector('[data-action=\"createlink\"]').closest('li'), e);\n      return false;\n    }\n  }\n};\n\nImageToolbar.prototype.menuApply = function (action) {\n  if (this.menuGridMode) {\n    if (action == 'defaultsize') {\n      this.commandGridDefault();\n    } else if (action == 'fullwidth') {\n      this.commandGridFullWidth();\n    }\n  } else {\n    if (action == 'sideleft') {\n      this.commandSideLeft();\n    } else if (action == 'fullwidth') {\n      this.commandFullWidth();\n    } else if (action == 'defaultsize') {\n      this.commandDefaultSize();\n    } else if (action == 'background') {\n      this.commandBackground();\n    }\n  }\n};\n\nImageToolbar.prototype.commandGridDefault = function () {\n  var grid = document.querySelector('.grid-focused');\n\n  if (grid != null) {\n    grid.removeClass('block-grid-full');\n    var rows = grid.querySelectorAll('.block-grid-row');\n\n    for (var i = 0; i < rows.length; i = i + 1) {\n      var row = rows[i];\n      var figures = row.querySelectorAll('.item-figure');\n      this.stream.notifySubscribers('Katana.Images.Restructure', {\n        container: row,\n        count: figures.length,\n        figures: figures\n      });\n    }\n  }\n};\n\nImageToolbar.prototype.commandGridFullWidth = function () {\n  var grid = document.querySelector('.grid-focused');\n\n  if (grid != null) {\n    grid.addClass('block-grid-full');\n    var rows = grid.querySelectorAll('.block-grid-row');\n\n    for (var i = 0; i < rows.length; i = i + 1) {\n      var row = rows[i];\n      var figures = row.querySelectorAll('.item-figure');\n      this.stream.notifySubscribers('Katana.Images.Restructure', {\n        container: row,\n        count: figures.length,\n        figures: figures\n      });\n    }\n  }\n};\n\nImageToolbar.prototype.pullFullWidthContainer = function () {\n  var sel = document.querySelector('.item-figure.item-selected');\n\n  if (sel != null && sel.closest('.full-width-column') != null) {\n    var curr = sel.closest('.full-width-column');\n\n    if (curr == null) {\n      return;\n    }\n\n    var prevContainer = curr.prev('.block-content-inner'),\n        nextContainer = curr.next('.block-content-inner'),\n        aspect = sel.querySelector('.padding-cont');\n    aspect.attr('style', aspect.attr('data-style'));\n    aspect.removeAttribute('data-style');\n\n    if (curr.querySelectorAll('.item-figure').length == 1) {\n      // we have not merged two full width containers together\n      if (prevContainer != null) {\n        prevContainer.appendChild(sel);\n      } else {\n        var ct = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.getSingleLayoutTempalte());\n        curr.parentNode.insertBefore(ct, curr);\n        ; //curr.insertBefore(ct, curr.firstChild);\n        //ct.insertBefore(curr);\n\n        ct.appendChild(sel);\n        prevContainer = ct;\n      }\n\n      if (prevContainer != null) {\n        var aPChilds = prevContainer.children;\n        var validPChilds = Array.prototype.filter.call(aPChilds, function (el) {\n          return el.classList.contains('item');\n        });\n\n        if (validPChilds.length == 0) {\n          prevContainer.parentNode.removeChild(prevContainer);\n        }\n      }\n\n      if (nextContainer != null && !nextContainer.hasClass('full-width-column')) {\n        var aNChilds = nextContainer.children;\n        var vNChilds = Array.prototype.filter.call(aNChilds, function (el) {\n          return el.classList.contains('item');\n        });\n\n        if (vNChilds.length > 0) {\n          vNChilds.forEach(function (el) {\n            prevContainer.appendChild(el);\n          });\n        }\n\n        nextContainer.parentNode.removeChild(nextContainer);\n      }\n\n      curr.parentNode.removeChild(curr);\n    } else {\n      // we have merged two full width containers together\n      var firstGraf = curr.querySelector('.item-figure:first-child'),\n          lastGraf = curr.querySelector('.item-figure:last-child');\n\n      if (firstGraf != null && firstGraf == sel) {\n        // add in upper container or create one\n        if (prevContainer != null) {\n          prevContainer.append(sel);\n        } else {\n          var newCont = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.getSingleLayoutTempalte());\n          newCont.appendChild(sel);\n          newCont.insertBefore(curr);\n        }\n      } else if (lastGraf != null && lastGraf == sel) {\n        // add in lower container or create one\n        if (nextContainer != null) {\n          sel.insertBefore(nextContainer.querySelector('.item:first-child'));\n        } else {\n          var newCont = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.getSingleLayoutTempalte());\n          newCont.appendChild(sel);\n          newCont.insertAfter(curr);\n        }\n      } else {\n        // create a layout single inbetween\n        var newBottomContainer = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement('<div class=\"block-content-inner full-width-column\"></div>');\n\n        while (sel.nextElementSibling != null) {\n          newBottomContainer.appendChild(sel.nextElementSibling);\n        }\n\n        var newFigureContainer = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.getSingleLayoutTempalte());\n        newFigureContainer.appendChild(sel);\n        newFigureContainer.insertAfter(curr);\n        newBottomContainer.insertAfter(newFigureContainer);\n      }\n    }\n  }\n};\n\nImageToolbar.prototype.pushFullWidthContainer = function () {\n  var sel = document.querySelector('.item-figure.item-selected');\n\n  if (sel == null || sel.closest('.full-width-column') != null) {\n    return;\n  }\n\n  var bottomContainer = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement('<div class=\"block-content-inner center-column\"></div>'),\n      currentContainer = sel.closest('.block-content-inner'),\n      figureContainer = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement('<div class=\"block-content-inner full-width-column\"></div>');\n\n  while (sel.nextElementSibling != null) {\n    bottomContainer.appendChild(sel.nextElementSibling);\n  }\n\n  if (currentContainer.querySelectorAll('.item').length == 1) {\n    var qitem = currentContainer.querySelector('.item');\n\n    if (qitem == sel) {\n      currentContainer.attr('class', '');\n      currentContainer.addClass('block-content-inner');\n      currentContainer.addClass('full-width-column');\n      bottomContainer.insertAfter(currentContainer);\n    }\n  } else {\n    figureContainer.appendChild(sel);\n    figureContainer.insertAfter(currentContainer);\n    bottomContainer.insertAfter(figureContainer);\n  }\n};\n\nImageToolbar.prototype.removeFigureClasses = function (figure) {\n  figure.removeClass('figure-full-width');\n  figure.removeClass('figure-to-left');\n};\n\nImageToolbar.prototype._commandStretchImageInGrid = function (figure) {\n  var nxtFigures = figure.next('.figure-in-row'),\n      currentRow = figure != null ? figure.closest('.block-grid-row') : null,\n      nextRow = currentRow != null ? currentRow.next('.block-grid-row') : null;\n\n  if (nxtFigures != null) {\n    if (nextRow == null) {\n      var tmpl = \"<div class=\\\"block-grid-row\\\" data-name=\\\"\".concat(_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateId(), \"\\\"></div>\");\n      tmpl = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(tmpl);\n      currentRow.insertAdjacentElement('afterend', tmpl);\n      nextRow = tmpl;\n    }\n\n    if (typeof nxtFigures.length == 'undefined') {\n      nxtFigures = [nxtFigures];\n    }\n\n    nxtFigures.forEach(function (n) {\n      nextRow.insertBefore(n, nextRow.firstChild);\n    });\n  }\n\n  var stretchRow = \"<div class=\\\"block-grid-row\\\" data-name=\\\"\".concat(_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateId(), \"\\\" data-paragraph-count=\\\"1\\\"></div>\");\n  stretchRow = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(stretchRow);\n  stretchRow.appendChild(figure);\n  currentRow.insertAdjacentElement('afterend', stretchRow);\n  this.stream.notifySubscribers('Katana.Images.Restructure', {\n    container: stretchRow,\n    count: 1,\n    figures: [figure]\n  }); // format figure in row just below stretch\n\n  if (nextRow != null) {\n    var nextRowFigures = nextRow.querySelectorAll('.item-figure');\n\n    if (nextRowFigures.length) {\n      nextRowFigures.forEach(function (el) {\n        el.attr('data-paragraph-count', nextRowFigures.length);\n      });\n      this.stream.notifySubscribers('Katana.Images.Restructure', {\n        container: nextRow,\n        count: nextRowFigures.length,\n        figures: nextRowFigures\n      });\n    } else {\n      nextRow.parentNode.removeChild(nextRow);\n    }\n  }\n\n  var currentRowFigures = currentRow.querySelectorAll('.item-figure');\n\n  if (currentRowFigures.length) {\n    currentRowFigures.forEach(function (el) {\n      el.attr('data-paragraph-count', currentRowFigures.length);\n    });\n    this.stream.notifySubscribers('Katana.Images.Restructure', {\n      container: currentRow,\n      count: currentRowFigures.length,\n      figures: currentRowFigures\n    });\n  } else {\n    currentRow.parentNode.removeChild(currentRow);\n  }\n};\n\nImageToolbar.prototype._commandGoDownInGrid = function (sel) {\n  var row = sel.closest('.block-grid-row'),\n      nextRow = row != null ? row.next('.block-grid-row') : null;\n\n  if (row != null) {\n    var figs = row.querySelectorAll('.item-figure');\n\n    if (figs.length == 1) {\n      // we are the only item.. should breakout from the grid now\n      this.current_editor.moveFigureDown(sel);\n      var grid = row.closest('.block-content-inner');\n      var allFig = grid.querySelectorAll('.item-figure');\n      grid.attr('data-paragraph-count', allFig.length);\n      row.parentNode.removeChild(row);\n\n      if (allFig.length == 1) {\n        this._commandGoDownInGrid(allFig[0]);\n      }\n\n      if (allFig.length == 0) {\n        var section = grid.closest('.block-content');\n        grid.parentNode.removeChild(grid);\n\n        if (section != null) {\n          this.current_editor.mergeInnerSections(section);\n        }\n      }\n\n      return;\n    }\n  }\n\n  if (nextRow == null) {\n    var tmpl = \"<div class=\\\"block-grid-row\\\" data-name=\\\"\".concat(_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateId(), \"\\\"></div>\");\n    tmpl = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(tmpl);\n    row.insertAdjacentElement('afterend', tmpl);\n    nextRow = tmpl;\n  }\n\n  nextRow.prepend(sel);\n  var newFigs = nextRow.querySelectorAll('.item-figure');\n  nextRow.attr('data-paragraph-count', newFigs.length);\n  this.stream.notifySubscribers('Katana.Images.Restructure', {\n    container: nextRow,\n    count: newFigs.length,\n    figures: newFigs\n  });\n\n  if (row.querySelectorAll('.item-figure').length == 0) {\n    row.remove();\n  } else {\n    var figs = row.querySelectorAll('.item-figure');\n    row.attr('data-paragraph-count', figs.length);\n    this.stream.notifySubscribers('Katana.Images.Restructure', {\n      container: row,\n      count: figs.length,\n      figures: figs\n    });\n  }\n};\n\nImageToolbar.prototype._commandGoUpInGrid = function (figure) {\n  var currRow = figure.closest('.block-grid-row'),\n      prevRow = currRow.prev('.block-grid-row');\n\n  if (prevRow == null && currRow.querySelectorAll('.item-figure').length == 1) {\n    this.current_editor.moveFigureUp(figure);\n    return;\n  }\n\n  if (prevRow == null) {\n    var tmpl = \"<div class=\\\"block-grid-row\\\" data-name=\\\"\".concat(_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateId(), \"\\\"></div>\");\n    tmpl = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(tmpl);\n    tmpl.insertBefore(currRow);\n    prevRow = tmpl;\n  }\n\n  if (typeof prevRow.length != 'undefined') {\n    prevRow = prevRow[0];\n  }\n\n  if (prevRow != null) {\n    prevRow.append(figure);\n    var prevFigures = prevRow.querySelectorAll('.item-figure');\n    prevRow.attr('data-paragraph-count', prevFigures.length);\n    this.stream.notifySubscribers('Katana.Images.Restructure', {\n      container: prevRow,\n      count: prevFigures.length,\n      figures: prevFigures\n    });\n    var currFigures = currRow.querySelectorAll('.item-figure');\n\n    if (currFigures.length) {\n      currRow.attr('data-paragraph-count', currFigures.length);\n      this.stream.notifySubscribers('Katana.Images.Restructure', {\n        container: currRow,\n        count: currFigures.length,\n        figures: currFigures\n      });\n    } else {\n      currRow.remove();\n    }\n  } else {// break out of grid \n  }\n};\n/** commands **/\n\n\nImageToolbar.prototype.commandPositionSwitch = function (direction, figure) {\n  var sel = document.querySelector('.item-figure.item-selected'),\n      toSwitchWith;\n\n  if (typeof figure != 'undefined') {\n    sel = figure;\n  }\n\n  if (sel == null) {\n    return;\n  }\n\n  if (sel.hasClass('figure-in-row')) {\n    if (direction == 'left') {\n      toSwitchWith = sel.prev('.figure-in-row');\n\n      if (toSwitchWith != null) {\n        sel.insertAdjacentElement('afterend', toSwitchWith);\n      }\n    } else if (direction == 'right') {\n      toSwitchWith = sel.next('.figure-in-row');\n\n      if (toSwitchWith != null) {\n        toSwitchWith.insertAdjacentElement('afterend', sel);\n      }\n    } else if (direction == 'down') {\n      this._commandGoDownInGrid(sel);\n    } else if (direction == 'stretch') {\n      this._commandStretchImageInGrid(sel);\n    } else if (direction == 'up') {\n      this._commandGoUpInGrid(sel);\n    }\n  } else if (sel.hasClass('item-figure')) {\n    if (direction == 'up') {\n      this._commandMoveImageUp(sel);\n    } else if (direction == 'down') {\n      this._commandMoveImageDown(sel);\n    }\n  }\n\n  sel.addClass('figure-focused');\n  sel.focus();\n  this.displayHighlights();\n};\n\nImageToolbar.prototype.commandSideLeft = function () {\n  this.pullBackgroundContainer();\n  this.pullFullWidthContainer();\n  var sel = document.querySelector('.item-figure.item-selected');\n\n  if (sel == null) {\n    return;\n  }\n\n  this.removeFigureClasses(sel);\n  sel.addClass('figure-to-left'); // merge the sections\n\n  this.current_editor.mergeInnerSections(sel.closest('section')); //activate the node\n\n  sel = document.querySelector('.item-figure.item-selected');\n\n  if (sel == null) {\n    return;\n  }\n\n  this.current_editor.selectFigure(sel);\n};\n\nImageToolbar.prototype.commandDefaultSize = function () {\n  this.pullBackgroundContainer();\n  this.pullFullWidthContainer();\n  var sel = document.querySelector('.item-figure.item-selected');\n\n  if (sel == null) {\n    return;\n  }\n\n  this.removeFigureClasses(sel); // merge the sections\n\n  this.current_editor.mergeInnerSections(sel.closest('section'));\n  sel = document.querySelector('.item-figure.item-selected');\n\n  if (sel == null) {\n    return;\n  }\n\n  this.current_editor.selectFigure(sel);\n};\n\nImageToolbar.prototype.commandFullWidth = function () {\n  this.pullBackgroundContainer();\n  this.pushFullWidthContainer();\n  var sel = document.querySelector('.item-figure.item-selected');\n\n  if (sel == null) {\n    return;\n  }\n\n  this.removeFigureClasses(sel);\n  sel.addClass('figure-full-width');\n  var padC = sel.querySelector('.padding-cont');\n\n  if (padC != null) {\n    var style = padC.attr('style');\n    padC.attr('data-style', style);\n    padC.removeAttribute('style');\n  } // merge the sections\n\n\n  this.current_editor.mergeInnerSections(sel.closest('section'));\n  sel = document.querySelector('.item-figure.item-selected');\n\n  if (sel == null) {\n    return;\n  }\n\n  this.current_editor.selectFigure(sel);\n};\n\nImageToolbar.prototype.commandBackground = function () {\n  var section = this.pushBackgroundContainer();\n  var sel = document.querySelector('.item-figure.item-selected');\n\n  if (sel == null) {\n    return;\n  }\n\n  this.removeFigureClasses(sel);\n  this.current_editor.selectFigure(section);\n};\n\nImageToolbar.prototype._commandMoveImageUp = function (figure) {\n  this.current_editor.moveFigureUp(figure);\n};\n\nImageToolbar.prototype._commandMoveImageDown = function (figure) {\n  this.current_editor.moveFigureDown(figure);\n};\n/** commands ends **/\n\n\nImageToolbar.prototype.displayHighlights = function () {\n  var sel = document.querySelector('.item-figure.figure-focused'),\n      tag = '';\n  this.refresh();\n  var ac = this.elNode.querySelector('.active');\n\n  if (ac != null) {\n    ac.removeClass('active');\n  }\n\n  this.menuGridMode = false;\n\n  if (sel == null) {\n    sel = document.querySelector('.block-content.figure-focused');\n  }\n\n  if (sel == null) {\n    return;\n  }\n\n  if (sel.hasClass('figure-in-row')) {\n    this.menuGridMode = true;\n    sel.removeClass('can-go-right can-show-add');\n    var bgE = this.elNode.querySelector('[data-action=\"background\"]');\n\n    if (bgE != null) {\n      bgE.closest('li').addClass('hide');\n    }\n\n    var grid = sel.closest('.block-grid');\n\n    if (grid.hasClass('block-grid-full')) {\n      tag = 'fullwidth';\n    } else {\n      tag = 'defaultsize';\n    }\n\n    this.hideAction('sideleft');\n    var nxt = sel.next('.figure-in-row');\n\n    if (nxt != null) {\n      sel.addClass('can-go-right');\n    }\n\n    if (nxt == null) {\n      sel.addClass('can-show-add');\n    }\n\n    sel.addClass('can-go-down');\n  } else {\n    this.hideAction('goleft', 'goright');\n  }\n\n  if (!this.menuGridMode) {\n    if (!sel.hasClass('figure-in-row')) {\n      if (sel.hasClass('figure-to-left')) {\n        tag = 'sideleft';\n      } else if (sel.hasClass('figure-full-width')) {\n        tag = 'fullwidth';\n      } else if (sel.hasClass('block-content')) {\n        tag = 'background';\n      } else {\n        tag = 'defaultsize';\n      }\n    } // no position change for iframe embeds\n\n\n    if (sel.hasClass('item-iframe')) {\n      this.hideAction('goleft', 'goright');\n\n      if (!sel.hasClass('can-go-background')) {\n        this.hideAction('background');\n      }\n    }\n\n    if (sel.closest('.with-background') != null && !sel.hasClass('with-background')) {\n      this.hideAction('fullwidth', 'background');\n    } // no fullsize form small photos \n\n\n    if (sel.hasClass('n-fullSize')) {\n      this.hideAction('fullwidth', 'background');\n    }\n\n    var simg = sel.querySelector('img');\n\n    if (simg != null) {\n      var sprnt = simg.parentElement;\n\n      if (sprnt != null && sprnt.hasClass('markup-anchor')) {\n        this.highlight('createlink');\n      }\n    }\n  }\n\n  if (sel.hasClass('item-iframe')) {\n    this.hideAction('createlink');\n  } else {\n    this.showAction('createlink');\n  }\n\n  var gfocused = document.querySelectorAll('.grid-focused');\n  var gfigureFoucsed = document.querySelectorAll('.figure-focused');\n\n  if (gfocused.length && gfigureFoucsed.length == 0) {\n    this.hideAction('goleft', 'sideleft', 'goright', 'background');\n  }\n\n  if (tag != '') {\n    this.highlight(tag);\n  }\n};\n\nImageToolbar.prototype.hideAction = function () {\n  for (var _len = arguments.length, names = new Array(_len), _key = 0; _key < _len; _key++) {\n    names[_key] = arguments[_key];\n  }\n\n  for (var _i = 0, _names = names; _i < _names.length; _i++) {\n    var name = _names[_i];\n    var go = this.elNode.querySelector('[data-action=\"' + name + '\"]');\n\n    if (go != null) {\n      var pl = go.closest('li');\n\n      if (pl != null) {\n        pl.hide();\n      }\n    }\n  }\n};\n\nImageToolbar.prototype.showAction = function () {\n  for (var _len2 = arguments.length, names = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n    names[_key2] = arguments[_key2];\n  }\n\n  for (var _i2 = 0, _names2 = names; _i2 < _names2.length; _i2++) {\n    var name = _names2[_i2];\n    var go = this.elNode.querySelector('[data-action=\"' + name + '\"]');\n\n    if (go != null) {\n      var pl = go.closest('li');\n\n      if (pl != null) {\n        pl.show();\n      }\n    }\n  }\n};\n\nImageToolbar.prototype.highlight = function (tag) {\n  var tg = this.elNode.querySelector('[data-action=\"' + tag + '\"]');\n\n  if (tg != null) {\n    var tgp = tg.closest(\"li\");\n\n    if (tgp != null) {\n      tgp.addClass('active');\n    }\n  }\n};\n/** layout related modifications **/\n\n\nImageToolbar.prototype.removeFigure = function (figure) {\n  var container = figure.closest('.block-grid-row');\n\n  if (container != null) {\n    figure.remove();\n    var remaining = container.querySelectorAll('.item-figure');\n\n    if (remaining.length) {\n      container.attr('data-paragraph-count', remaining.length);\n      this.stream.notifySubscribers('Katana.Images.Restructure', {\n        container: container,\n        count: remaining.length,\n        figures: remaining\n      });\n    }\n\n    var grid = container.closest('.block-grid');\n\n    if (remaining.length == 0) {\n      // row is empty now, remove it\n      container.remove();\n    } // check if we grid has any image left inside\n\n\n    var gridImages = grid.querySelectorAll('.item-image');\n\n    if (gridImages.length) {\n      var len = gridImages.length;\n\n      if (len > 1) {\n        // more than one image remaining, just update para count for the grid\n        grid.attr('data-paragraph-count', len);\n      } else {\n        // one image remains, unwrap this baby\n        this.unwrapSingleFigure(grid);\n      }\n    } else {\n      // don't have any image left in grid remove it.. // should never happen, we should just unwrap at last figure remaining in grid\n      grid.remove();\n    }\n  } else {\n    var itemSelected = this.current_editor.replaceWith(\"p\", figure);\n    var nextItem = itemSelected.next('.item');\n\n    if (nextItem != null) {\n      itemSelected.parentNode.removeChild(itemSelected);\n      nextItem.addClass('item-selected');\n      this.current_editor.setRangeAt(nextItem);\n    } else {\n      this.current_editor.setRangeAt(document.querySelector(\".item-selected\"));\n    }\n  }\n\n  this.hide();\n};\n\nImageToolbar.prototype.unwrapSingleFigure = function (container) {\n  var figures = container.querySelectorAll('.item-figure'),\n      moveIn,\n      firstGraf;\n\n  if (figures.length == 1) {\n    // try to move content in the upper section if we have one..\n    moveIn = container.prev('.block-content-inner');\n\n    if (moveIn != null) {\n      var itemFigures = container.querySelectorAll('.item-figure');\n      itemFigures.forEach(function (ll) {\n        moveIn.appendChild(ll);\n      });\n      container.remove();\n      figures.removeClass('figure-in-row can-go-right can-go-down');\n      figures.removeAttribute('style');\n    } else {\n      moveIn = container.next('.block-content-inner');\n\n      if (moveIn != null) {\n        var allFirst = moveIn.children;\n        var vAlLFirst = Array.prototype.filter.call(allFirst, function (el) {\n          return el.classList.contains('item');\n        });\n        firstGraf = vAlLFirst.length > 0 ? vAlLFirst[0] : null;\n\n        if (firstGraf != null) {\n          var itf = container.querySelector('.item-figure');\n\n          if (itf != null) {\n            itf.insertBefore(firstGraf);\n          }\n        } else {\n          container.querySelectorAll('.item-figure').forEach(function (el) {\n            moveIn.appendChild(el);\n          });\n        }\n\n        container.remove();\n        figures.removeClass('figure-in-row can-go-right can-go-down');\n        figures.removeAttribute('style');\n      } else {\n        container.removeClass('block-grid figure-focused can-go-right can-go-down').addClass('center-column').removeAttribute('data-paragraph-count');\n        figures.removeClass('figure-in-row');\n        figures.removeAttribute('style');\n        figures.unwrap();\n      }\n    }\n\n    var ig = figures.querySelectorAll('.item-image');\n\n    if (ig.length) {\n      ig = ig[0];\n\n      this._setAspectRatio(figures, ig.naturalWidth, ig.naturalHeight);\n    }\n  }\n\n  this.current_editor.cleanUpInnerSections();\n};\n\nImageToolbar.prototype._setAspectRatio = function (figure, w, h) {\n  var fill_ratio, height, maxHeight, maxWidth, ratio, result, width;\n  maxWidth = 760;\n  maxHeight = 700;\n  ratio = 0;\n  width = w;\n  height = h;\n\n  if (figure.hasClass('figure-in-row')) {\n    var brg = figure.closest('.block-grid-row');\n\n    if (brg != null) {\n      maxWidth = brg.getBoundingClientRect().width;\n    }\n  }\n\n  if (width > maxWidth) {\n    ratio = maxWidth / width;\n    height = height * ratio;\n    width = width * ratio;\n  } else if (height > maxHeight) {\n    ratio = maxHeight / height;\n    width = width * ratio;\n    height = height * ratio;\n  }\n\n  fill_ratio = height / width * 100;\n  var figP = figure.querySelector(\".padding-cont\");\n\n  if (figP != null) {\n    figP.style.maxWidth = width;\n    figP.style.maxHeight = height;\n  }\n\n  var figPB = figure.querySelector(\".padding-box\");\n\n  if (figPB != null) {\n    figPB.style.paddingBottom = fill_ratio + \"%\";\n  }\n}; // background image related\n\n\nImageToolbar.prototype.pushBackgroundContainer = function () {\n  var figure = document.querySelector('.item-figure.item-selected'),\n      isIFrame = figure != null ? figure.hasClass('item-iframe') : false;\n\n  if (figure == null) {\n    return;\n  }\n\n  var img = figure.querySelector('img'),\n      tmpl = isIFrame ? _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.templateBackgroundSectionForVideo()) : _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.templateBackgroundSectionForImage()),\n      bgImg = tmpl.querySelector('.block-background-image').attr('style', 'background-image:url(' + img.attr('src') + ')'),\n      aspectLock = tmpl.querySelector('.block-background'),\n      bottomSection,\n      currentSection,\n      isFirst = false;\n  aspectLock.attr('data-height', img.attr('data-height'));\n  aspectLock.attr('data-width', img.attr('data-width'));\n  aspectLock.attr('data-image-id', img.attr('data-image-id'));\n  aspectLock.attr('data-aspect', figure.querySelector('.padding-box').attr('style'));\n\n  if (figure.hasClass('figure-full-width')) {\n    aspectLock.attr('data-style', figure.querySelector('.padding-cont').attr('data-style'));\n  } else {\n    aspectLock.attr('data-style', figure.querySelector('.padding-cont').attr('style'));\n  }\n\n  if (!figure.hasClass('item-text-default')) {\n    var caption = tmpl.querySelector('.item-sectionCaption');\n    caption.innerHTML = figure.querySelector('.figure-caption').innerHTML;\n    caption.removeClass('item-text-default');\n  }\n\n  if (figure.hasClass('item-iframe')) {\n    bgImg.attr('data-frame-url', img.attr('data-frame-url'));\n    bgImg.attr('data-frame-aspect', img.attr('data-frame-aspect'));\n  }\n\n  this.current_editor.splitContainer(figure, tmpl, false);\n  figure.parentNode.removeChild(figure); // if we are the only section left after mergin we create one at the bottom of the image container\n\n  if (tmpl.hasClass('block-first block-last')) {\n    var sectionTmpl = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.getSingleSectionTemplate());\n    sectionTmpl.querySelector('.main-body').appendChild(_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.getSingleLayoutTempalte()));\n    sectionTmpl.querySelector('.main-body .center-column').appendChild(_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.baseParagraphTmpl()));\n    sectionTmpl.insertAfter(tmpl);\n    this.current_editor.fixSectionClasses();\n  }\n\n  tmpl.addClass('figure-focused');\n\n  if (!isIFrame) {\n    tmpl.addClass('talk-to-canvas');\n  }\n\n  this.current_editor.parallaxCandidateChanged();\n  return tmpl;\n};\n\nImageToolbar.prototype.pullBackgroundContainer = function () {\n  var section = document.querySelector('.figure-focused'),\n      isIFrame = section != null ? section.hasClass('section--video') : false,\n      figure,\n      currentContent,\n      backgrounded,\n      backgroundedImage,\n      path,\n      appendInSection,\n      onlyOneSection = false,\n      caption,\n      ig;\n\n  if (section == null || !section.hasClass('block-content')) {\n    return;\n  }\n\n  figure = isIFrame ? _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.getFrameTemplate()) : _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.getFigureTemplate());\n  backgrounded = section.querySelector('.block-background');\n  backgroundedImage = section.querySelector('.block-background-image');\n  path = backgroundedImage != null ? _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getStyle(backgroundedImage, 'backgroundImage') : null;\n  captionCurrent = section.querySelector('.item-sectionCaption');\n  currentContent = section.querySelector('.main-body').querySelector('.block-content-inner');\n  var figureName = figure.attr('name');\n  path = path.replace('url(', '').replace(')', '');\n  path = path.replace('\"', '').replace('\"', '');\n  ig = figure.querySelector('img');\n  ig.attr('src', path);\n  ig.attr('data-width', backgrounded.attr('data-width'));\n  ig.attr('data-height', backgrounded.attr('data-height'));\n  ig.attr('data-image-id', backgrounded.attr('data-image-id'));\n\n  if (isIFrame) {\n    ig.attr('data-frame-url', backgroundedImage.attr('data-frame-url'));\n    ig.attr('data-frame-aspect', backgroundedImage.attr('data-frame-aspect'));\n    figure.addClass('can-go-background');\n  }\n\n  figure.querySelector('.padding-box').attr('style', backgrounded.attr('data-aspect'));\n  figure.querySelector('.padding-cont').attr('style', backgrounded.attr('data-style')); //remove the continue writing \n\n  var pt = section.querySelector('.placeholder-text');\n\n  if (pt != null) {\n    var pti = pt.closest('.item');\n\n    if (pti != null) {\n      pti.remove();\n    }\n  }\n\n  caption = figure.querySelector('.figure-caption');\n\n  if (captionCurrent != null && !captionCurrent.hasClass('item-text-default')) {\n    caption.innerHTML = captionCurrent.innerHTML;\n    figure.removeClass('item-text-default');\n  }\n\n  figure.wrap(this.current_editor.getSingleLayoutTempalte());\n  figure = figure.closest('.center-column');\n\n  if (section.nextElementSibling != null) {\n    var sect = section.nextElementSibling,\n        inner = sect.querySelector('.main-body');\n\n    if (inner != null) {\n      inner.insertBefore(currentContent, inner.firstChild); //Utils.prependNode(currentContent, inner);\n\n      inner.insertBefore(figure, inner.firstChild); //          Utils.prependNode(figure, inner);\n\n      this.current_editor.mergeInnerSections(sect);\n    }\n\n    section.parentNode.removeChild(section);\n  } else if (section.previousElementSibling != null) {\n    var sect = section.previousElementSibling,\n        inner = sect.querySelector('.main-body');\n\n    if (inner != null) {\n      inner.appendChild(figure);\n      inner.appendChild(currentContent);\n      this.current_editor.mergeInnerSections(sect);\n    }\n\n    section.parentNode.removeChild(section);\n  } else {\n    onlyOneSection = true;\n    var newSection = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].generateElement(this.current_editor.getSingleSectionTemplate()),\n        innerSection = newSection.querySelector('.main-body');\n    innerSection.appendChild(figure);\n    innerSection.appendChild(currentContent);\n    innerSection.insertAfter(section);\n    section.parentNode.removeChild(section);\n  }\n\n  this.current_editor.removeUnnecessarySections();\n  this.current_editor.fixSectionClasses();\n  figure = figure.querySelector('[name=\"' + figureName + '\"]');\n\n  if (figure != null) {\n    this.current_editor.markAsSelected(figure);\n    figure.addClass('figure-focused').removeClass('uploading');\n    var fpct = figure.querySelector('.padding-cont');\n\n    if (fpct != null) {\n      fpct.addClass('selected');\n    }\n  }\n\n  this.current_editor.setupFirstAndLast();\n  this.current_editor.parallaxCandidateChanged();\n}; // backgronnd image related ends \n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (ImageToolbar);\n\n//# sourceURL=webpack:///./src/js/toolbars/image.js?");

/***/ }),

/***/ "./src/js/toolbars/index.js":
/*!**********************************!*\
  !*** ./src/js/toolbars/index.js ***!
  \**********************************/
/*! exports provided: TextToolbar, ImageToolbar */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _text__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./text */ \"./src/js/toolbars/text.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"TextToolbar\", function() { return _text__WEBPACK_IMPORTED_MODULE_0__[\"default\"]; });\n\n/* harmony import */ var _image__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./image */ \"./src/js/toolbars/image.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"ImageToolbar\", function() { return _image__WEBPACK_IMPORTED_MODULE_1__[\"default\"]; });\n\n\n\n\n//# sourceURL=webpack:///./src/js/toolbars/index.js?");

/***/ }),

/***/ "./src/js/toolbars/text.js":
/*!*********************************!*\
  !*** ./src/js/toolbars/text.js ***!
  \*********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _boot__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../boot */ \"./src/js/boot.js\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils */ \"./src/js/utils.js\");\n\n\nvar NUMBER_HONE = 49,\n    //header 1\nNUMBER_HTWO = 50,\n    //header 2\nNUMBER_HTHREE = 51,\n    // header 3\nNUMBER_QUOTE = 52,\n    // quote\nNUMBER_CODE_BLOCK = 53,\n    // code block\nCHAR_CENTER = 69,\n    // E with Ctrl, align center\nCHAR_LINK = 75; // k for link link \n\nfunction TextToolbar(opts) {\n  this.opts = opts;\n  this.handleClick = this.handleClick.bind(this);\n  this.createlink = this.createlink.bind(this);\n  this.handleKeyDown = this.handleKeyDown.bind(this);\n  this.handleInputEnter = this.handleInputEnter.bind(this);\n  this.shortCutKey = this.shortCutKey.bind(this);\n  this.closeInput = this.closeInput.bind(this);\n  this.hide = this.hide.bind(this);\n  this.initialize = this.initialize.bind(this);\n  _boot__WEBPACK_IMPORTED_MODULE_0__[\"default\"].it(this, opts);\n}\n\nTextToolbar.prototype.hide = function () {\n  this.elNode.removeClass(\"mf-menu--linkmode\");\n  this.elNode.addClass('hide');\n};\n\nTextToolbar.prototype.events = {\n  \"mousedown li\": \"handleClick\",\n  \"click .mf-menu-linkinput .mf-menu-button\": \"closeInput\",\n  \"keypress input\": \"handleInputEnter\",\n  \"keydown input\": \"handleKeyDown\"\n};\n\nTextToolbar.prototype.initialize = function () {\n  var opts = this.opts;\n  this.current_editor = opts.editor;\n  this.mode = opts.mode;\n  this.config = opts.textToolbarConfig || this.defaultConfig();\n  this.commandsReg = {\n    block: /^(?:p|h[1-6]|blockquote|pre)$/,\n    inline: /^(?:bold|italic|underline|insertorderedlist|insertunorderedlist|indent|outdent)$/,\n    source: /^(?:insertimage|createlink|unlink)$/,\n    insert: /^(?:inserthorizontalrule|insert)$/,\n    wrap: /^(?:code)$/\n  };\n  this.lineBreakReg = /^(?:blockquote|pre|div|p)$/i;\n  this.effectNodeReg = /(?:[pubia]|h[1-6]|blockquote|[uo]l|li|strong|em)/i;\n  return this.strReg = {\n    whiteSpace: /(^\\s+)|(\\s+$)/g,\n    mailTo: /^(?!mailto:|.+\\/|.+#|.+\\?)(.*@.*\\..+)$/,\n    http: /^(?!\\w+?:\\/\\/|mailto:|\\/|\\.\\/|\\?|#)(.*)$/\n  };\n};\n\nTextToolbar.prototype.defaultConfig = function () {\n  if (this.mode == 'write') {\n    var o = {\n      buttons: [{\n        a: 'bold',\n        i: 'bold'\n      }, {\n        a: 'italic',\n        i: 'italic'\n      }, {\n        a: 'h2',\n        i: 'H2',\n        k: NUMBER_HONE\n      }, {\n        a: 'h3',\n        i: 'H3',\n        k: NUMBER_HTWO\n      }, {\n        a: 'h4',\n        i: 'H4',\n        k: NUMBER_HTHREE\n      }, {\n        a: 'center',\n        i: 'text-center',\n        k: CHAR_CENTER\n      }, {\n        a: 'blockquote',\n        i: 'quote',\n        k: NUMBER_QUOTE\n      }, {\n        a: 'cite',\n        i: 'cite'\n      }, {\n        a: 'createlink',\n        i: 'link',\n        k: CHAR_LINK\n      }]\n    };\n\n    if (this.current_editor.publicationMode) {\n      o.buttons.push({\n        a: 'buttonprimary',\n        i: 'button'\n      });\n      o.buttons.push({\n        a: 'buttontrans',\n        i: 'button-trans'\n      });\n    }\n\n    return o;\n  } else if (this.mode == 'edit') {\n    return {\n      buttons: [{\n        a: 'highlight',\n        i: 'highlight'\n      }, {\n        a: 'color',\n        i: 'color'\n      }]\n    };\n  } else {\n    return {\n      buttons: [\n      /*{a:'comment',i: 'comment'}, */\n      {\n        a: 'share',\n        i: 'twitter'\n      }]\n    };\n  }\n};\n\nTextToolbar.prototype.template = function () {\n  if (this.cachedTemplate == null) {\n    var html = \"<div class=\\\"mf-menu-linkinput\\\">\\n        <input class=\\\"mf-menu-input\\\" placeholder=\\\"https://\\\">\\n        <div class=\\\"mf-menu-button mf-link-close\\\">&#215;</div></div>\\n        <ul class='mf-menu-buttons'>\";\n    this.config.buttons.forEach(function (item) {\n      return html += \"<li class='mf-menu-button'><i class=\\\"mf-icon mfi-\".concat(item.i, \"\\\"  data-action=\\\"\").concat(item.a, \"\\\"></i></li>\");\n    });\n    html += \"</ul>\";\n    this.cachedTemplate = html;\n  }\n\n  return this.cachedTemplate;\n};\n\nTextToolbar.prototype.built = false;\n\nTextToolbar.prototype.render = function () {\n  if (!this.built) {\n    this.cachedTemplate = null;\n    var html = this.template();\n    this.elNode.innerHTML = html;\n    this.built = true;\n  }\n\n  return this.show();\n};\n\nTextToolbar.prototype.refresh = function () {\n  this.elNode.querySelectorAll('.mf-menu-button').forEach(function (el) {\n    el.removeClass('hide');\n  });\n};\n\nTextToolbar.prototype.show = function () {\n  this.current_editor.toolbar._show();\n};\n\nTextToolbar.prototype._show = function () {\n  this.elNode.addClass(\"mf-menu--active\");\n  this.elNode.removeClass('hide');\n  return this.displayHighlights();\n}; // click events\n\n\nTextToolbar.prototype.handleClick = function (ev, matched) {\n  var action, element;\n\n  if (matched) {\n    element = matched.querySelector('.mf-icon');\n  } else {\n    element = ev.currentTarget.querySelector('.mf-icon');\n  }\n\n  if (element != null) {\n    action = element.attr(\"data-action\");\n    var s = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].saveSelection();\n\n    if (s != null) {\n      this.savedSel = s;\n    }\n\n    if (/(?:createlink)/.test(action)) {\n      this.actionIsLink(element);\n    } else {\n      this.menuApply(action);\n    }\n  }\n\n  return false;\n};\n\nTextToolbar.prototype.actionIsLink = function (target, event) {\n  if (target != null && target.hasClass(\"active\")) {\n    this.elNode.querySelector(\"input.mf-menu-input\").value = '';\n    this.removeLink();\n  } else {\n    this.elNode.addClass(\"mf-menu--linkmode\");\n    var sel = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].saveSelection();\n    this.savedSel = sel;\n    this.elNode.querySelector(\"input.mf-menu-input\").focus();\n\n    if (typeof event != 'undefined') {\n      event.preventDefault();\n    }\n  }\n};\n\nTextToolbar.prototype.shortCutKey = function (key, event) {\n  var _this = this;\n\n  var shouldOpenLink = function shouldOpenLink() {\n    var text = _this.current_editor.getSelectedText();\n\n    return text.length ? true : false;\n  };\n\n  if (this.mode == 'write') {\n    var config = this.defaultConfig();\n    var action = '';\n    var node = this.current_editor.elNode.querySelector('.item-selected');\n\n    if (node && !node.hasClass('item-figure')) {\n      this.savedSel = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].saveSelection();\n\n      switch (key) {\n        case NUMBER_HONE:\n          action = 'h2';\n          break;\n\n        case NUMBER_HTWO:\n          action = 'h3';\n          break;\n\n        case NUMBER_HTHREE:\n          action = 'h4';\n          break;\n\n        case NUMBER_QUOTE:\n          action = 'blockquote';\n          break;\n\n        case NUMBER_CODE_BLOCK:\n          action = 'code';\n          break;\n\n        case CHAR_CENTER:\n          action = 'center';\n          event.preventDefault();\n          break;\n\n        case CHAR_LINK:\n          action = '';\n\n          if (shouldOpenLink()) {\n            this.actionIsLink(this.elNode.querySelector('[data-action=\"createlink\"]').closest('li'), event);\n          }\n\n          break;\n      }\n\n      ;\n\n      if (action != '') {\n        this.menuApply(action);\n        return false;\n      }\n\n      if (key == CHAR_LINK) {\n        return false;\n      }\n    }\n  }\n};\n\nTextToolbar.prototype.closeInput = function (e) {\n  this.elNode.removeClass(\"mf-menu--linkmode\");\n  return false;\n};\n\nTextToolbar.prototype.handleKeyDown = function (e) {\n  var which = e.which,\n      bd,\n      overLay;\n\n  if (which == 27) {\n    this.hide();\n    _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].restoreSelection(this.savedSel);\n  }\n};\n\nTextToolbar.prototype.handleInputEnter = function (e, matched) {\n  if (e.which === 13) {\n    _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].restoreSelection(this.savedSel);\n\n    if (matched) {\n      return this.createlink(matched);\n    } else {\n      return this.createlink(e.target);\n    }\n  }\n};\n\nTextToolbar.prototype.removeLink = function () {\n  var elem;\n  this.menuApply(\"unlink\");\n  elem = this.current_editor.getNode();\n  return this.current_editor.cleanContents(elem);\n};\n\nTextToolbar.prototype.createlink = function (input) {\n  var action, inputValue;\n  this.elNode.removeClass(\"mf-menu--linkmode\");\n\n  if (input.value) {\n    inputValue = input.value.replace(this.strReg.whiteSpace, \"\").replace(this.strReg.mailTo, \"mailto:$1\").replace(this.strReg.http, \"http://$1\");\n    return this.menuApply(\"createlink\", inputValue);\n  }\n\n  action = \"unlink\";\n  return this.menuApply(action);\n};\n\nTextToolbar.prototype.menuApply = function (action, value) {\n  if (this.commandsReg.block.test(action)) {\n    this.commandBlock(action);\n  } else if (this.commandsReg.inline.test(action) || this.commandsReg.source.test(action)) {\n    this.commandOverall(action, value);\n  } else if (this.commandsReg.insert.test(action)) {\n    this.commandInsert(action);\n  } else if (this.commandsReg.wrap.test(action)) {\n    this.commandWrap(action);\n  } else if (action == 'center') {\n    this.commandCenter(action);\n  } else if (action == 'buttontrans' || action == 'buttonprimary') {\n    this.commandButton(action);\n  } else if (action == 'comment' || action == 'share') {\n    this.readModeItemClick(action);\n  } else if (action == 'cite') {\n    this.commandCite();\n  }\n\n  return false;\n};\n\nTextToolbar.prototype.commandCite = function () {\n  var nd = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getNode();\n\n  if (nd.tagName == 'CITE') {\n    var quote = nd.closest('blockquote');\n    quote.removeClass('with-cite');\n    nd.children.unwrap();\n  } else {\n    if (nd.hasClass('with-cite')) {\n      nd.removeClass('with-cite');\n    } else {\n      var sel = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selection();\n\n      if (sel.rangeCount) {\n        var range = sel.getRangeAt(0).cloneRange();\n        var ele = document.createElement('cite');\n        range.surroundContents(ele);\n        sel.removeAllRanges();\n        sel.addRange(range);\n      }\n\n      nd.addClass('with-cite');\n    }\n  }\n};\n\nTextToolbar.prototype.commandButton = function (action) {\n  var nd = _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getNode();\n\n  if (nd.length && nd.tagName.toLowerCase() == 'a') {\n    if (action == 'buttonprimary') {\n      if (nd.hasClass('trans')) {\n        nd.removeClass('trans');\n      } else if (nd.hasClass('btn')) {\n        nd.removeClass('btn');\n      } else {\n        nd.addClass('btn');\n      }\n    } else if (action == 'buttontrans') {\n      if (nd.hasClass('trans')) {\n        nd.removeClass('btn trans');\n      } else {\n        nd.addClass('btn trans');\n      }\n    }\n\n    this.displayHighlights();\n  }\n};\n\nTextToolbar.prototype.readModeItemClick = function (action) {\n  var sel = document.querySelector('.item-selected');\n\n  if (action == 'comment') {\n    var evnt = new CustomEvent('Katana.Event.Nodes', {\n      type: 'Katana.Event.Notes',\n      selectedText: this.current_editor.getSelectedText(),\n      node: sel\n    });\n    this.current_editor.elNode.dispatchEvent(evnt);\n  } else if (action == 'share') {\n    var _evnt = new CustomEvent('Katana.Event.Share', {\n      type: 'Katana.Event.Share',\n      selectedText: this.current_editor.getSelectedText(),\n      node: sel\n    });\n\n    this.current_editor.elNode.dispatchEvent(_evnt);\n  }\n};\n\nTextToolbar.prototype.refreshMenuState = function () {\n  this.built = false;\n  this.render();\n};\n\nTextToolbar.prototype.commandCenter = function (cmd, val) {\n  var node;\n  node = this.current_editor.current_node;\n\n  if (!node) {\n    return;\n  }\n\n  node.classList.toggle('text-center');\n  this.displayHighlights();\n  this.current_editor.handleTextSelection(node);\n};\n\nTextToolbar.prototype.commandOverall = function (cmd, val) {\n  console.log(\"Command is \".concat(cmd));\n  var n, origNode, extrakls;\n  origNode = this.current_editor.current_node, extrakls = false;\n\n  if (origNode.hasClass('text-center')) {\n    extrakls = 'text-center';\n  }\n\n  if (val == 'blockquote' && origNode.tagName == 'BLOCKQUOTE') {\n    extrakls = 'pullquote';\n  }\n\n  if (!val) {\n    val = null;\n  }\n\n  if (document.execCommand(cmd, false, val)) {\n    n = this.current_editor.getNode();\n    this.current_editor.setupLinks(n.querySelectorAll(\"a\"));\n\n    if (cmd == \"createlink\" || cmd == \"bold\" || cmd == \"italic\") {\n      var nn = this.current_editor.getTextNodeParent();\n\n      if (nn != null) {\n        this.current_editor.addClassesToElement(nn);\n        this.current_editor.setElementName(nn);\n      }\n    }\n\n    this.displayHighlights();\n\n    if (n.parentNode && n.parentNode.hasClass(\"block-content-inner\")) {\n      if (extrakls) {\n        n = this.current_editor.addClassesToElement(n, extrakls);\n      } else {\n        n = this.current_editor.addClassesToElement(n);\n      }\n\n      this.current_editor.setElementName(n);\n    }\n\n    this.current_editor.handleTextSelection(n);\n  }\n};\n\nTextToolbar.prototype.commandInsert = function (name) {\n  var node;\n  node = this.current_editor.current_node;\n\n  if (!node) {\n    return;\n  }\n\n  this.current_editor.current_range.selectNode(node);\n  this.current_editor.current_range.collapse(false);\n  return this.commandOverall(node, name);\n};\n\nTextToolbar.prototype.commandBlock = function (name) {\n  var list, node;\n  node = this.current_editor.current_node;\n  list = this.effectNode(this.current_editor.getNode(node), true);\n\n  if (node.tagName == 'BLOCKQUOTE' && !node.hasClass('pullquote')) {// leave it.. as it is \n  } else if (node.tagName == 'BLOCKQUOTE' && node.hasClass('pullquote')) {\n    name = \"p\";\n  } else if (list.indexOf(name) !== -1) {\n    name = \"p\";\n  }\n\n  return this.commandOverall(\"formatblock\", name);\n};\n\nTextToolbar.prototype.commandWrap = function (tag) {\n  var node, val;\n  node = this.current_editor.current_node;\n  val = \"<\" + tag + \">\" + _utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selection() + \"</\" + tag + \">\";\n  return this.commandOverall(\"insertHTML\", val);\n};\n\nTextToolbar.prototype.effectNode = function (el, returnAsNodeName) {\n  var nodes;\n  nodes = [];\n  el = el || this.current_editor.elNode;\n\n  while (!el.hasClass('block-content-inner')) {\n    if (el.nodeName.match(this.effectNodeReg)) {\n      nodes.push(returnAsNodeName ? el.nodeName.toLowerCase() : el);\n    }\n\n    el = el.parentNode;\n  }\n\n  return nodes;\n};\n\nTextToolbar.prototype.displayHighlights = function () {\n  var _this2 = this;\n\n  var nodes,\n      active = this.elNode.querySelector('.active');\n\n  if (active != null) {\n    active.removeClass(\"active\");\n  }\n\n  this.refresh();\n  nodes = this.effectNode(_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getNode());\n  this.elNode.querySelectorAll(\".mfi-button, .mfi-button-trans, .mfi-cite\").forEach(function (el) {\n    var li = el.closest('li');\n\n    if (li != null) {\n      li.addClass('hide');\n    }\n  });\n\n  var _this = this;\n\n  nodes.forEach(function (node) {\n    var tag = node.nodeName.toLowerCase(),\n        _thisEl = _this2.elNode;\n\n    switch (tag) {\n      case \"a\":\n        _thisEl.querySelector('input').value = node.attr(\"href\");\n        tag = \"link\";\n        break;\n\n      case \"i\":\n      case \"em\":\n        tag = \"italic\";\n        break;\n\n      case \"u\":\n        tag = \"underline\";\n        break;\n\n      case \"b\":\n      case \"strong\":\n        tag = \"bold\";\n        break;\n\n      case \"code\":\n        tag = \"code\";\n        break;\n\n      case \"ul\":\n        tag = \"insertunorderedlist\";\n        break;\n\n      case \"ol\":\n        tag = \"insertorderedlist\";\n        break;\n\n      case \"li\":\n        tag = \"indent\";\n        break;\n    }\n\n    if (tag.match(/(?:h[1-6])/i)) {\n      _thisEl.querySelectorAll(\".mfi-bold, .mfi-italic, .mfi-quote\").forEach(function (el) {\n        var li = el.closest('li');\n\n        if (li != null) {\n          li.addClass('hide');\n        }\n      });\n    } else if (tag === \"indent\") {\n      _thisEl.querySelectorAll(\".mfi-H2, .mfi-H3, .mfi-H4, .mfi-quote\").forEach(function (el) {\n        var li = el.closest('li');\n\n        if (li != null) {\n          li.addClass('hide');\n        }\n      });\n    } else if (tag == 'figcaption' || tag == 'label') {\n      _thisEl.querySelectorAll(\".mfi-H2, .mfi-H3, .mfi-H4, .mfi-quote, .mfi-text-center\").forEach(function (el) {\n        var li = el.closest('li');\n\n        if (li != null) {\n          li.addClass('hide');\n        }\n      });\n    } else if (tag == 'blockquote') {\n      _thisEl.querySelectorAll(\".mfi-H2, .mfi-H3, .mfi-H4\").forEach(function (el) {\n        var li = el.closest('li');\n\n        if (li != null) {\n          li.addClass('hide');\n        }\n      });\n    }\n\n    if (tag == 'link') {\n      _thisEl.querySelectorAll(\".mfi-button, .mfi-button-trans\").forEach(function (el) {\n        var li = el.closest('li');\n\n        if (li != null) {\n          li.removeClass('hide');\n        }\n      });\n\n      if (node.hasClass('btn') & !node.hasClass('trans')) {\n        _this.highlight('button');\n\n        _thisEl.querySelectorAll('.mfi-button-trans').forEach(function (el) {\n          var li = el.closest('li');\n\n          if (li != null) {\n            li.removeClass('active');\n          }\n        });\n      } else if (node.hasClass('trans')) {\n        _thisEl.querySelectorAll('.mfi-button').forEach(function (el) {\n          var li = el.closest('li');\n\n          if (li != null) {\n            li.removeClass('active');\n          }\n        });\n\n        _this.highlight('button-trans');\n      }\n    }\n\n    var prev = node.previousElementSibling,\n        hasH2 = prev != null ? prev.hasClass('item-h2') : false,\n        hasH3 = prev != null ? prev.hasClass('item-h3') : false,\n        hasH4 = prev != null ? prev.hasClass('item-h4') : false;\n\n    if (hasH2) {\n      _thisEl.querySelectorAll(\".mfi-H2, .mfi-quote\").forEach(function (el) {\n        var li = el.closest('li');\n\n        if (li != null) {\n          li.addClass('hide');\n        }\n      });\n\n      ;\n    } else if (hasH3) {\n      _thisEl.querySelectorAll(\".mfi-H3, .mfi-H2, .mfi-quote\").forEach(function (el) {\n        var li = el.closest('li');\n\n        if (li != null) {\n          li.addClass('hide');\n        }\n      });\n\n      ;\n    } else if (hasH4) {\n      _thisEl.querySelectorAll('.mfi-H2, .mfi-H3, .mfi-H4, .mfi-quote').forEach(function (el) {\n        var li = el.closest('li');\n\n        if (li != null) {\n          li.addClass('hide');\n        }\n      });\n\n      ;\n    }\n\n    if (node.hasClass('text-center')) {\n      _this.highlight('text-center');\n    }\n\n    if (node.hasClass('pullquote')) {\n      _this.highlight('quote', true);\n    }\n\n    if (node.hasClass('pullquote')) {\n      _this.highlight('quote', true);\n\n      _thisEl.querySelectorAll('.mfi-italic, .mfi-text-center').forEach(function (el) {\n        var li = el.closest('li');\n\n        if (li != null) {\n          li.addClass('hide');\n        }\n      });\n\n      if (_utils__WEBPACK_IMPORTED_MODULE_1__[\"default\"].editableCaretAtEnd(node)) {\n        _thisEl.querySelectorAll('.mfi-cite').forEach(function (el) {\n          var li = el.closest('li');\n\n          if (li != null) {\n            li.removeClass('hide');\n          }\n        });\n      }\n    }\n\n    if (tag == 'cite') {\n      _thisEl.querySelectorAll('.mfi-italic, .mfi-text-center, .mfi-bold').forEach(function (el) {\n        var li = el.closest('li');\n\n        if (li != null) {\n          li.addClass('hide');\n        }\n      });\n\n      _thisEl.querySelectorAll('.mfi-cite').forEach(function (el) {\n        var li = el.closest('li');\n\n        if (li != null) {\n          li.removeClass('hide');\n        }\n      });\n\n      tag = 'cite';\n    }\n\n    if (tag == 'blockquote') {\n      tag = 'quote';\n    }\n\n    return _this.highlight(tag);\n  });\n};\n\nTextToolbar.prototype.highlight = function (tag, _double) {\n  if (['h4', 'h3', 'h2', 'h1'].indexOf(tag) != -1) {\n    tag = tag.toUpperCase();\n  }\n\n  var ic = this.elNode.querySelector(\".mfi-\" + tag);\n\n  if (ic == null) {\n    return;\n  }\n\n  var icl = ic.closest(\"li\");\n\n  if (_double) {\n    if (icl != null) {\n      icl.addClass('doble');\n    }\n  }\n\n  if (icl != null) {\n    return icl.addClass(\"active\");\n  }\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (TextToolbar);\n\n//# sourceURL=webpack:///./src/js/toolbars/text.js?");

/***/ }),

/***/ "./src/js/tooltip.js":
/*!***************************!*\
  !*** ./src/js/tooltip.js ***!
  \***************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/js/utils.js\");\n/* harmony import */ var _boot__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./boot */ \"./src/js/boot.js\");\n\n\n\nfunction Tooltip(opts) {\n  this.opts = opts;\n  this.cancelHide = this.cancelHide.bind(this);\n  this.hide = this.hide.bind(this);\n  _boot__WEBPACK_IMPORTED_MODULE_1__[\"default\"].it(this, opts);\n}\n\nTooltip.prototype.events = {\n  \"mouseover .popover\": \"cancelHide\",\n  \"mouseout  .popover\": \"hide\"\n};\n\nTooltip.prototype.initialize = function () {\n  console.log('Tooltip : initialize');\n  this.editor = this.opts.editor;\n  this.hideTimeout;\n  return this.settings = {\n    timeout: 300\n  };\n};\n\nTooltip.prototype.template = function () {\n  return \"<div class='popover popover-tooltip popover-bottom active'> \\n      <div class='popover-inner'>\\n        <a href='#' target='_blank'> Link </a>\\n      </div> \\n      <div class='popover-arrow'> </div> </div>\";\n};\n\nTooltip.prototype.positionAt = function (ev, matched) {\n  var left_value, popover_width, target, target_height, target_offset, target_positions, target_width, top_value, target_is_figure;\n  target = matched ? matched : ev.currentTarget;\n  var o = this.resolveTargetPosition(target);\n  target_positions = o.position;\n  target = o.target;\n  target_is_figure = o.figure;\n  target_offset = target.getBoundingClientRect();\n  target_width = target_offset.width;\n  ;\n  target_height = target_offset.height;\n  var popover = this.elNode.querySelector('.popover');\n  popover.show();\n  popover_width = popover.getBoundingClientRect().width;\n  popover_width = popover_width / 2;\n\n  if (target_is_figure) {\n    popover.addClass('pop-for-figure');\n    top_value = target_offset.top + document.body.scrollTop;\n    left_value = target_offset.left + target_width / 2 - popover_width - 15;\n    popover.style.top = top_value + 'px';\n    popover.style.left = left_value + 'px';\n  } else {\n    popover.removeClass('pop-for-figure');\n    top_value = target_offset.top + target_height + document.body.scrollTop;\n    left_value = target_offset.left + target_width / 2 - popover_width;\n    popover.style.top = top_value + 'px';\n    popover.style.left = left_value + 'px';\n  }\n\n  return;\n};\n\nTooltip.prototype.displayAt = function (ev, matched) {\n  var target;\n  this.cancelHide();\n\n  if (matched) {\n    target = matched;\n  } else {\n    target = ev.currentTarget;\n  }\n\n  var el = this.elNode;\n  var an = el.querySelector(\".popover-inner a\");\n\n  if (an != null) {\n    an.innerHTML = target.attr('href');\n    an.attr('href', target.attr(\"href\"));\n  }\n\n  this.positionAt(ev, matched);\n  var elNT = el.querySelector(\".popover-tooltip\");\n\n  if (elNT != null) {\n    elNT.style.pointerEvents = 'auto';\n  }\n\n  return elNT.show();\n};\n\nTooltip.prototype.cancelHide = function () {\n  return clearTimeout(this.hideTimeout);\n};\n\nTooltip.prototype.hide = function (ev) {\n  this.cancelHide();\n  var el = this.elNode;\n  this.hideTimeout = setTimeout(function () {\n    var pp = el.querySelector('.popover');\n\n    if (pp != null) {\n      pp.hide();\n    }\n  }, this.settings.timeout);\n};\n\nTooltip.prototype.resolveTargetPosition = function (target) {\n  if (target.closest(\".item-figure\") != null) {\n    var tg = target.closest(\".item-figure\");\n    return {\n      position: {\n        top: tg.offsetTop,\n        left: tg.offsetLeft\n      },\n      target: tg,\n      figure: true\n    };\n  } else {\n    return {\n      position: {\n        top: target.offsetTop,\n        left: target.offsetLeft\n      },\n      target: target,\n      figure: false\n    };\n  }\n};\n\nTooltip.prototype.render = function () {\n  if (document.querySelector('.popover.popover-tooltip') == null) {\n    _utils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].generateElement(this.template()).insertAfter(this.editor.elNode);\n  }\n\n  return document.querySelector('.popover.popover-tooltip');\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Tooltip);\n\n//# sourceURL=webpack:///./src/js/tooltip.js?");

/***/ }),

/***/ "./src/js/utils.js":
/*!*************************!*\
  !*** ./src/js/utils.js ***!
  \*************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nvar LINE_HEIGHT = 20;\n\nvar is_caret_at_start_of_node = function is_caret_at_start_of_node(node, range) {\n  var pre_range;\n  pre_range = document.createRange();\n  pre_range.selectNodeContents(node);\n  pre_range.setEnd(range.startContainer, range.startOffset);\n  return pre_range.toString().trim().length === 0;\n};\n\nvar is_caret_at_end_of_node = function is_caret_at_end_of_node(node, range) {\n  var post_range;\n  post_range = document.createRange();\n  post_range.selectNodeContents(node);\n  post_range.setStart(range.endContainer, range.endOffset);\n  return post_range.toString().trim().length === 0;\n};\n\nvar editableIsCaret = function editableIsCaret() {\n  return window.getSelection().type === 'Caret';\n};\n\nvar editableRange = function editableRange() {\n  var sel;\n  sel = window.getSelection();\n\n  if (!(sel.rangeCount > 0)) {\n    return;\n  }\n\n  return sel.getRangeAt(0);\n};\n\nvar editableCaretRange = function editableCaretRange() {\n  if (!editableIsCaret()) {\n    return;\n  }\n\n  return editableRange();\n};\n\nvar editableSetRange = function editableSetRange(range) {\n  var sel;\n  sel = window.getSelection();\n\n  if (sel.rangeCount > 0) {\n    sel.removeAllRanges();\n  }\n\n  return sel.addRange(range);\n};\n\nvar Utils = {\n  scrollHandlers: {},\n  scrollAttached: false,\n  onIOS: function onIOS() {\n    var standalone = window.navigator.standalone,\n        userAgent = window.navigator.userAgent.toLowerCase(),\n        safari = /safari/.test(userAgent),\n        ios = /iphone|ipod|ipad/.test(userAgent);\n    return ios;\n  },\n  __result: function __result(object, prop, fallback) {\n    var value = object == null ? void 0 : object[prop];\n\n    if (value === void 0) {\n      value = fallback;\n    }\n\n    return value && Object.prototype.toString.call(value) == '[object Function]' ? value.call(object) : value;\n  },\n  __bind: function __bind(fn, me) {\n    return function () {\n      return fn.apply(me, arguments);\n    };\n  },\n  __hasProp: {}.hasOwnProperty,\n  __extends: function __extends(child, parent) {\n    for (var key in parent) {\n      if (__hasProp.call(parent, key)) {\n        child[key] = parent[key];\n      }\n    }\n\n    var ctor = function ctor() {\n      this.constructor = child;\n    };\n\n    ctor.prototype = parent.prototype;\n    child.prototype = new ctor();\n    child.__super__ = parent.prototype;\n  },\n  log: function log(message, force) {\n    if (window.debugMode || force) {\n      return console.log(message);\n    }\n  },\n  incrementCounter: function incrementCounter(index) {\n    if (typeof index == \"number\") {\n      index = index + 1;\n      return index;\n    } else if (typeof index == \"string\") {\n      return String.fromCharCode(index.charCodeAt(0) + 1);\n    }\n\n    return null;\n  },\n  stopEvent: function stopEvent(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n  },\n  simpleStop: function simpleStop(event) {\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n  },\n  getBase64Image: function getBase64Image(img) {\n    var canvas, ctx, dataURL;\n    canvas = document.createElement(\"canvas\");\n    canvas.width = img.width;\n    canvas.height = img.height;\n    ctx = canvas.getContext(\"2d\");\n    ctx.drawImage(img, 0, 0);\n    dataURL = canvas.toDataURL(\"image/png\");\n    return dataURL;\n  },\n  generateId: function generateId() {\n    return Math.random().toString(36).slice(8);\n  },\n  saveSelection: function saveSelection() {\n    var i, len, ranges, sel;\n\n    if (window.getSelection) {\n      sel = window.getSelection();\n\n      if (sel.getRangeAt && sel.rangeCount) {\n        ranges = [];\n        i = 0;\n        len = sel.rangeCount;\n\n        while (i < len) {\n          ranges.push(sel.getRangeAt(i));\n          ++i;\n        }\n\n        return ranges;\n      }\n    } else {\n      if (document.selection && document.selection.createRange) {\n        return document.selection.createRange();\n      }\n    }\n\n    return null;\n  },\n  restoreSelection: function restoreSelection(savedSel) {\n    var i, len, sel;\n\n    if (savedSel) {\n      if (window.getSelection) {\n        sel = window.getSelection();\n        sel.removeAllRanges();\n        i = 0;\n        len = savedSel.length;\n\n        while (i < len) {\n          sel.addRange(savedSel[i]);\n          ++i;\n        }\n      } else {\n        if (document.selection && savedSel.select) {\n          savedSel.select();\n        }\n      }\n    }\n  },\n  getNode: function getNode() {\n    var container, range, sel;\n    range = void 0;\n    sel = void 0;\n    container = void 0;\n\n    if (document.selection && document.selection.createRange) {\n      range = document.selection.createRange();\n      return range.parentElement();\n    } else if (window.getSelection) {\n      sel = window.getSelection();\n\n      if (sel.getRangeAt) {\n        if (sel.rangeCount > 0) {\n          range = sel.getRangeAt(0);\n        }\n      } else {\n        range = document.createRange();\n        range.setStart(sel.anchorNode, sel.anchorOffset);\n        range.setEnd(sel.focusNode, sel.focusOffset);\n\n        if (range.collapsed !== sel.isCollapsed) {\n          range.setStart(sel.focusNode, sel.focusOffset);\n          range.setEnd(sel.anchorNode, sel.anchorOffset);\n        }\n      }\n\n      if (range) {\n        container = range.commonAncestorContainer;\n\n        if (container.nodeType === 3) {\n          return container.parentNode;\n        } else {\n          return container;\n        }\n      }\n    }\n  },\n  getSelectionDimensions: function getSelectionDimensions() {\n    var height, left, range, rect, sel, top, width;\n    sel = document.selection;\n    range = void 0;\n    width = 0;\n    height = 0;\n    left = 0;\n    top = 0;\n\n    if (sel) {\n      if (sel.type !== \"Control\") {\n        range = sel.createRange();\n        width = range.boundingWidth;\n        height = range.boundingHeight;\n      }\n    } else if (window.getSelection) {\n      sel = window.getSelection();\n\n      if (sel.rangeCount) {\n        range = sel.getRangeAt(0).cloneRange();\n\n        if (range.getBoundingClientRect) {\n          rect = range.getBoundingClientRect();\n          width = rect.right - rect.left;\n          height = rect.bottom - rect.top;\n        }\n      }\n    }\n\n    return {\n      width: width,\n      height: height,\n      top: rect.top,\n      left: rect.left\n    };\n  },\n  getImageSelectionDimension: function getImageSelectionDimension() {\n    var figure, blockGrid;\n    blockGrid = document.querySelector('.grid-focused');\n\n    if (blockGrid != null) {\n      figure = blockGrid;\n    } else {\n      figure = document.querySelector('.figure-focused:not(.block-content-inner)');\n    }\n\n    if (figure == null) {\n      return null;\n    }\n\n    return figure.getBoundingClientRect();\n  },\n  getCaretPosition: function getCaretPosition(editableDiv) {\n    var caretPos, range, sel, tempEl, tempRange;\n    caretPos = 0;\n    containerEl = null;\n    sel = void 0;\n    range = void 0;\n\n    if (window.getSelection) {\n      sel = window.getSelection();\n\n      if (sel.rangeCount) {\n        range = sel.getRangeAt(0);\n\n        if (range.commonAncestorContainer.parentNode === editableDiv) {\n          caretPos = range.endOffset;\n        }\n      }\n    } else if (document.selection && document.selection.createRange) {\n      range = document.selection.createRange();\n\n      if (range.parentElement() === editableDiv) {\n        tempEl = document.createElement(\"span\");\n        editableDiv.insertBefore(tempEl, editableDiv.firstChild);\n        tempRange = range.duplicate();\n        tempRange.moveToElementText(tempEl);\n        tempRange.setEndPoint(\"EndToEnd\", range);\n        caretPos = tempRange.text.length;\n      }\n    }\n\n    return caretPos;\n  },\n  selection: function (_selection) {\n    function selection() {\n      return _selection.apply(this, arguments);\n    }\n\n    selection.toString = function () {\n      return _selection.toString();\n    };\n\n    return selection;\n  }(function () {\n    if (window.getSelection) {\n      return selection = window.getSelection();\n    } else if (document.selection && document.selection.type !== \"Control\") {\n      return selection = document.selection;\n    }\n  }),\n  elementsHaveSameClasses: function elementsHaveSameClasses(first, second) {\n    var arr1 = _toConsumableArray(first.classList),\n        arr2 = _toConsumableArray(second.classList);\n\n    if (arr1.length != arr2.length) {\n      return false;\n    }\n\n    arr1.sort();\n    arr2.sort();\n\n    for (var i = 0; i < arr1.length; i++) {\n      if (arr1[i] !== arr2[i]) {\n        return false;\n      }\n    }\n\n    return true;\n  },\n  urlIsFromDomain: function urlIsFromDomain(url, domain) {\n    var a = document.createElement('a');\n    a.href = url;\n\n    if (typeof a.hostname != 'undefined' && a.hostname.indexOf(domain) != -1) {\n      return true;\n    }\n\n    return false;\n  },\n  urlIsForImage: function urlIsForImage(url) {\n    var a = document.createElement('a');\n    a.href = url, path = a.pathname;\n\n    if (path.indexOf('.jpeg') != -1) {\n      return true;\n    }\n\n    if (path.indexOf('.jpg') != -1) {\n      return true;\n    }\n\n    if (path.indexOf('.png') != -1) {\n      return true;\n    }\n\n    if (path.indexOf('.gif') != -1) {\n      return true;\n    }\n\n    return false;\n  },\n  getWindowWidth: function getWindowWidth() {\n    return window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;\n  },\n  getWindowHeight: function getWindowHeight() {\n    return window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\n  },\n  generateElement: function generateElement(txt) {\n    var d = document.createElement('div');\n    d.innerHTML = txt;\n\n    if (d.children.length == 0) {\n      return null;\n    }\n\n    if (d.children.length == 1) {\n      return d.firstChild;\n    } else {\n      return d.children;\n    }\n  },\n  arrayToNodelist: function arrayToNodelist(arr) {\n    var fragment = document.createDocumentFragment();\n    arr.forEach(function (item) {\n      fragment.appendChild(item.cloneNode());\n    });\n    return fragment.childNodes;\n  },\n  insertAfter: function insertAfter(el, referenceNode) {\n    return referenceNode.parentNode.insertBefore(el, referenceNode.nextSibling);\n  },\n  prependNode: function prependNode(el, refNode) {\n    if (typeof el.length == 'undefined') {\n      el = [el];\n    }\n\n    el.forEach(function (e) {\n      if (refNode != null && refNode.parentNode != null) {\n        return refNode.parentNode.insertBefore(e, refNode.parentNode.firstElementChild);\n      }\n    });\n    return null;\n  },\n  scrollToTop: function scrollToTop(position) {\n    var pos = typeof position == 'undefined' ? 0 : position;\n    var scrollDuration = 1000;\n    var scrollStep = -window.scrollY / (scrollDuration / 15),\n        scrollInterval = setInterval(function () {\n      if (window.scrollY != 0) {\n        window.scrollBy(pos, scrollStep);\n      } else clearInterval(scrollInterval);\n    }, 15);\n  },\n  isEqual: function isEqual(obj1, obj2) {\n    for (var p in obj1) {\n      if (obj1.hasOwnProperty(p) !== obj2.hasOwnProperty(p)) return false;\n\n      switch (_typeof(obj1[p])) {\n        case 'object':\n          if (!Object.compare(obj1[p], obj2[p])) return false;\n          break;\n\n        case 'function':\n          if (typeof obj2[p] == 'undefined' || p != 'compare' && obj1[p].toString() != obj2[p].toString()) return false;\n          break;\n\n        default:\n          if (obj1[p] != obj2[p]) return false;\n      }\n    }\n\n    for (var p in obj2) {\n      if (typeof obj1[p] == 'undefined') return false;\n    }\n\n    return true;\n  },\n  getStyle: function getStyle(el, prop) {\n    if (el && el.style && el.style[prop] != '') {\n      return el.style[prop];\n    }\n\n    var cssProp = prop.toDashedProperty();\n    return getComputedStyle(el).getPropertyValue(cssProp);\n  },\n  setCaretAtPosition: function setCaretAtPosition(element, position) {\n    if (element == null) {\n      return;\n    }\n\n    var pos = typeof position == 'undefined' ? 0 : position,\n        range = document.createRange(),\n        sel = window.getSelection();\n\n    if (element.childNodes && element.childNodes.length > 0) {\n      range.setStart(element.childNodes[0], position);\n    } else {\n      range.setStart(element, position);\n    }\n\n    range.collapse(true);\n    sel.removeAllRanges();\n    sel.addRange(range);\n  },\n  editableFocus: function editableFocus(el, at_start) {\n    var range, sel;\n\n    if (at_start == null) {\n      at_start = true;\n    }\n\n    if (!el.hasAttribute('contenteditable')) {\n      return;\n    }\n\n    sel = window.getSelection();\n\n    if (sel.rangeCount > 0) {\n      sel.removeAllRanges();\n    }\n\n    range = document.createRange();\n    range.selectNodeContents(el);\n    range.collapse(at_start);\n    return sel.addRange(range);\n  },\n  editableCaretOnLastLine: function editableCaretOnLastLine(el) {\n    var cbtm, ebtm, range;\n    range = editableRange();\n\n    if (!range) {\n      return false;\n    }\n\n    if (is_caret_at_end_of_node(el, range)) {\n      return true;\n    } else if (is_caret_at_start_of_node(el, range)) {\n      cbtm = el.getBoundingClientRect().top + LINE_HEIGHT;\n    } else {\n      cbtm = range.getClientRects()[0].bottom;\n    }\n\n    ebtm = el.getBoundingClientRect().bottom;\n    return cbtm > ebtm - LINE_HEIGHT;\n  },\n  outerWidth: function outerWidth(el) {\n    var width = el.offsetWidth;\n    var style = getComputedStyle(el);\n    width += parseInt(style.marginLeft) + parseInt(style.marginRight);\n    return width;\n  },\n  outerHeight: function outerHeight(el) {\n    var height = el.offsetHeight;\n    var style = getComputedStyle(el);\n    height += parseInt(style.marginTop) + parseInt(style.marginBottom);\n    return height;\n  },\n  registerForScroll: function registerForScroll(key, cb) {\n    Utils.scrollHandlers[key] = cb; //this.handleScroll();\n  },\n  unregisterFromScroll: function unregisterFromScroll(key) {\n    if (Utils.scrollHandlers[key]) {\n      delete Utils.scrollHandlers[key];\n    }\n  },\n  animationFrame: function () {\n    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function (callback, element) {\n      window.setTimeout(callback, 1000 / 60);\n    };\n  }(),\n  handleScroll: function handleScroll(items) {\n    if (Utils.scrollAttached) {\n      return;\n    }\n\n    Utils.scrollAttached = true;\n    var d = document,\n        w = window,\n        wHeight = Utils.getWindowHeight(),\n        didScroll = false,\n        body = d.querySelector('body'),\n        _this = Utils;\n\n    function hasScrolled() {\n      var st = d.body.scrollTop;\n      var cbs = _this.scrollHandlers;\n\n      for (var key in cbs) {\n        if (cbs.hasOwnProperty(key)) {\n          var fn = cbs[key];\n          fn(st, body, d.documentElement.scrollHeight, wHeight);\n        }\n      }\n\n      didScroll = false;\n    }\n\n    function checkScroll() {\n      if (!didScroll) {\n        didScroll = true;\n        animationFrame(hasScrolled);\n      }\n    }\n\n    window.addEventListener('scroll', checkScroll);\n  },\n  editableCaretAtStart: function editableCaretAtStart(el) {\n    var range;\n    range = editableRange();\n\n    if (!range) {\n      return false;\n    }\n\n    return is_caret_at_start_of_node(el, range);\n  },\n  editableCaretAtEnd: function editableCaretAtEnd(el) {\n    var range;\n    range = editableRange();\n\n    if (!range) {\n      return false;\n    }\n\n    return is_caret_at_end_of_node(el, range);\n  },\n  editableCaretOnFirstLine: function editableCaretOnFirstLine(el) {\n    var ctop, etop, range;\n    range = editableRange();\n\n    if (!range) {\n      return false;\n    }\n\n    if (is_caret_at_start_of_node(el, range)) {\n      return true;\n    } else if (is_caret_at_end_of_node(el, range)) {\n      ctop = el.getBoundingClientRect().bottom - LINE_HEIGHT;\n    } else {\n      ctop = range.getClientRects()[0].top;\n    }\n\n    etop = el.getBoundingClientRect().top;\n    return ctop < etop + LINE_HEIGHT;\n  }\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = (Utils);\n\n//# sourceURL=webpack:///./src/js/utils.js?");

/***/ }),

/***/ "./src/scss/app.scss":
/*!***************************!*\
  !*** ./src/scss/app.scss ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("// extracted by mini-css-extract-plugin\n\n//# sourceURL=webpack:///./src/scss/app.scss?");

/***/ }),

/***/ 0:
/*!****************************!*\
  !*** multi ./src/index.js ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("module.exports = __webpack_require__(/*! ./src/index.js */\"./src/index.js\");\n\n\n//# sourceURL=webpack:///multi_./src/index.js?");

/***/ })

/******/ });